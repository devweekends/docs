<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 600">
  <defs>
    <linearGradient id="forwardGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#06b6d4;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="backwardGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#ef4444;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#f97316;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="updateGrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#10b981;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#22c55e;stop-opacity:1" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.2"/>
    </filter>
    <marker id="arrowBlue" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#3b82f6"/>
    </marker>
    <marker id="arrowRed" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ef4444"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#10b981"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="900" height="600" fill="#0f172a"/>
  
  <!-- Title -->
  <text x="450" y="40" font-family="system-ui, sans-serif" font-size="24" font-weight="bold" fill="#f8fafc" text-anchor="middle">Neural Network Training Loop: The Complete Picture</text>
  
  <!-- Phase Labels -->
  <text x="250" y="80" font-family="system-ui, sans-serif" font-size="14" fill="#3b82f6" text-anchor="middle" font-weight="600">FORWARD PASS</text>
  <text x="650" y="80" font-family="system-ui, sans-serif" font-size="14" fill="#ef4444" text-anchor="middle" font-weight="600">BACKWARD PASS</text>
  
  <!-- Input Data Box -->
  <rect x="30" y="120" width="120" height="80" rx="10" fill="#1e293b" stroke="#3b82f6" stroke-width="2" filter="url(#shadow)"/>
  <text x="90" y="150" font-family="system-ui, sans-serif" font-size="12" fill="#94a3b8" text-anchor="middle">Input Data</text>
  <text x="90" y="172" font-family="monospace" font-size="14" fill="#f8fafc" text-anchor="middle" font-weight="bold">X</text>
  <text x="90" y="190" font-family="system-ui, sans-serif" font-size="10" fill="#64748b" text-anchor="middle">[batch × features]</text>
  
  <!-- Hidden Layer Box -->
  <rect x="200" y="120" width="140" height="80" rx="10" fill="#1e293b" stroke="#3b82f6" stroke-width="2" filter="url(#shadow)"/>
  <text x="270" y="145" font-family="system-ui, sans-serif" font-size="12" fill="#94a3b8" text-anchor="middle">Hidden Layer</text>
  <text x="270" y="167" font-family="monospace" font-size="11" fill="#f8fafc" text-anchor="middle">Z₁ = X·W₁ + b₁</text>
  <text x="270" y="187" font-family="monospace" font-size="11" fill="#06b6d4" text-anchor="middle">A₁ = ReLU(Z₁)</text>
  
  <!-- Output Layer Box -->
  <rect x="390" y="120" width="140" height="80" rx="10" fill="#1e293b" stroke="#3b82f6" stroke-width="2" filter="url(#shadow)"/>
  <text x="460" y="145" font-family="system-ui, sans-serif" font-size="12" fill="#94a3b8" text-anchor="middle">Output Layer</text>
  <text x="460" y="167" font-family="monospace" font-size="11" fill="#f8fafc" text-anchor="middle">Z₂ = A₁·W₂ + b₂</text>
  <text x="460" y="187" font-family="monospace" font-size="11" fill="#06b6d4" text-anchor="middle">Ŷ = σ(Z₂)</text>
  
  <!-- Loss Box -->
  <rect x="580" y="120" width="130" height="80" rx="10" fill="#1e293b" stroke="#f97316" stroke-width="2" filter="url(#shadow)"/>
  <text x="645" y="145" font-family="system-ui, sans-serif" font-size="12" fill="#94a3b8" text-anchor="middle">Loss Function</text>
  <text x="645" y="170" font-family="monospace" font-size="12" fill="#f97316" text-anchor="middle" font-weight="bold">L = ½(Ŷ - Y)²</text>
  <text x="645" y="190" font-family="system-ui, sans-serif" font-size="10" fill="#64748b" text-anchor="middle">"How wrong am I?"</text>
  
  <!-- True Labels Box -->
  <rect x="750" y="120" width="100" height="80" rx="10" fill="#1e293b" stroke="#a855f7" stroke-width="2" filter="url(#shadow)"/>
  <text x="800" y="150" font-family="system-ui, sans-serif" font-size="12" fill="#94a3b8" text-anchor="middle">True Labels</text>
  <text x="800" y="175" font-family="monospace" font-size="16" fill="#a855f7" text-anchor="middle" font-weight="bold">Y</text>
  
  <!-- Forward Pass Arrows -->
  <path d="M 150 160 L 195 160" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowBlue)"/>
  <path d="M 340 160 L 385 160" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowBlue)"/>
  <path d="M 530 160 L 575 160" stroke="#3b82f6" stroke-width="2" marker-end="url(#arrowBlue)"/>
  <path d="M 750 160 L 715 160" stroke="#a855f7" stroke-width="2" marker-end="url(#arrowBlue)"/>
  
  <!-- ======= BACKWARD PASS SECTION ======= -->
  
  <!-- Backward Pass Title -->
  <text x="450" y="260" font-family="system-ui, sans-serif" font-size="16" fill="#ef4444" text-anchor="middle" font-weight="bold">← Backpropagation: Computing Gradients via Chain Rule →</text>
  
  <!-- dL/dŶ Box -->
  <rect x="580" y="290" width="130" height="70" rx="10" fill="#1e293b" stroke="#ef4444" stroke-width="2" filter="url(#shadow)"/>
  <text x="645" y="315" font-family="system-ui, sans-serif" font-size="11" fill="#94a3b8" text-anchor="middle">Output Gradient</text>
  <text x="645" y="340" font-family="monospace" font-size="12" fill="#ef4444" text-anchor="middle">dL/dŶ = Ŷ - Y</text>
  
  <!-- dL/dW2 Box -->
  <rect x="390" y="290" width="140" height="70" rx="10" fill="#1e293b" stroke="#ef4444" stroke-width="2" filter="url(#shadow)"/>
  <text x="460" y="312" font-family="system-ui, sans-serif" font-size="11" fill="#94a3b8" text-anchor="middle">Layer 2 Gradients</text>
  <text x="460" y="332" font-family="monospace" font-size="10" fill="#ef4444" text-anchor="middle">dW₂ = A₁ᵀ · dZ₂</text>
  <text x="460" y="350" font-family="monospace" font-size="10" fill="#ef4444" text-anchor="middle">db₂ = Σ dZ₂</text>
  
  <!-- dL/dW1 Box -->
  <rect x="200" y="290" width="140" height="70" rx="10" fill="#1e293b" stroke="#ef4444" stroke-width="2" filter="url(#shadow)"/>
  <text x="270" y="312" font-family="system-ui, sans-serif" font-size="11" fill="#94a3b8" text-anchor="middle">Layer 1 Gradients</text>
  <text x="270" y="332" font-family="monospace" font-size="10" fill="#ef4444" text-anchor="middle">dW₁ = Xᵀ · dZ₁</text>
  <text x="270" y="350" font-family="monospace" font-size="10" fill="#ef4444" text-anchor="middle">db₁ = Σ dZ₁</text>
  
  <!-- Backward Pass Arrows -->
  <path d="M 575 325 L 535 325" stroke="#ef4444" stroke-width="2" marker-end="url(#arrowRed)"/>
  <path d="M 385 325 L 345 325" stroke="#ef4444" stroke-width="2" marker-end="url(#arrowRed)"/>
  
  <!-- Chain Rule Annotation -->
  <rect x="30" y="285" width="140" height="80" rx="8" fill="#1e293b" stroke="#fbbf24" stroke-width="1.5" stroke-dasharray="4,2"/>
  <text x="100" y="310" font-family="system-ui, sans-serif" font-size="11" fill="#fbbf24" text-anchor="middle" font-weight="600">⚡ Chain Rule</text>
  <text x="100" y="330" font-family="monospace" font-size="9" fill="#94a3b8" text-anchor="middle">dL/dW₁ = dL/dA₂</text>
  <text x="100" y="345" font-family="monospace" font-size="9" fill="#94a3b8" text-anchor="middle">· dA₂/dZ₂ · dZ₂/dA₁</text>
  <text x="100" y="360" font-family="monospace" font-size="9" fill="#94a3b8" text-anchor="middle">· dA₁/dZ₁ · dZ₁/dW₁</text>
  
  <!-- ======= UPDATE SECTION ======= -->
  
  <!-- Update Title -->
  <text x="450" y="420" font-family="system-ui, sans-serif" font-size="16" fill="#10b981" text-anchor="middle" font-weight="bold">Weight Update: Taking a Step Downhill</text>
  
  <!-- W1 Update Box -->
  <rect x="80" y="445" width="200" height="70" rx="10" fill="#1e293b" stroke="#10b981" stroke-width="2" filter="url(#shadow)"/>
  <text x="180" y="470" font-family="system-ui, sans-serif" font-size="12" fill="#94a3b8" text-anchor="middle">Update W₁</text>
  <text x="180" y="495" font-family="monospace" font-size="13" fill="#10b981" text-anchor="middle" font-weight="bold">W₁ = W₁ - α · dW₁</text>
  
  <!-- W2 Update Box -->
  <rect x="350" y="445" width="200" height="70" rx="10" fill="#1e293b" stroke="#10b981" stroke-width="2" filter="url(#shadow)"/>
  <text x="450" y="470" font-family="system-ui, sans-serif" font-size="12" fill="#94a3b8" text-anchor="middle">Update W₂</text>
  <text x="450" y="495" font-family="monospace" font-size="13" fill="#10b981" text-anchor="middle" font-weight="bold">W₂ = W₂ - α · dW₂</text>
  
  <!-- Learning Rate Box -->
  <rect x="620" y="445" width="160" height="70" rx="10" fill="#1e293b" stroke="#fbbf24" stroke-width="2" filter="url(#shadow)"/>
  <text x="700" y="470" font-family="system-ui, sans-serif" font-size="12" fill="#94a3b8" text-anchor="middle">Learning Rate α</text>
  <text x="700" y="495" font-family="system-ui, sans-serif" font-size="11" fill="#fbbf24" text-anchor="middle">"How big a step?"</text>
  
  <!-- Repeat Loop Arrow -->
  <path d="M 450 530 C 450 570 90 570 90 530 L 90 210" stroke="#64748b" stroke-width="2" stroke-dasharray="6,3" fill="none" marker-end="url(#arrowBlue)"/>
  <text x="270" y="565" font-family="system-ui, sans-serif" font-size="12" fill="#64748b" text-anchor="middle">Repeat until loss is minimized (convergence)</text>
  
  <!-- Legend -->
  <rect x="750" y="450" width="130" height="100" rx="8" fill="#1e293b" stroke="#475569" stroke-width="1"/>
  <text x="815" y="472" font-family="system-ui, sans-serif" font-size="11" fill="#f8fafc" text-anchor="middle" font-weight="600">Legend</text>
  <line x1="760" y1="485" x2="790" y2="485" stroke="#3b82f6" stroke-width="3"/>
  <text x="800" y="489" font-family="system-ui, sans-serif" font-size="10" fill="#94a3b8">Forward</text>
  <line x1="760" y1="505" x2="790" y2="505" stroke="#ef4444" stroke-width="3"/>
  <text x="800" y="509" font-family="system-ui, sans-serif" font-size="10" fill="#94a3b8">Backward</text>
  <line x1="760" y1="525" x2="790" y2="525" stroke="#10b981" stroke-width="3"/>
  <text x="800" y="529" font-family="system-ui, sans-serif" font-size="10" fill="#94a3b8">Update</text>
</svg>