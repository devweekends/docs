<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 600">
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#2C3E50" />
    </marker>
  </defs>

  <rect width="800" height="600" fill="#ffffff" rx="10" ry="10" />
  <text x="400" y="30" font-family="Arial, sans-serif" font-size="20" font-weight="bold" text-anchor="middle" fill="#2C3E50">DMA Transfer Sequence</text>

  <!-- Lifelines -->
  <g transform="translate(100, 60)">
    <rect x="-40" y="0" width="80" height="40" rx="4" ry="4" fill="#FF6B6B" />
    <text x="0" y="25" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">CPU</text>
    <line x1="0" y1="40" x2="0" y2="550" stroke="#7f8c8d" stroke-width="2" stroke-dasharray="5,5" />
  </g>

  <g transform="translate(300, 60)">
    <rect x="-50" y="0" width="100" height="40" rx="4" ry="4" fill="#F39C12" />
    <text x="0" y="25" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">DMA Ctrl</text>
    <line x1="0" y1="40" x2="0" y2="550" stroke="#7f8c8d" stroke-width="2" stroke-dasharray="5,5" />
  </g>

  <g transform="translate(500, 60)">
    <rect x="-50" y="0" width="100" height="40" rx="4" ry="4" fill="#A8E6CF" />
    <text x="0" y="25" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="#2C3E50">Disk Ctrl</text>
    <line x1="0" y1="40" x2="0" y2="550" stroke="#7f8c8d" stroke-width="2" stroke-dasharray="5,5" />
  </g>

  <g transform="translate(700, 60)">
    <rect x="-40" y="0" width="80" height="40" rx="4" ry="4" fill="#4ECDC4" />
    <text x="0" y="25" font-family="Arial, sans-serif" font-size="14" font-weight="bold" text-anchor="middle" fill="white">Memory</text>
    <line x1="0" y1="40" x2="0" y2="550" stroke="#7f8c8d" stroke-width="2" stroke-dasharray="5,5" />
  </g>

  <!-- Interactions -->
  
  <!-- 1. CPU configures DMA -->
  <g transform="translate(0, 120)">
    <line x1="100" y1="0" x2="290" y2="0" stroke="#2C3E50" stroke-width="2" marker-end="url(#arrow)" />
    <text x="200" y="-10" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#2C3E50">1. Configure (Src, Dst, Count)</text>
  </g>

  <!-- 2. CPU commands Disk -->
  <g transform="translate(0, 160)">
    <line x1="100" y1="0" x2="490" y2="0" stroke="#2C3E50" stroke-width="2" marker-end="url(#arrow)" />
    <text x="300" y="-10" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#2C3E50">2. Initiate Read Command</text>
  </g>

  <!-- CPU goes to other work -->
  <g transform="translate(100, 180)">
    <rect x="-10" y="0" width="20" height="200" fill="#ecf0f1" stroke="#bdc3c7" />
    <text x="-20" y="100" font-family="Arial, sans-serif" font-size="12" text-anchor="end" fill="#7f8c8d" transform="rotate(-90, -20, 100)">CPU executes other tasks</text>
  </g>

  <!-- Loop for data transfer -->
  <rect x="280" y="200" width="440" height="180" fill="none" stroke="#3498db" stroke-width="1" stroke-dasharray="5,5" rx="5" ry="5" />
  <text x="300" y="220" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#3498db">Data Transfer Loop</text>

  <!-- 3. Disk DRQ -->
  <g transform="translate(0, 240)">
    <line x1="500" y1="0" x2="310" y2="0" stroke="#2C3E50" stroke-width="2" marker-end="url(#arrow)" />
    <text x="400" y="-10" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#2C3E50">3. Data Ready (DRQ)</text>
  </g>

  <!-- 4. DMA DACK -->
  <g transform="translate(0, 280)">
    <line x1="300" y1="0" x2="490" y2="0" stroke="#2C3E50" stroke-width="2" marker-end="url(#arrow)" />
    <text x="400" y="-10" font-family="Arial, sans-serif" font-size="12" text-anchor="middle" fill="#2C3E50">4. Acknowledge (DACK)</text>
  </g>

  <!-- 5. Data to Memory -->
  <g transform="translate(0, 320)">
    <line x1="500" y1="0" x2="690" y2="0" stroke="#2C3E50" stroke-width="3" marker-end="url(#arrow)" />
    <text x="600" y="-10" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#2C3E50">5. Transfer Data (Bus)</text>
  </g>

  <!-- 6. Interrupt -->
  <g transform="translate(0, 450)">
    <line x1="300" y1="0" x2="110" y2="0" stroke="#E74C3C" stroke-width="2" marker-end="url(#arrow)" />
    <text x="200" y="-10" font-family="Arial, sans-serif" font-size="12" font-weight="bold" text-anchor="middle" fill="#E74C3C">6. Interrupt (Transfer Complete)</text>
  </g>

  <!-- CPU Handles Interrupt -->
  <g transform="translate(100, 470)">
    <rect x="-10" y="0" width="20" height="60" fill="#FF6B6B" opacity="0.5" />
    <text x="20" y="35" font-family="Arial, sans-serif" font-size="12" fill="#c0392b">ISR Execution</text>
  </g>

</svg>
