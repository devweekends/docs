<svg viewBox="0 0 1080 1080" xmlns="http://www.w3.org/2000/svg">
  <rect width="1080" height="1080" fill="#FAFAFA"/>
  
  <!-- Branding -->
  <text x="60" y="80" font-family="system-ui, sans-serif" font-size="14" font-weight="600" fill="#18181B" letter-spacing="3">DEV WEEKENDS</text>
  
  <!-- Title -->
  <text x="540" y="140" font-family="system-ui, sans-serif" font-size="36" font-weight="700" fill="#18181B" text-anchor="middle">Linux I/O Subsystem</text>
  <text x="540" y="175" font-family="system-ui, sans-serif" font-size="18" fill="#71717A" text-anchor="middle">Block layer, I/O schedulers, and the journey from VFS to disk</text>
  
  <!-- I/O Stack visualization -->
  <rect x="280" y="210" width="520" height="60" rx="12" fill="#22C55E"/>
  <text x="540" y="245" font-family="system-ui, sans-serif" font-size="16" fill="#FAFAFA" font-weight="600" text-anchor="middle">User Space: read(), write(), pread(), pwrite()</text>
  
  <path d="M540 275 L540 295" stroke="#18181B" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- VFS -->
  <rect x="280" y="300" width="520" height="55" rx="10" fill="#3B82F6"/>
  <text x="540" y="332" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">VFS Layer: file_operations â†’ read_iter(), write_iter()</text>
  
  <path d="M540 360 L540 380" stroke="#18181B" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- Page Cache -->
  <rect x="280" y="385" width="520" height="70" rx="12" fill="#A855F7"/>
  <text x="540" y="415" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">Page Cache (Buffer Cache)</text>
  <text x="540" y="440" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" text-anchor="middle">Read: cache hit â†’ return | miss â†’ submit_bio() â€¢ Write: dirty pages â†’ writeback</text>
  
  <path d="M540 460 L540 480" stroke="#18181B" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- Block Layer (main focus) -->
  <rect x="80" y="485" width="920" height="240" rx="16" fill="#EF4444" opacity="0.1" stroke="#EF4444" stroke-width="2"/>
  <text x="540" y="520" font-family="system-ui, sans-serif" font-size="20" font-weight="700" fill="#EF4444" text-anchor="middle">Block Layer</text>
  
  <!-- Bio structure -->
  <rect x="110" y="540" width="260" height="160" rx="10" fill="#FAFAFA" stroke="#EF4444" stroke-width="2"/>
  <text x="240" y="570" font-family="system-ui, sans-serif" font-size="14" fill="#EF4444" font-weight="600" text-anchor="middle">struct bio</text>
  <text x="130" y="600" font-family="monospace" font-size="10" fill="#18181B">bi_sector</text>
  <text x="280" y="600" font-family="system-ui, sans-serif" font-size="9" fill="#71717A">start sector</text>
  <text x="130" y="620" font-family="monospace" font-size="10" fill="#18181B">bi_size</text>
  <text x="280" y="620" font-family="system-ui, sans-serif" font-size="9" fill="#71717A">bytes to transfer</text>
  <text x="130" y="640" font-family="monospace" font-size="10" fill="#18181B">bi_io_vec</text>
  <text x="280" y="640" font-family="system-ui, sans-serif" font-size="9" fill="#71717A">page + offset + len</text>
  <text x="130" y="660" font-family="monospace" font-size="10" fill="#18181B">bi_opf</text>
  <text x="280" y="660" font-family="system-ui, sans-serif" font-size="9" fill="#71717A">READ/WRITE/FLUSH</text>
  <text x="130" y="680" font-family="monospace" font-size="10" fill="#18181B">bi_end_io</text>
  <text x="280" y="680" font-family="system-ui, sans-serif" font-size="9" fill="#71717A">completion callback</text>
  
  <!-- I/O Schedulers -->
  <rect x="410" y="540" width="260" height="160" rx="10" fill="#EF4444"/>
  <text x="540" y="570" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">I/O Schedulers (blk-mq)</text>
  
  <rect x="430" y="590" width="100" height="35" rx="6" fill="#FAFAFA"/>
  <text x="480" y="612" font-family="system-ui, sans-serif" font-size="11" fill="#EF4444" font-weight="600" text-anchor="middle">mq-deadline</text>
  
  <rect x="545" y="590" width="105" height="35" rx="6" fill="#FAFAFA"/>
  <text x="597" y="612" font-family="system-ui, sans-serif" font-size="11" fill="#EF4444" font-weight="600" text-anchor="middle">bfq</text>
  
  <rect x="430" y="635" width="100" height="35" rx="6" fill="#FAFAFA"/>
  <text x="480" y="657" font-family="system-ui, sans-serif" font-size="11" fill="#EF4444" font-weight="600" text-anchor="middle">kyber</text>
  
  <rect x="545" y="635" width="105" height="35" rx="6" fill="#FAFAFA"/>
  <text x="597" y="657" font-family="system-ui, sans-serif" font-size="11" fill="#EF4444" font-weight="600" text-anchor="middle">none</text>
  
  <text x="540" y="695" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">NVMe often uses 'none' - already fast</text>
  
  <!-- Request queue -->
  <rect x="710" y="540" width="260" height="160" rx="10" fill="#18181B"/>
  <text x="840" y="570" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">Request Queue (blk-mq)</text>
  
  <text x="730" y="600" font-family="system-ui, sans-serif" font-size="11" fill="#22C55E">Per-CPU software queues</text>
  <text x="730" y="625" font-family="system-ui, sans-serif" font-size="10" fill="#71717A">Merge adjacent requests</text>
  <text x="730" y="645" font-family="system-ui, sans-serif" font-size="10" fill="#71717A">Sort by sector (elevator)</text>
  
  <text x="730" y="675" font-family="system-ui, sans-serif" font-size="11" fill="#3B82F6">Hardware dispatch queues</text>
  <text x="730" y="695" font-family="system-ui, sans-serif" font-size="10" fill="#71717A">Map to NVMe SQs</text>
  
  <path d="M540 730 L540 755" stroke="#18181B" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- Device Driver -->
  <rect x="280" y="760" width="520" height="60" rx="10" fill="#3B82F6"/>
  <text x="540" y="795" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">Device Driver: nvme, scsi, virtio-blk â†’ queue_rq()</text>
  
  <path d="M540 825 L540 850" stroke="#18181B" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- Hardware -->
  <rect x="280" y="855" width="520" height="55" rx="10" fill="#18181B"/>
  <text x="540" y="888" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">Hardware: NVMe SSD, SATA SSD, HDD (via DMA)</text>
  
  <!-- I/O Flags legend -->
  <rect x="80" y="760" width="170" height="150" rx="10" fill="#22C55E" opacity="0.15" stroke="#22C55E" stroke-width="2"/>
  <text x="165" y="790" font-family="system-ui, sans-serif" font-size="12" fill="#22C55E" font-weight="600" text-anchor="middle">I/O Flags</text>
  <text x="100" y="815" font-family="monospace" font-size="10" fill="#18181B">REQ_SYNC</text>
  <text x="100" y="835" font-family="monospace" font-size="10" fill="#18181B">REQ_META</text>
  <text x="100" y="855" font-family="monospace" font-size="10" fill="#18181B">REQ_FUA</text>
  <text x="100" y="875" font-family="monospace" font-size="10" fill="#18181B">REQ_PREFLUSH</text>
  <text x="100" y="895" font-family="monospace" font-size="10" fill="#18181B">REQ_RAHEAD</text>
  
  <!-- Direct I/O note -->
  <rect x="830" y="760" width="170" height="150" rx="10" fill="#A855F7" opacity="0.15" stroke="#A855F7" stroke-width="2"/>
  <text x="915" y="790" font-family="system-ui, sans-serif" font-size="12" fill="#A855F7" font-weight="600" text-anchor="middle">Direct I/O</text>
  <text x="850" y="815" font-family="monospace" font-size="10" fill="#18181B">O_DIRECT</text>
  <text x="850" y="840" font-family="system-ui, sans-serif" font-size="9" fill="#71717A">Bypasses page cache</text>
  <text x="850" y="865" font-family="system-ui, sans-serif" font-size="9" fill="#71717A">User must align</text>
  <text x="850" y="890" font-family="system-ui, sans-serif" font-size="9" fill="#71717A">Used by databases</text>
  
  <!-- Key insight -->
  <rect x="80" y="930" width="920" height="70" rx="12" fill="#22C55E" opacity="0.2" stroke="#22C55E" stroke-width="2"/>
  <text x="120" y="960" font-family="system-ui, sans-serif" font-size="14" fill="#22C55E" font-weight="600">ðŸ’¡ Key Insights:</text>
  <text x="260" y="960" font-family="system-ui, sans-serif" font-size="12" fill="#18181B">bio = unit of I/O â€¢ blk-mq replaced single-queue for multi-core scaling</text>
  <text x="120" y="985" font-family="system-ui, sans-serif" font-size="12" fill="#71717A">io_uring: async I/O with shared ring buffers â€¢ iostat, blktrace for debugging</text>
  
  <!-- Arrow marker -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#18181B"/>
    </marker>
  </defs>
  
  <!-- Footer -->
  <text x="540" y="1040" font-family="system-ui, sans-serif" font-size="14" fill="#71717A" text-anchor="middle">@devweekends</text>
</svg>