<svg viewBox="0 0 1080 1080" xmlns="http://www.w3.org/2000/svg">
  <rect width="1080" height="1080" fill="#FAFAFA"/>
  
  <!-- Branding -->
  <text x="60" y="80" font-family="system-ui, sans-serif" font-size="14" font-weight="600" fill="#18181B" letter-spacing="3">DEV WEEKENDS</text>
  
  <!-- Title -->
  <text x="540" y="140" font-family="system-ui, sans-serif" font-size="36" font-weight="700" fill="#18181B" text-anchor="middle">Virtual Filesystem Layer (VFS)</text>
  <text x="540" y="175" font-family="system-ui, sans-serif" font-size="18" fill="#71717A" text-anchor="middle">Unified abstraction for all filesystem operations</text>
  
  <!-- VFS Layer architecture -->
  <!-- User Space -->
  <rect x="300" y="210" width="480" height="60" rx="12" fill="#22C55E"/>
  <text x="540" y="245" font-family="system-ui, sans-serif" font-size="16" fill="#FAFAFA" font-weight="600" text-anchor="middle">User Space: open(), read(), write(), close()</text>
  
  <path d="M540 275 L540 295" stroke="#18181B" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- System Call Interface -->
  <rect x="300" y="300" width="480" height="50" rx="10" fill="#18181B"/>
  <text x="540" y="330" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">System Call Interface: sys_open(), sys_read(), sys_write()</text>
  
  <path d="M540 355 L540 375" stroke="#18181B" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- VFS Layer (main focus) -->
  <rect x="80" y="380" width="920" height="250" rx="16" fill="#3B82F6" opacity="0.1" stroke="#3B82F6" stroke-width="3"/>
  <text x="540" y="415" font-family="system-ui, sans-serif" font-size="20" font-weight="700" fill="#3B82F6" text-anchor="middle">VFS Layer - The Abstraction Magic</text>
  
  <!-- VFS Core Objects -->
  <rect x="110" y="440" width="200" height="80" rx="10" fill="#3B82F6"/>
  <text x="210" y="470" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">superblock</text>
  <text x="210" y="490" font-family="system-ui, sans-serif" font-size="11" fill="#FAFAFA" text-anchor="middle">Filesystem metadata</text>
  <text x="210" y="505" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">mount point, block size</text>
  
  <rect x="330" y="440" width="200" height="80" rx="10" fill="#A855F7"/>
  <text x="430" y="470" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">inode</text>
  <text x="430" y="490" font-family="system-ui, sans-serif" font-size="11" fill="#FAFAFA" text-anchor="middle">File metadata</text>
  <text x="430" y="505" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">size, perms, owner, times</text>
  
  <rect x="550" y="440" width="200" height="80" rx="10" fill="#22C55E"/>
  <text x="650" y="470" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">dentry</text>
  <text x="650" y="490" font-family="system-ui, sans-serif" font-size="11" fill="#FAFAFA" text-anchor="middle">Directory entry cache</text>
  <text x="650" y="505" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">path â†’ inode mapping</text>
  
  <rect x="770" y="440" width="200" height="80" rx="10" fill="#EF4444"/>
  <text x="870" y="470" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">file</text>
  <text x="870" y="490" font-family="system-ui, sans-serif" font-size="11" fill="#FAFAFA" text-anchor="middle">Open file state</text>
  <text x="870" y="505" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">position, flags, f_op</text>
  
  <!-- Operations structures -->
  <rect x="110" y="540" width="200" height="70" rx="8" fill="#FAFAFA" stroke="#3B82F6" stroke-width="2"/>
  <text x="210" y="565" font-family="system-ui, sans-serif" font-size="11" fill="#3B82F6" font-weight="600" text-anchor="middle">super_operations</text>
  <text x="210" y="585" font-family="monospace" font-size="9" fill="#18181B" text-anchor="middle">alloc_inode, write_inode</text>
  <text x="210" y="600" font-family="monospace" font-size="9" fill="#18181B" text-anchor="middle">sync_fs, statfs</text>
  
  <rect x="330" y="540" width="200" height="70" rx="8" fill="#FAFAFA" stroke="#A855F7" stroke-width="2"/>
  <text x="430" y="565" font-family="system-ui, sans-serif" font-size="11" fill="#A855F7" font-weight="600" text-anchor="middle">inode_operations</text>
  <text x="430" y="585" font-family="monospace" font-size="9" fill="#18181B" text-anchor="middle">lookup, create, link</text>
  <text x="430" y="600" font-family="monospace" font-size="9" fill="#18181B" text-anchor="middle">mkdir, rename, setattr</text>
  
  <rect x="550" y="540" width="200" height="70" rx="8" fill="#FAFAFA" stroke="#22C55E" stroke-width="2"/>
  <text x="650" y="565" font-family="system-ui, sans-serif" font-size="11" fill="#22C55E" font-weight="600" text-anchor="middle">dentry_operations</text>
  <text x="650" y="585" font-family="monospace" font-size="9" fill="#18181B" text-anchor="middle">d_compare, d_hash</text>
  <text x="650" y="600" font-family="monospace" font-size="9" fill="#18181B" text-anchor="middle">d_delete, d_release</text>
  
  <rect x="770" y="540" width="200" height="70" rx="8" fill="#FAFAFA" stroke="#EF4444" stroke-width="2"/>
  <text x="870" y="565" font-family="system-ui, sans-serif" font-size="11" fill="#EF4444" font-weight="600" text-anchor="middle">file_operations</text>
  <text x="870" y="585" font-family="monospace" font-size="9" fill="#18181B" text-anchor="middle">read, write, llseek</text>
  <text x="870" y="600" font-family="monospace" font-size="9" fill="#18181B" text-anchor="middle">mmap, fsync, poll</text>
  
  <path d="M540 635 L540 660" stroke="#18181B" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- Filesystem Implementations -->
  <rect x="80" y="665" width="920" height="100" rx="16" fill="#A855F7" opacity="0.1" stroke="#A855F7" stroke-width="2"/>
  <text x="540" y="695" font-family="system-ui, sans-serif" font-size="16" font-weight="600" fill="#A855F7" text-anchor="middle">Concrete Filesystem Implementations</text>
  
  <rect x="110" y="715" width="130" height="40" rx="6" fill="#A855F7"/>
  <text x="175" y="740" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" text-anchor="middle">ext4</text>
  
  <rect x="255" y="715" width="130" height="40" rx="6" fill="#A855F7"/>
  <text x="320" y="740" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" text-anchor="middle">XFS</text>
  
  <rect x="400" y="715" width="130" height="40" rx="6" fill="#A855F7"/>
  <text x="465" y="740" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" text-anchor="middle">Btrfs</text>
  
  <rect x="545" y="715" width="130" height="40" rx="6" fill="#22C55E"/>
  <text x="610" y="740" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" text-anchor="middle">NFS (network)</text>
  
  <rect x="690" y="715" width="130" height="40" rx="6" fill="#3B82F6"/>
  <text x="755" y="740" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" text-anchor="middle">procfs</text>
  
  <rect x="835" y="715" width="130" height="40" rx="6" fill="#3B82F6"/>
  <text x="900" y="740" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" text-anchor="middle">sysfs</text>
  
  <path d="M540 770 L540 795" stroke="#18181B" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- Block/Page Cache Layer -->
  <rect x="200" y="800" width="680" height="55" rx="12" fill="#18181B"/>
  <text x="540" y="825" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">Page Cache (Buffer Cache)</text>
  <text x="540" y="845" font-family="system-ui, sans-serif" font-size="11" fill="#71717A" text-anchor="middle">Caches file data in memory â€¢ read-ahead â€¢ write-back</text>
  
  <path d="M540 860 L540 880" stroke="#18181B" stroke-width="3" marker-end="url(#arrow)"/>
  
  <!-- Block Device Layer -->
  <rect x="200" y="885" width="680" height="50" rx="10" fill="#EF4444"/>
  <text x="540" y="915" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">Block I/O Layer â†’ Device Drivers â†’ Hardware (SSD, HDD, NVMe)</text>
  
  <!-- Key insight -->
  <rect x="80" y="950" width="920" height="60" rx="10" fill="#22C55E" opacity="0.2" stroke="#22C55E" stroke-width="2"/>
  <text x="120" y="980" font-family="system-ui, sans-serif" font-size="14" fill="#22C55E" font-weight="600">ðŸ’¡ VFS Key Insight:</text>
  <text x="295" y="980" font-family="system-ui, sans-serif" font-size="13" fill="#18181B">Same system calls work for ext4, NFS, /proc, /dev - VFS handles the polymorphism via function pointers!</text>
  
  <!-- Arrow marker -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#18181B"/>
    </marker>
  </defs>
  
  <!-- Footer -->
  <text x="540" y="1040" font-family="system-ui, sans-serif" font-size="14" fill="#71717A" text-anchor="middle">@devweekends</text>
</svg>