<svg viewBox="0 0 1080 1080" xmlns="http://www.w3.org/2000/svg">
  <rect width="1080" height="1080" fill="#FAFAFA"/>
  
  <!-- Branding -->
  <text x="60" y="80" font-family="system-ui, sans-serif" font-size="14" font-weight="600" fill="#18181B" letter-spacing="3">DEV WEEKENDS</text>
  
  <!-- Title -->
  <text x="540" y="140" font-family="system-ui, sans-serif" font-size="36" font-weight="700" fill="#18181B" text-anchor="middle">Database Internals</text>
  <text x="540" y="175" font-family="system-ui, sans-serif" font-size="18" fill="#71717A" text-anchor="middle">PostgreSQL architecture: processes, memory, and background workers</text>
  
  <!-- Process Architecture -->
  <rect x="80" y="210" width="440" height="350" rx="16" fill="#3B82F6" opacity="0.1" stroke="#3B82F6" stroke-width="2"/>
  <text x="300" y="245" font-family="system-ui, sans-serif" font-size="18" font-weight="600" fill="#3B82F6" text-anchor="middle">PostgreSQL Process Model</text>
  
  <!-- Postmaster -->
  <rect x="200" y="270" width="200" height="50" rx="8" fill="#3B82F6"/>
  <text x="300" y="300" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">Postmaster (PID 1)</text>
  
  <!-- Fork arrows -->
  <path d="M250 325 L180 360" stroke="#18181B" stroke-width="2" marker-end="url(#arrow)"/>
  <path d="M300 325 L300 360" stroke="#18181B" stroke-width="2" marker-end="url(#arrow)"/>
  <path d="M350 325 L420 360" stroke="#18181B" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- Backend processes -->
  <rect x="110" y="365" width="140" height="45" rx="6" fill="#22C55E"/>
  <text x="180" y="393" font-family="system-ui, sans-serif" font-size="11" fill="#FAFAFA" font-weight="600" text-anchor="middle">Backend 1</text>
  
  <rect x="230" y="365" width="140" height="45" rx="6" fill="#22C55E"/>
  <text x="300" y="393" font-family="system-ui, sans-serif" font-size="11" fill="#FAFAFA" font-weight="600" text-anchor="middle">Backend 2</text>
  
  <rect x="350" y="365" width="140" height="45" rx="6" fill="#22C55E"/>
  <text x="420" y="393" font-family="system-ui, sans-serif" font-size="11" fill="#FAFAFA" font-weight="600" text-anchor="middle">Backend N</text>
  
  <text x="300" y="435" font-family="system-ui, sans-serif" font-size="11" fill="#71717A" text-anchor="middle">1 connection = 1 process (fork)</text>
  
  <!-- Background workers -->
  <text x="300" y="470" font-family="system-ui, sans-serif" font-size="14" fill="#3B82F6" font-weight="600" text-anchor="middle">Background Workers</text>
  
  <rect x="110" y="490" width="100" height="55" rx="6" fill="#A855F7"/>
  <text x="160" y="515" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" font-weight="600" text-anchor="middle">Checkpointer</text>
  <text x="160" y="535" font-family="system-ui, sans-serif" font-size="8" fill="#FAFAFA" text-anchor="middle">Flush dirty pages</text>
  
  <rect x="220" y="490" width="100" height="55" rx="6" fill="#A855F7"/>
  <text x="270" y="515" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" font-weight="600" text-anchor="middle">Autovacuum</text>
  <text x="270" y="535" font-family="system-ui, sans-serif" font-size="8" fill="#FAFAFA" text-anchor="middle">Dead tuple cleanup</text>
  
  <rect x="330" y="490" width="100" height="55" rx="6" fill="#A855F7"/>
  <text x="380" y="515" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" font-weight="600" text-anchor="middle">WAL Writer</text>
  <text x="380" y="535" font-family="system-ui, sans-serif" font-size="8" fill="#FAFAFA" text-anchor="middle">Flush WAL</text>
  
  <rect x="440" y="490" width="70" height="55" rx="6" fill="#A855F7"/>
  <text x="475" y="520" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" font-weight="600" text-anchor="middle">Stats</text>
  
  <!-- Memory Architecture -->
  <rect x="560" y="210" width="440" height="350" rx="16" fill="#22C55E" opacity="0.1" stroke="#22C55E" stroke-width="2"/>
  <text x="780" y="245" font-family="system-ui, sans-serif" font-size="18" font-weight="600" fill="#22C55E" text-anchor="middle">Shared Memory</text>
  
  <!-- Shared buffers -->
  <rect x="590" y="270" width="380" height="80" rx="8" fill="#22C55E"/>
  <text x="780" y="300" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">shared_buffers</text>
  <text x="780" y="325" font-family="system-ui, sans-serif" font-size="11" fill="#FAFAFA" text-anchor="middle">Buffer pool for data pages • Default: 128MB • Recommended: 25% RAM</text>
  <text x="780" y="345" font-family="monospace" font-size="10" fill="#FAFAFA" text-anchor="middle">BufferTag → (relfilenode, fork, block)</text>
  
  <!-- WAL buffers -->
  <rect x="590" y="360" width="180" height="60" rx="8" fill="#3B82F6"/>
  <text x="680" y="390" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">wal_buffers</text>
  <text x="680" y="410" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">WAL write buffer</text>
  
  <!-- Work mem -->
  <rect x="790" y="360" width="180" height="60" rx="8" fill="#EF4444"/>
  <text x="880" y="390" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">work_mem</text>
  <text x="880" y="410" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Per-operation memory</text>
  
  <!-- Lock tables -->
  <rect x="590" y="430" width="180" height="50" rx="6" fill="#18181B"/>
  <text x="680" y="460" font-family="system-ui, sans-serif" font-size="11" fill="#FAFAFA" font-weight="600" text-anchor="middle">Lock Tables</text>
  
  <!-- Proc array -->
  <rect x="790" y="430" width="180" height="50" rx="6" fill="#18181B"/>
  <text x="880" y="460" font-family="system-ui, sans-serif" font-size="11" fill="#FAFAFA" font-weight="600" text-anchor="middle">PGPROC Array</text>
  
  <!-- CLOG / Commit Log -->
  <rect x="590" y="495" width="380" height="50" rx="6" fill="#A855F7"/>
  <text x="780" y="525" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">CLOG (pg_xact) - Transaction commit status</text>
  
  <!-- MVCC Deep Dive -->
  <rect x="80" y="580" width="920" height="200" rx="16" fill="#EF4444" opacity="0.1" stroke="#EF4444" stroke-width="2"/>
  <text x="540" y="615" font-family="system-ui, sans-serif" font-size="20" font-weight="700" fill="#EF4444" text-anchor="middle">MVCC (Multi-Version Concurrency Control)</text>
  
  <!-- Tuple versions -->
  <rect x="110" y="640" width="280" height="120" rx="10" fill="#FAFAFA" stroke="#EF4444" stroke-width="2"/>
  <text x="250" y="670" font-family="system-ui, sans-serif" font-size="14" fill="#EF4444" font-weight="600" text-anchor="middle">Tuple Header</text>
  <text x="130" y="695" font-family="monospace" font-size="10" fill="#18181B">xmin = 100</text>
  <text x="260" y="695" font-family="system-ui, sans-serif" font-size="9" fill="#71717A">Created by TX 100</text>
  <text x="130" y="715" font-family="monospace" font-size="10" fill="#18181B">xmax = 105</text>
  <text x="260" y="715" font-family="system-ui, sans-serif" font-size="9" fill="#71717A">Deleted by TX 105</text>
  <text x="130" y="735" font-family="monospace" font-size="10" fill="#18181B">ctid = (0, 1)</text>
  <text x="260" y="735" font-family="system-ui, sans-serif" font-size="9" fill="#71717A">Location in heap</text>
  <text x="130" y="755" font-family="monospace" font-size="10" fill="#18181B">infomask</text>
  <text x="260" y="755" font-family="system-ui, sans-serif" font-size="9" fill="#71717A">Status bits</text>
  
  <!-- Visibility check -->
  <rect x="420" y="640" width="280" height="120" rx="10" fill="#18181B"/>
  <text x="560" y="670" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">Visibility Check</text>
  <text x="440" y="700" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA">Can TX 103 see this tuple?</text>
  <text x="440" y="725" font-family="system-ui, sans-serif" font-size="10" fill="#22C55E">✓ xmin (100) committed and &lt; 103</text>
  <text x="440" y="750" font-family="system-ui, sans-serif" font-size="10" fill="#EF4444">✗ xmax (105) not yet visible</text>
  
  <!-- Snapshot -->
  <rect x="730" y="640" width="250" height="120" rx="10" fill="#22C55E"/>
  <text x="855" y="670" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">Snapshot</text>
  <text x="750" y="700" font-family="monospace" font-size="10" fill="#FAFAFA">xmin = 100</text>
  <text x="750" y="720" font-family="monospace" font-size="10" fill="#FAFAFA">xmax = 110</text>
  <text x="750" y="740" font-family="monospace" font-size="10" fill="#FAFAFA">xip = [102, 104, 107]</text>
  <text x="750" y="758" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA">Active transactions at snapshot time</text>
  
  <!-- Vacuum Process -->
  <rect x="80" y="800" width="920" height="160" rx="16" fill="#A855F7" opacity="0.1" stroke="#A855F7" stroke-width="2"/>
  <text x="540" y="835" font-family="system-ui, sans-serif" font-size="18" font-weight="600" fill="#A855F7" text-anchor="middle">VACUUM: Dead Tuple Reclamation</text>
  
  <!-- Vacuum flow -->
  <rect x="110" y="860" width="180" height="80" rx="8" fill="#A855F7"/>
  <text x="200" y="890" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">Dead Tuples</text>
  <text x="200" y="915" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">xmax set, invisible</text>
  <text x="200" y="935" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">to all transactions</text>
  
  <path d="M295 900 L345 900" stroke="#18181B" stroke-width="2" marker-end="url(#arrow)"/>
  
  <rect x="350" y="860" width="180" height="80" rx="8" fill="#3B82F6"/>
  <text x="440" y="890" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">VACUUM</text>
  <text x="440" y="915" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Mark space reusable</text>
  <text x="440" y="935" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Update FSM</text>
  
  <path d="M535 900 L585 900" stroke="#18181B" stroke-width="2" marker-end="url(#arrow)"/>
  
  <rect x="590" y="860" width="180" height="80" rx="8" fill="#22C55E"/>
  <text x="680" y="890" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">VACUUM FULL</text>
  <text x="680" y="915" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Rewrite table</text>
  <text x="680" y="935" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Exclusive lock!</text>
  
  <rect x="800" y="860" width="180" height="80" rx="8" fill="#18181B"/>
  <text x="890" y="890" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">Autovacuum</text>
  <text x="890" y="915" font-family="system-ui, sans-serif" font-size="10" fill="#71717A" text-anchor="middle">autovacuum_threshold</text>
  <text x="890" y="935" font-family="system-ui, sans-serif" font-size="10" fill="#71717A" text-anchor="middle">+ scale_factor * n_rows</text>
  
  <!-- Arrow marker -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#18181B"/>
    </marker>
  </defs>
  
  <!-- Footer -->
  <text x="540" y="1040" font-family="system-ui, sans-serif" font-size="14" fill="#71717A" text-anchor="middle">@devweekends</text>
</svg>