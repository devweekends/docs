<svg viewBox="0 0 1080 1080" xmlns="http://www.w3.org/2000/svg">
  <rect width="1080" height="1080" fill="#FAFAFA"/>
  
  <!-- Branding -->
  <text x="60" y="80" font-family="system-ui, sans-serif" font-size="14" font-weight="600" fill="#18181B" letter-spacing="3">DEV WEEKENDS</text>
  
  <!-- Title -->
  <text x="540" y="140" font-family="system-ui, sans-serif" font-size="36" font-weight="700" fill="#18181B" text-anchor="middle">Buffer Manager Deep Dive</text>
  <text x="540" y="175" font-family="system-ui, sans-serif" font-size="18" fill="#71717A" text-anchor="middle">Clock sweep, ring buffers, and buffer pool management</text>
  
  <!-- Buffer Pool Overview -->
  <rect x="80" y="210" width="920" height="250" rx="16" fill="#3B82F6" opacity="0.1" stroke="#3B82F6" stroke-width="2"/>
  <text x="540" y="245" font-family="system-ui, sans-serif" font-size="20" font-weight="600" fill="#3B82F6" text-anchor="middle">Shared Buffer Pool</text>
  
  <!-- Buffer slots -->
  <g>
    <rect x="110" y="270" width="80" height="80" rx="8" fill="#22C55E"/>
    <text x="150" y="305" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" font-weight="600" text-anchor="middle">Buffer 1</text>
    <text x="150" y="325" font-family="monospace" font-size="8" fill="#FAFAFA" text-anchor="middle">users:5</text>
    <text x="150" y="342" font-family="system-ui, sans-serif" font-size="8" fill="#FAFAFA" text-anchor="middle">pin=2</text>
  </g>
  
  <g>
    <rect x="200" y="270" width="80" height="80" rx="8" fill="#22C55E"/>
    <text x="240" y="305" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" font-weight="600" text-anchor="middle">Buffer 2</text>
    <text x="240" y="325" font-family="monospace" font-size="8" fill="#FAFAFA" text-anchor="middle">orders:12</text>
    <text x="240" y="342" font-family="system-ui, sans-serif" font-size="8" fill="#FAFAFA" text-anchor="middle">pin=0</text>
  </g>
  
  <g>
    <rect x="290" y="270" width="80" height="80" rx="8" fill="#EF4444"/>
    <text x="330" y="305" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" font-weight="600" text-anchor="middle">Buffer 3</text>
    <text x="330" y="325" font-family="monospace" font-size="8" fill="#FAFAFA" text-anchor="middle">users:8</text>
    <text x="330" y="342" font-family="system-ui, sans-serif" font-size="8" fill="#FAFAFA" text-anchor="middle">DIRTY</text>
  </g>
  
  <g>
    <rect x="380" y="270" width="80" height="80" rx="8" fill="#71717A"/>
    <text x="420" y="305" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" font-weight="600" text-anchor="middle">Buffer 4</text>
    <text x="420" y="325" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">FREE</text>
  </g>
  
  <g>
    <rect x="470" y="270" width="80" height="80" rx="8" fill="#22C55E"/>
    <text x="510" y="305" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" font-weight="600" text-anchor="middle">Buffer 5</text>
    <text x="510" y="325" font-family="monospace" font-size="8" fill="#FAFAFA" text-anchor="middle">idx:3</text>
    <text x="510" y="342" font-family="system-ui, sans-serif" font-size="8" fill="#FAFAFA" text-anchor="middle">pin=1</text>
  </g>
  
  <g>
    <rect x="560" y="270" width="80" height="80" rx="8" fill="#EF4444"/>
    <text x="600" y="305" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" font-weight="600" text-anchor="middle">Buffer 6</text>
    <text x="600" y="325" font-family="monospace" font-size="8" fill="#FAFAFA" text-anchor="middle">orders:1</text>
    <text x="600" y="342" font-family="system-ui, sans-serif" font-size="8" fill="#FAFAFA" text-anchor="middle">DIRTY</text>
  </g>
  
  <text x="680" y="320" font-family="system-ui, sans-serif" font-size="24" fill="#71717A" text-anchor="middle">...</text>
  
  <g>
    <rect x="720" y="270" width="80" height="80" rx="8" fill="#22C55E"/>
    <text x="760" y="305" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" font-weight="600" text-anchor="middle">Buffer N</text>
    <text x="760" y="325" font-family="monospace" font-size="8" fill="#FAFAFA" text-anchor="middle">logs:99</text>
    <text x="760" y="342" font-family="system-ui, sans-serif" font-size="8" fill="#FAFAFA" text-anchor="middle">pin=0</text>
  </g>
  
  <!-- Legend -->
  <rect x="830" y="270" width="150" height="80" rx="8" fill="#FAFAFA" stroke="#18181B"/>
  <circle cx="855" cy="292" r="8" fill="#22C55E"/>
  <text x="870" y="296" font-family="system-ui, sans-serif" font-size="10" fill="#18181B">Clean buffer</text>
  <circle cx="855" cy="316" r="8" fill="#EF4444"/>
  <text x="870" y="320" font-family="system-ui, sans-serif" font-size="10" fill="#18181B">Dirty buffer</text>
  <circle cx="855" cy="340" r="8" fill="#71717A"/>
  <text x="870" y="344" font-family="system-ui, sans-serif" font-size="10" fill="#18181B">Free slot</text>
  
  <!-- Hash table & descriptors -->
  <rect x="110" y="365" width="380" height="80" rx="8" fill="#3B82F6"/>
  <text x="300" y="395" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">Buffer Hash Table</text>
  <text x="300" y="420" font-family="system-ui, sans-serif" font-size="11" fill="#FAFAFA" text-anchor="middle">(relfilenode, fork, block) → buffer_id</text>
  <text x="300" y="440" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">O(1) lookup for cached pages</text>
  
  <rect x="510" y="365" width="380" height="80" rx="8" fill="#A855F7"/>
  <text x="700" y="395" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">Buffer Descriptors</text>
  <text x="700" y="420" font-family="system-ui, sans-serif" font-size="11" fill="#FAFAFA" text-anchor="middle">tag, state, usage_count, refcount, content_lock</text>
  <text x="700" y="440" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Metadata for each buffer slot</text>
  
  <!-- Clock Sweep Algorithm -->
  <rect x="80" y="480" width="440" height="280" rx="16" fill="#22C55E" opacity="0.1" stroke="#22C55E" stroke-width="2"/>
  <text x="300" y="515" font-family="system-ui, sans-serif" font-size="18" font-weight="600" fill="#22C55E" text-anchor="middle">Clock Sweep Eviction</text>
  
  <!-- Clock visualization -->
  <circle cx="300" cy="640" r="100" fill="none" stroke="#22C55E" stroke-width="3"/>
  
  <!-- Clock hand -->
  <line x1="300" y1="640" x2="300" y2="560" stroke="#EF4444" stroke-width="4" stroke-linecap="round"/>
  <circle cx="300" cy="640" r="8" fill="#EF4444"/>
  
  <!-- Buffer slots around clock -->
  <rect x="280" y="530" width="40" height="25" rx="4" fill="#22C55E"/>
  <text x="300" y="548" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">u=3</text>
  
  <rect x="365" y="565" width="40" height="25" rx="4" fill="#22C55E"/>
  <text x="385" y="583" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">u=1</text>
  
  <rect x="390" y="625" width="40" height="25" rx="4" fill="#71717A"/>
  <text x="410" y="643" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">u=0</text>
  
  <rect x="365" y="690" width="40" height="25" rx="4" fill="#22C55E"/>
  <text x="385" y="708" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">u=2</text>
  
  <rect x="280" y="725" width="40" height="25" rx="4" fill="#EF4444"/>
  <text x="300" y="743" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">u=1</text>
  
  <rect x="195" y="690" width="40" height="25" rx="4" fill="#22C55E"/>
  <text x="215" y="708" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">u=5</text>
  
  <rect x="170" y="625" width="40" height="25" rx="4" fill="#22C55E"/>
  <text x="190" y="643" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">u=0</text>
  
  <rect x="195" y="565" width="40" height="25" rx="4" fill="#22C55E"/>
  <text x="215" y="583" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">u=2</text>
  
  <text x="300" y="770" font-family="system-ui, sans-serif" font-size="10" fill="#71717A" text-anchor="middle">u = usage_count • Decrement on pass • Evict when u=0</text>
  
  <!-- Ring Buffers -->
  <rect x="560" y="480" width="440" height="280" rx="16" fill="#F97316" opacity="0.1" stroke="#F97316" stroke-width="2"/>
  <text x="780" y="515" font-family="system-ui, sans-serif" font-size="18" font-weight="600" fill="#F97316" text-anchor="middle">Ring Buffer Strategies</text>
  
  <!-- Ring buffer types -->
  <rect x="590" y="540" width="180" height="90" rx="8" fill="#F97316"/>
  <text x="680" y="570" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">Bulk Read</text>
  <text x="680" y="595" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Sequential scans</text>
  <text x="680" y="615" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">256KB ring (32 buffers)</text>
  
  <rect x="790" y="540" width="180" height="90" rx="8" fill="#3B82F6"/>
  <text x="880" y="570" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">Bulk Write</text>
  <text x="880" y="595" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">COPY, CREATE INDEX</text>
  <text x="880" y="615" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">16MB ring (2048 buffers)</text>
  
  <rect x="590" y="645" width="180" height="90" rx="8" fill="#A855F7"/>
  <text x="680" y="675" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">VACUUM</text>
  <text x="680" y="700" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Cleanup operations</text>
  <text x="680" y="720" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">256KB ring</text>
  
  <rect x="790" y="645" width="180" height="90" rx="8" fill="#22C55E"/>
  <text x="880" y="675" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">Purpose</text>
  <text x="880" y="700" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Prevents cache</text>
  <text x="880" y="720" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">pollution from scans</text>
  
  <!-- Background Processes -->
  <rect x="80" y="780" width="920" height="180" rx="16" fill="#18181B" opacity="0.1" stroke="#18181B" stroke-width="2"/>
  <text x="540" y="815" font-family="system-ui, sans-serif" font-size="18" font-weight="600" fill="#18181B" text-anchor="middle">Background Processes</text>
  
  <rect x="110" y="840" width="200" height="100" rx="8" fill="#3B82F6"/>
  <text x="210" y="875" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">Background Writer</text>
  <text x="210" y="900" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Writes dirty buffers</text>
  <text x="210" y="920" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">continuously to disk</text>
  
  <rect x="330" y="840" width="200" height="100" rx="8" fill="#A855F7"/>
  <text x="430" y="875" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">Checkpointer</text>
  <text x="430" y="900" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Periodic full sync</text>
  <text x="430" y="920" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">All dirty → disk</text>
  
  <rect x="550" y="840" width="200" height="100" rx="8" fill="#22C55E"/>
  <text x="650" y="875" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">pg_prewarm</text>
  <text x="650" y="900" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Preload tables into</text>
  <text x="650" y="920" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">buffer cache</text>
  
  <rect x="770" y="840" width="200" height="100" rx="8" fill="#18181B"/>
  <text x="870" y="875" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">Cache Hit Ratio</text>
  <text x="870" y="900" font-family="system-ui, sans-serif" font-size="10" fill="#71717A" text-anchor="middle">Target: > 99%</text>
  <text x="870" y="920" font-family="monospace" font-size="9" fill="#FAFAFA" text-anchor="middle">pg_stat_user_tables</text>
  
  <!-- Footer -->
  <text x="540" y="1040" font-family="system-ui, sans-serif" font-size="14" fill="#71717A" text-anchor="middle">@devweekends</text>
</svg>