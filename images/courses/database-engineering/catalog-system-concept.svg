<svg viewBox="0 0 1080 1080" xmlns="http://www.w3.org/2000/svg">
  <rect width="1080" height="1080" fill="#FAFAFA"/>
  
  <!-- Branding -->
  <text x="60" y="80" font-family="system-ui, sans-serif" font-size="14" font-weight="600" fill="#18181B" letter-spacing="3">DEV WEEKENDS</text>
  
  <!-- Title -->
  <text x="540" y="140" font-family="system-ui, sans-serif" font-size="36" font-weight="700" fill="#18181B" text-anchor="middle">Catalog System Deep Dive</text>
  <text x="540" y="175" font-family="system-ui, sans-serif" font-size="18" fill="#71717A" text-anchor="middle">System catalogs, caching, and invalidation mechanisms</text>
  
  <!-- Core Catalogs -->
  <rect x="80" y="210" width="440" height="350" rx="16" fill="#3B82F6" opacity="0.1" stroke="#3B82F6" stroke-width="2"/>
  <text x="300" y="245" font-family="system-ui, sans-serif" font-size="18" font-weight="600" fill="#3B82F6" text-anchor="middle">Core System Catalogs</text>
  
  <!-- pg_class -->
  <rect x="110" y="270" width="180" height="90" rx="8" fill="#3B82F6"/>
  <text x="200" y="300" font-family="monospace" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">pg_class</text>
  <text x="200" y="320" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Tables, indexes, views</text>
  <text x="200" y="340" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">sequences, TOAST</text>
  <text x="200" y="355" font-family="monospace" font-size="8" fill="#FAFAFA" text-anchor="middle">relkind: r/i/v/S/t</text>
  
  <!-- Arrow from pg_class -->
  <path d="M200 365 L200 395" stroke="#18181B" stroke-width="2" marker-end="url(#arrow)"/>
  
  <!-- pg_attribute -->
  <rect x="110" y="400" width="180" height="75" rx="8" fill="#22C55E"/>
  <text x="200" y="425" font-family="monospace" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">pg_attribute</text>
  <text x="200" y="448" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Column definitions</text>
  <text x="200" y="468" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">attrelid → pg_class</text>
  
  <!-- pg_type -->
  <rect x="310" y="270" width="180" height="90" rx="8" fill="#A855F7"/>
  <text x="400" y="300" font-family="monospace" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">pg_type</text>
  <text x="400" y="320" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">All data types</text>
  <text x="400" y="340" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Base, composite, array</text>
  <text x="400" y="355" font-family="monospace" font-size="8" fill="#FAFAFA" text-anchor="middle">typtype: b/c/d/e/p</text>
  
  <!-- pg_proc -->
  <rect x="310" y="400" width="180" height="75" rx="8" fill="#F97316"/>
  <text x="400" y="425" font-family="monospace" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">pg_proc</text>
  <text x="400" y="448" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Functions, procedures</text>
  <text x="400" y="468" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">prokind: f/p/a/w</text>
  
  <!-- More catalogs -->
  <rect x="110" y="490" width="120" height="55" rx="6" fill="#18181B"/>
  <text x="170" y="515" font-family="monospace" font-size="10" fill="#FAFAFA" text-anchor="middle">pg_index</text>
  <text x="170" y="535" font-family="system-ui, sans-serif" font-size="8" fill="#71717A" text-anchor="middle">Index info</text>
  
  <rect x="240" y="490" width="120" height="55" rx="6" fill="#18181B"/>
  <text x="300" y="515" font-family="monospace" font-size="10" fill="#FAFAFA" text-anchor="middle">pg_namespace</text>
  <text x="300" y="535" font-family="system-ui, sans-serif" font-size="8" fill="#71717A" text-anchor="middle">Schemas</text>
  
  <rect x="370" y="490" width="120" height="55" rx="6" fill="#18181B"/>
  <text x="430" y="515" font-family="monospace" font-size="10" fill="#FAFAFA" text-anchor="middle">pg_depend</text>
  <text x="430" y="535" font-family="system-ui, sans-serif" font-size="8" fill="#71717A" text-anchor="middle">Dependencies</text>
  
  <!-- Caching Architecture -->
  <rect x="560" y="210" width="440" height="350" rx="16" fill="#22C55E" opacity="0.1" stroke="#22C55E" stroke-width="2"/>
  <text x="780" y="245" font-family="system-ui, sans-serif" font-size="18" font-weight="600" fill="#22C55E" text-anchor="middle">Catalog Caching</text>
  
  <!-- On-disk -->
  <rect x="590" y="270" width="150" height="70" rx="8" fill="#71717A"/>
  <text x="665" y="300" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">Disk (pg_class)</text>
  <text x="665" y="325" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Slow access</text>
  
  <!-- Arrow -->
  <path d="M745 305 L795 305" stroke="#18181B" stroke-width="2" marker-end="url(#arrow)"/>
  <text x="770" y="295" font-family="system-ui, sans-serif" font-size="9" fill="#71717A" text-anchor="middle">load</text>
  
  <!-- SysCache -->
  <rect x="800" y="270" width="170" height="70" rx="8" fill="#22C55E"/>
  <text x="885" y="300" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">SysCache</text>
  <text x="885" y="325" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Hash-based lookup</text>
  
  <!-- RelCache -->
  <rect x="590" y="360" width="380" height="90" rx="10" fill="#3B82F6"/>
  <text x="780" y="395" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">RelCache (Relation Cache)</text>
  <text x="780" y="420" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Full relation metadata • TupleDesc • Indexes • Triggers</text>
  <text x="780" y="440" font-family="monospace" font-size="9" fill="#FAFAFA" text-anchor="middle">table_open() → RelationData struct</text>
  
  <!-- TypeCache -->
  <rect x="590" y="465" width="180" height="75" rx="8" fill="#A855F7"/>
  <text x="680" y="495" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">TypeCache</text>
  <text x="680" y="520" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">Type operators, hash</text>
  <text x="680" y="535" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">functions</text>
  
  <!-- CatCache note -->
  <rect x="790" y="465" width="180" height="75" rx="8" fill="#F97316"/>
  <text x="880" y="495" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">Per-Backend</text>
  <text x="880" y="520" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">Each process has</text>
  <text x="880" y="535" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">own cache copy</text>
  
  <!-- Cache Invalidation -->
  <rect x="80" y="580" width="920" height="200" rx="16" fill="#EF4444" opacity="0.1" stroke="#EF4444" stroke-width="2"/>
  <text x="540" y="615" font-family="system-ui, sans-serif" font-size="20" font-weight="700" fill="#EF4444" text-anchor="middle">Cache Invalidation (sinval)</text>
  
  <!-- Invalidation flow -->
  <rect x="110" y="645" width="180" height="110" rx="10" fill="#22C55E"/>
  <text x="200" y="680" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">Backend A</text>
  <text x="200" y="705" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">ALTER TABLE ...</text>
  <text x="200" y="730" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Modify pg_class</text>
  <text x="200" y="750" font-family="monospace" font-size="8" fill="#FAFAFA" text-anchor="middle">COMMIT</text>
  
  <path d="M295 700 L345 700" stroke="#EF4444" stroke-width="2" marker-end="url(#arrowRed)"/>
  
  <rect x="350" y="645" width="180" height="110" rx="10" fill="#EF4444"/>
  <text x="440" y="680" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">Sinval Queue</text>
  <text x="440" y="705" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Shared memory</text>
  <text x="440" y="730" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">message queue</text>
  <text x="440" y="750" font-family="monospace" font-size="8" fill="#FAFAFA" text-anchor="middle">(relid, catId)</text>
  
  <path d="M535 680 L585 650" stroke="#EF4444" stroke-width="2" marker-end="url(#arrowRed)"/>
  <path d="M535 700 L585 700" stroke="#EF4444" stroke-width="2" marker-end="url(#arrowRed)"/>
  <path d="M535 720 L585 750" stroke="#EF4444" stroke-width="2" marker-end="url(#arrowRed)"/>
  
  <rect x="590" y="635" width="130" height="50" rx="8" fill="#3B82F6"/>
  <text x="655" y="665" font-family="system-ui, sans-serif" font-size="11" fill="#FAFAFA" font-weight="600" text-anchor="middle">Backend B</text>
  
  <rect x="590" y="695" width="130" height="50" rx="8" fill="#3B82F6"/>
  <text x="655" y="725" font-family="system-ui, sans-serif" font-size="11" fill="#FAFAFA" font-weight="600" text-anchor="middle">Backend C</text>
  
  <rect x="590" y="755" width="130" height="50" rx="8" fill="#3B82F6"/>
  <text x="655" y="785" font-family="system-ui, sans-serif" font-size="11" fill="#FAFAFA" font-weight="600" text-anchor="middle">Backend D</text>
  
  <!-- Result -->
  <rect x="750" y="660" width="230" height="90" rx="10" fill="#A855F7"/>
  <text x="865" y="695" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">Process Messages</text>
  <text x="865" y="720" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">At command boundaries</text>
  <text x="865" y="740" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Invalidate + rebuild cache</text>
  
  <!-- Statistics -->
  <rect x="80" y="800" width="440" height="160" rx="16" fill="#A855F7" opacity="0.1" stroke="#A855F7" stroke-width="2"/>
  <text x="300" y="835" font-family="system-ui, sans-serif" font-size="18" font-weight="600" fill="#A855F7" text-anchor="middle">pg_statistic</text>
  
  <rect x="110" y="860" width="190" height="80" rx="8" fill="#A855F7"/>
  <text x="205" y="890" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">Column Statistics</text>
  <text x="205" y="915" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">null_frac, n_distinct</text>
  <text x="205" y="935" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">histogram_bounds, mcv</text>
  
  <rect x="320" y="860" width="190" height="80" rx="8" fill="#3B82F6"/>
  <text x="415" y="890" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">Extended Stats</text>
  <text x="415" y="915" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">Multi-column stats</text>
  <text x="415" y="935" font-family="monospace" font-size="8" fill="#FAFAFA" text-anchor="middle">CREATE STATISTICS</text>
  
  <!-- Dependencies -->
  <rect x="560" y="800" width="440" height="160" rx="16" fill="#18181B" opacity="0.1" stroke="#18181B" stroke-width="2"/>
  <text x="780" y="835" font-family="system-ui, sans-serif" font-size="18" font-weight="600" fill="#18181B" text-anchor="middle">pg_depend</text>
  
  <rect x="590" y="860" width="190" height="80" rx="8" fill="#18181B"/>
  <text x="685" y="890" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">DROP CASCADE</text>
  <text x="685" y="915" font-family="system-ui, sans-serif" font-size="9" fill="#71717A" text-anchor="middle">Tracks object deps</text>
  <text x="685" y="935" font-family="monospace" font-size="8" fill="#FAFAFA" text-anchor="middle">deptype: n/a/i/e</text>
  
  <rect x="800" y="860" width="190" height="80" rx="8" fill="#22C55E"/>
  <text x="895" y="890" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">Query by pg_class</text>
  <text x="895" y="915" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">Find all dependents</text>
  <text x="895" y="935" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">of any object</text>
  
  <!-- Arrow markers -->
  <defs>
    <marker id="arrow" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#18181B"/>
    </marker>
    <marker id="arrowRed" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#EF4444"/>
    </marker>
  </defs>
  
  <!-- Footer -->
  <text x="540" y="1040" font-family="system-ui, sans-serif" font-size="14" fill="#71717A" text-anchor="middle">@devweekends</text>
</svg>