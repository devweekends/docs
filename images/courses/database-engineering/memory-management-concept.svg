<svg viewBox="0 0 1080 1080" xmlns="http://www.w3.org/2000/svg">
  <rect width="1080" height="1080" fill="#FAFAFA"/>
  
  <!-- Branding -->
  <text x="60" y="80" font-family="system-ui, sans-serif" font-size="14" font-weight="600" fill="#18181B" letter-spacing="3">DEV WEEKENDS</text>
  
  <!-- Title -->
  <text x="540" y="140" font-family="system-ui, sans-serif" font-size="36" font-weight="700" fill="#18181B" text-anchor="middle">Memory Management</text>
  <text x="540" y="175" font-family="system-ui, sans-serif" font-size="18" fill="#71717A" text-anchor="middle">Memory contexts, palloc/pfree, and shared memory architecture</text>
  
  <!-- Memory Context Tree -->
  <rect x="80" y="210" width="440" height="350" rx="16" fill="#A855F7" opacity="0.1" stroke="#A855F7" stroke-width="2"/>
  <text x="300" y="245" font-family="system-ui, sans-serif" font-size="18" font-weight="600" fill="#A855F7" text-anchor="middle">Memory Context Hierarchy</text>
  
  <!-- TopMemoryContext -->
  <rect x="200" y="270" width="200" height="45" rx="8" fill="#A855F7"/>
  <text x="300" y="298" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">TopMemoryContext</text>
  
  <!-- Tree branches -->
  <path d="M250 320 L180 350" stroke="#18181B" stroke-width="2"/>
  <path d="M300 320 L300 350" stroke="#18181B" stroke-width="2"/>
  <path d="M350 320 L420 350" stroke="#18181B" stroke-width="2"/>
  
  <!-- Child contexts -->
  <rect x="110" y="355" width="140" height="40" rx="6" fill="#3B82F6"/>
  <text x="180" y="380" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" font-weight="600" text-anchor="middle">MessageContext</text>
  
  <rect x="230" y="355" width="140" height="40" rx="6" fill="#22C55E"/>
  <text x="300" y="380" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" font-weight="600" text-anchor="middle">CacheMemoryCtx</text>
  
  <rect x="350" y="355" width="140" height="40" rx="6" fill="#F97316"/>
  <text x="420" y="380" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" font-weight="600" text-anchor="middle">PortalContext</text>
  
  <!-- Sub-children -->
  <path d="M300 400 L300 420" stroke="#18181B" stroke-width="1.5"/>
  <path d="M420 400 L420 420" stroke="#18181B" stroke-width="1.5"/>
  
  <rect x="230" y="425" width="140" height="35" rx="6" fill="#22C55E" opacity="0.7"/>
  <text x="300" y="448" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">RelCache</text>
  
  <rect x="350" y="425" width="140" height="35" rx="6" fill="#F97316" opacity="0.7"/>
  <text x="420" y="448" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">QueryContext</text>
  
  <!-- More sub-children from QueryContext -->
  <path d="M400 465 L370 485" stroke="#18181B" stroke-width="1"/>
  <path d="M440 465 L470 485" stroke="#18181B" stroke-width="1"/>
  
  <rect x="300" y="490" width="100" height="30" rx="4" fill="#EF4444"/>
  <text x="350" y="510" font-family="system-ui, sans-serif" font-size="8" fill="#FAFAFA" text-anchor="middle">ExecutorState</text>
  
  <rect x="420" y="490" width="100" height="30" rx="4" fill="#EF4444"/>
  <text x="470" y="510" font-family="system-ui, sans-serif" font-size="8" fill="#FAFAFA" text-anchor="middle">ExprContext</text>
  
  <text x="300" y="550" font-family="system-ui, sans-serif" font-size="10" fill="#71717A" text-anchor="middle">Reset/delete parent → frees all children</text>
  
  <!-- Allocator Types -->
  <rect x="560" y="210" width="440" height="175" rx="16" fill="#22C55E" opacity="0.1" stroke="#22C55E" stroke-width="2"/>
  <text x="780" y="245" font-family="system-ui, sans-serif" font-size="18" font-weight="600" fill="#22C55E" text-anchor="middle">Allocator Types</text>
  
  <rect x="590" y="270" width="120" height="95" rx="8" fill="#22C55E"/>
  <text x="650" y="300" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">AllocSet</text>
  <text x="650" y="320" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">General purpose</text>
  <text x="650" y="338" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">Power-of-2</text>
  <text x="650" y="356" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">Free lists</text>
  
  <rect x="720" y="270" width="120" height="95" rx="8" fill="#3B82F6"/>
  <text x="780" y="300" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">Generation</text>
  <text x="780" y="320" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">Append-only</text>
  <text x="780" y="338" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">No individual</text>
  <text x="780" y="356" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">frees</text>
  
  <rect x="850" y="270" width="120" height="95" rx="8" fill="#F97316"/>
  <text x="910" y="300" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">Slab</text>
  <text x="910" y="320" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">Fixed-size</text>
  <text x="910" y="338" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">chunks only</text>
  <text x="910" y="356" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">No fragmentation</text>
  
  <!-- palloc API -->
  <rect x="560" y="400" width="440" height="160" rx="16" fill="#18181B" opacity="0.1" stroke="#18181B" stroke-width="2"/>
  <text x="780" y="435" font-family="system-ui, sans-serif" font-size="18" font-weight="600" fill="#18181B" text-anchor="middle">Memory API</text>
  
  <rect x="590" y="460" width="190" height="80" rx="8" fill="#22C55E"/>
  <text x="685" y="490" font-family="monospace" font-size="11" fill="#FAFAFA" text-anchor="middle">palloc(size)</text>
  <text x="685" y="515" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">Allocate in current context</text>
  <text x="685" y="532" font-family="monospace" font-size="9" fill="#FAFAFA" text-anchor="middle">palloc0() → zeroed</text>
  
  <rect x="800" y="460" width="190" height="80" rx="8" fill="#EF4444"/>
  <text x="895" y="490" font-family="monospace" font-size="11" fill="#FAFAFA" text-anchor="middle">pfree(ptr)</text>
  <text x="895" y="515" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">Optional! Context reset</text>
  <text x="895" y="532" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">frees everything</text>
  
  <!-- Shared Memory -->
  <rect x="80" y="580" width="920" height="200" rx="16" fill="#3B82F6" opacity="0.1" stroke="#3B82F6" stroke-width="2"/>
  <text x="540" y="615" font-family="system-ui, sans-serif" font-size="20" font-weight="700" fill="#3B82F6" text-anchor="middle">Shared Memory Architecture</text>
  
  <!-- Shared memory regions -->
  <rect x="110" y="640" width="200" height="120" rx="10" fill="#3B82F6"/>
  <text x="210" y="675" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">shared_buffers</text>
  <text x="210" y="700" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">25-40% of RAM</text>
  <text x="210" y="720" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Data page cache</text>
  <text x="210" y="745" font-family="monospace" font-size="9" fill="#FAFAFA" text-anchor="middle">8KB pages</text>
  
  <rect x="330" y="640" width="150" height="120" rx="10" fill="#A855F7"/>
  <text x="405" y="675" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">wal_buffers</text>
  <text x="405" y="700" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">WAL write buffer</text>
  <text x="405" y="720" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">1/32 of shared</text>
  <text x="405" y="745" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">-1 = auto</text>
  
  <rect x="500" y="640" width="150" height="120" rx="10" fill="#22C55E"/>
  <text x="575" y="675" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">CLOG</text>
  <text x="575" y="700" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Commit status</text>
  <text x="575" y="720" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">2 bits/xact</text>
  <text x="575" y="745" font-family="monospace" font-size="9" fill="#FAFAFA" text-anchor="middle">pg_xact/</text>
  
  <rect x="670" y="640" width="150" height="120" rx="10" fill="#F97316"/>
  <text x="745" y="675" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">Lock Tables</text>
  <text x="745" y="700" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Lock manager</text>
  <text x="745" y="720" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">Hash partitioned</text>
  <text x="745" y="745" font-family="system-ui, sans-serif" font-size="10" fill="#FAFAFA" text-anchor="middle">16 partitions</text>
  
  <rect x="840" y="640" width="150" height="120" rx="10" fill="#18181B"/>
  <text x="915" y="675" font-family="system-ui, sans-serif" font-size="14" fill="#FAFAFA" font-weight="600" text-anchor="middle">PGPROC</text>
  <text x="915" y="700" font-family="system-ui, sans-serif" font-size="10" fill="#71717A" text-anchor="middle">Per-backend</text>
  <text x="915" y="720" font-family="system-ui, sans-serif" font-size="10" fill="#71717A" text-anchor="middle">state info</text>
  <text x="915" y="745" font-family="system-ui, sans-serif" font-size="10" fill="#71717A" text-anchor="middle">max_connections</text>
  
  <!-- Work Memory -->
  <rect x="80" y="800" width="440" height="160" rx="16" fill="#EF4444" opacity="0.1" stroke="#EF4444" stroke-width="2"/>
  <text x="300" y="835" font-family="system-ui, sans-serif" font-size="18" font-weight="600" fill="#EF4444" text-anchor="middle">Per-Operation Memory</text>
  
  <rect x="110" y="860" width="190" height="80" rx="8" fill="#EF4444"/>
  <text x="205" y="890" font-family="monospace" font-size="11" fill="#FAFAFA" text-anchor="middle">work_mem</text>
  <text x="205" y="915" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">Sorts, hashes, CTEs</text>
  <text x="205" y="935" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">Default: 4MB</text>
  
  <rect x="320" y="860" width="190" height="80" rx="8" fill="#3B82F6"/>
  <text x="415" y="890" font-family="monospace" font-size="10" fill="#FAFAFA" text-anchor="middle">maintenance_work_mem</text>
  <text x="415" y="915" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">VACUUM, CREATE INDEX</text>
  <text x="415" y="935" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">Default: 64MB</text>
  
  <!-- NUMA & Huge Pages -->
  <rect x="560" y="800" width="440" height="160" rx="16" fill="#22C55E" opacity="0.1" stroke="#22C55E" stroke-width="2"/>
  <text x="780" y="835" font-family="system-ui, sans-serif" font-size="18" font-weight="600" fill="#22C55E" text-anchor="middle">Performance Optimizations</text>
  
  <rect x="590" y="860" width="190" height="80" rx="8" fill="#22C55E"/>
  <text x="685" y="890" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">Huge Pages</text>
  <text x="685" y="915" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">2MB pages vs 4KB</text>
  <text x="685" y="935" font-family="monospace" font-size="9" fill="#FAFAFA" text-anchor="middle">huge_pages = try</text>
  
  <rect x="800" y="860" width="190" height="80" rx="8" fill="#A855F7"/>
  <text x="895" y="890" font-family="system-ui, sans-serif" font-size="12" fill="#FAFAFA" font-weight="600" text-anchor="middle">NUMA Awareness</text>
  <text x="895" y="915" font-family="system-ui, sans-serif" font-size="9" fill="#FAFAFA" text-anchor="middle">Memory locality</text>
  <text x="895" y="935" font-family="monospace" font-size="9" fill="#FAFAFA" text-anchor="middle">numactl --interleave</text>
  
  <!-- Footer -->
  <text x="540" y="1040" font-family="system-ui, sans-serif" font-size="14" fill="#71717A" text-anchor="middle">@devweekends</text>
</svg>