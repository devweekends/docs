---
title: "Compute Services"
description: "EC2, Lambda, ECS, EKS and other compute options"
icon: "microchip"
---

## Compute Overview

AWS offers various compute services for different use cases:

```
┌──────────────────────────────────────────────────────────────────┐
│                     AWS Compute Spectrum                          │
├──────────────────────────────────────────────────────────────────┤
│                                                                   │
│   More Control                                          Less Mgmt │
│   ◄─────────────────────────────────────────────────────────────► │
│                                                                   │
│   ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌────────┐ │
│   │   EC2   │  │   ECS   │  │ Fargate │  │ Lambda  │  │  App   │ │
│   │         │  │         │  │         │  │         │  │ Runner │ │
│   └─────────┘  └─────────┘  └─────────┘  └─────────┘  └────────┘ │
│       │            │            │            │            │       │
│     VMs      Containers   Serverless   Functions    Managed      │
│    (IaaS)    on EC2       Containers   (FaaS)      Containers    │
│                                                                   │
└──────────────────────────────────────────────────────────────────┘
```

---

## EC2 (Elastic Compute Cloud)

Virtual servers in the cloud. Most fundamental AWS compute service.

### Instance Types

| Family | Optimized For | Use Cases |
|--------|--------------|-----------|
| **T** (T3, T3a) | Burstable | Web servers, dev environments |
| **M** (M5, M6i) | General purpose | Application servers |
| **C** (C5, C6i) | Compute | Batch processing, gaming |
| **R** (R5, R6i) | Memory | In-memory databases, caching |
| **P/G** (P4, G4) | GPU | ML training, graphics |
| **I** (I3, I4i) | Storage | Databases, data warehousing |

### Instance Naming Convention

```
m5.xlarge
│ │  │
│ │  └── Size (nano, micro, small, medium, large, xlarge, 2xlarge...)
│ └───── Generation (higher = newer, better)
└─────── Family (m = general purpose)
```

### Launch an EC2 Instance

```bash
# Using AWS CLI
aws ec2 run-instances \
    --image-id ami-0c55b159cbfafe1f0 \
    --instance-type t3.micro \
    --key-name my-key-pair \
    --security-group-ids sg-0123456789abcdef0 \
    --subnet-id subnet-0123456789abcdef0
```

### EC2 Key Concepts

<CardGroup cols={2}>
  <Card title="AMI" icon="copy">
    Amazon Machine Image - OS template for instances
  </Card>
  <Card title="Security Groups" icon="shield">
    Virtual firewall controlling inbound/outbound traffic
  </Card>
  <Card title="Key Pairs" icon="key">
    SSH keys for secure instance access
  </Card>
  <Card title="Elastic IP" icon="network-wired">
    Static public IPv4 address
  </Card>
</CardGroup>

### EC2 User Data

Bootstrap script that runs on instance launch:

```bash
#!/bin/bash
yum update -y
yum install -y httpd
systemctl start httpd
systemctl enable httpd
echo "<h1>Hello from $(hostname)</h1>" > /var/www/html/index.html
```

### EC2 Instance Metadata

Access instance info from within the instance:

```bash
# Get instance metadata
curl http://169.254.169.254/latest/meta-data/

# Common metadata endpoints
curl http://169.254.169.254/latest/meta-data/instance-id
curl http://169.254.169.254/latest/meta-data/public-ipv4
curl http://169.254.169.254/latest/meta-data/iam/security-credentials/
```

---

## Lambda (Serverless Functions)

Run code without provisioning servers. Pay only for compute time.

### Key Features

- **Event-driven**: Triggered by AWS services or HTTP requests
- **Auto-scaling**: Handles thousands of concurrent executions
- **Pay-per-use**: Billed per millisecond of execution
- **15-minute timeout**: Maximum execution time

### Lambda Function Example

```python
import json

def lambda_handler(event, context):
    """
    event: Input data (JSON)
    context: Runtime information
    """
    name = event.get('name', 'World')
    
    return {
        'statusCode': 200,
        'body': json.dumps(f'Hello, {name}!')
    }
```

### Common Lambda Triggers

```
┌─────────────────────────────────────────────────────────────────┐
│                       Lambda Triggers                            │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌───────────┐    ┌───────────┐    ┌───────────┐               │
│   │ API       │    │    S3     │    │ DynamoDB  │               │
│   │ Gateway   │───►│  Events   │───►│  Streams  │──┐            │
│   └───────────┘    └───────────┘    └───────────┘  │            │
│                                                     ▼            │
│   ┌───────────┐    ┌───────────┐    ┌───────────────────────┐   │
│   │    SQS    │───►│    SNS    │───►│       LAMBDA          │   │
│   │  Queue    │    │   Topic   │    │      FUNCTION         │   │
│   └───────────┘    └───────────┘    └───────────────────────┘   │
│                                                     │            │
│   ┌───────────┐    ┌───────────┐    ┌───────────┐  │            │
│   │CloudWatch │    │  Kinesis  │    │EventBridge│◄─┘            │
│   │  Events   │───►│  Streams  │───►│  (Cron)   │               │
│   └───────────┘    └───────────┘    └───────────┘               │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### Lambda Pricing

```python
# Lambda pricing calculation
memory_gb = 0.5  # GB allocated
duration_ms = 200  # Execution time
requests = 1_000_000

# Price per GB-second: $0.0000166667
# Price per request: $0.20 per million

gb_seconds = (memory_gb * duration_ms / 1000) * requests
compute_cost = gb_seconds * 0.0000166667
request_cost = (requests / 1_000_000) * 0.20

total_cost = compute_cost + request_cost  # ~$1.87 for 1M requests
```

---

## ECS (Elastic Container Service)

Run Docker containers on AWS-managed infrastructure.

### ECS Architecture

```
┌────────────────────────────────────────────────────────────────┐
│                         ECS Cluster                             │
├────────────────────────────────────────────────────────────────┤
│                                                                 │
│   ┌─────────────────────────────────────────────────────────┐  │
│   │                      Service                             │  │
│   │  ┌──────────────────────────────────────────────────┐   │  │
│   │  │              Task Definition                      │   │  │
│   │  │  (CPU, Memory, Container Image, Ports, Env Vars)  │   │  │
│   │  └──────────────────────────────────────────────────┘   │  │
│   │                           │                              │  │
│   │           ┌───────────────┼───────────────┐              │  │
│   │           ▼               ▼               ▼              │  │
│   │      ┌────────┐      ┌────────┐      ┌────────┐         │  │
│   │      │  Task  │      │  Task  │      │  Task  │         │  │
│   │      │(Container)│   │(Container)│   │(Container)│      │  │
│   │      └────────┘      └────────┘      └────────┘         │  │
│   └─────────────────────────────────────────────────────────┘  │
│                                                                 │
│   Launch Types:                                                 │
│   ┌────────────────┐        ┌────────────────┐                 │
│   │    EC2         │        │    Fargate     │                 │
│   │ (You manage    │        │ (Serverless    │                 │
│   │  instances)    │        │  containers)   │                 │
│   └────────────────┘        └────────────────┘                 │
│                                                                 │
└────────────────────────────────────────────────────────────────┘
```

### Task Definition (JSON)

```json
{
  "family": "my-web-app",
  "containerDefinitions": [
    {
      "name": "web",
      "image": "nginx:latest",
      "memory": 512,
      "cpu": 256,
      "portMappings": [
        {
          "containerPort": 80,
          "hostPort": 80
        }
      ],
      "environment": [
        {
          "name": "ENV",
          "value": "production"
        }
      ]
    }
  ]
}
```

---

## EKS (Elastic Kubernetes Service)

Managed Kubernetes service for container orchestration.

### When to Use EKS vs ECS

| Feature | ECS | EKS |
|---------|-----|-----|
| Complexity | Simpler | More complex |
| Portability | AWS-specific | Kubernetes standard |
| Learning Curve | Lower | Higher |
| Ecosystem | AWS native | Rich K8s ecosystem |
| Cost | Lower | Higher (+ $0.10/hr per cluster) |

**Choose ECS**: AWS-native apps, simpler deployments
**Choose EKS**: Multi-cloud, existing K8s expertise, complex microservices

---

## Auto Scaling

Automatically adjust compute capacity based on demand.

### EC2 Auto Scaling

```
┌──────────────────────────────────────────────────────────────┐
│                    Auto Scaling Group                         │
├──────────────────────────────────────────────────────────────┤
│                                                               │
│   Min: 2    Desired: 3    Max: 10                            │
│                                                               │
│   ┌────────┐   ┌────────┐   ┌────────┐                       │
│   │  EC2   │   │  EC2   │   │  EC2   │   ← Current: 3        │
│   └────────┘   └────────┘   └────────┘                       │
│                                                               │
│   Scaling Policies:                                           │
│   • Target Tracking: Keep CPU at 50%                         │
│   • Step Scaling: Add 2 instances if CPU > 80%               │
│   • Scheduled: Scale up at 9 AM weekdays                     │
│                                                               │
└──────────────────────────────────────────────────────────────┘
```

### Scaling Policies

```python
# Target Tracking - Automatically adjusts to maintain target
{
    "PolicyName": "cpu-target-tracking",
    "PolicyType": "TargetTrackingScaling",
    "TargetTrackingConfiguration": {
        "PredefinedMetricSpecification": {
            "PredefinedMetricType": "ASGAverageCPUUtilization"
        },
        "TargetValue": 50.0  # Maintain 50% CPU
    }
}
```

---

## Comparison Table

| Feature | EC2 | Lambda | ECS | EKS |
|---------|-----|--------|-----|-----|
| **Billing** | Per hour/second | Per ms | Per EC2/Fargate | Per EC2/Fargate + cluster |
| **Max Runtime** | Unlimited | 15 min | Unlimited | Unlimited |
| **Scaling** | Manual/Auto | Automatic | Service scaling | K8s scaling |
| **Cold Start** | Minutes | Seconds | Seconds | Seconds |
| **Use Case** | Long-running apps | Event processing | Containers | K8s workloads |

<Tip>
**Best Practice**: Start with Lambda for event-driven workloads. Use EC2 for persistent, stateful applications. Use containers (ECS/EKS) for microservices architectures.
</Tip>
