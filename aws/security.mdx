---
title: "Security & IAM"
description: "Master IAM, encryption, KMS, and AWS security best practices"
icon: "shield-halved"
---

## Module Overview

<Info>
**Estimated Time**: 4-5 hours | **Difficulty**: Intermediate | **Prerequisites**: Core Concepts
</Info>

This module covers AWS security from IAM fundamentals to advanced patterns. Security is critical for the AWS certification exams and real-world architecture.

**What You'll Learn:**
- IAM users, groups, roles, and policies
- Policy evaluation logic and troubleshooting
- AWS Organizations and SCPs
- KMS encryption and key management
- Secrets management patterns
- Security monitoring and compliance
- Defense in depth strategies

---

## IAM (Identity and Access Management)

IAM controls WHO can access WHAT in your AWS account. The most fundamental AWS security service.

### IAM Components

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AWS Account                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Root User (email@company.com) - NEVER use for daily tasks    â”‚
â”‚                          â”‚                                      â”‚
â”‚                          â–¼                                      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚                        IAM                                â”‚ â”‚
â”‚   â”‚                                                           â”‚ â”‚
â”‚   â”‚   USERS            GROUPS           ROLES                 â”‚ â”‚
â”‚   â”‚   â”€â”€â”€â”€â”€            â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€                 â”‚ â”‚
â”‚   â”‚   â€¢ John           â€¢ Admins         â€¢ EC2-S3-Role         â”‚ â”‚
â”‚   â”‚   â€¢ Jane           â€¢ Developers     â€¢ Lambda-DynamoDB     â”‚ â”‚
â”‚   â”‚   â€¢ API-User       â€¢ ReadOnly       â€¢ Cross-Account       â”‚ â”‚
â”‚   â”‚                                                           â”‚ â”‚
â”‚   â”‚                    POLICIES                               â”‚ â”‚
â”‚   â”‚                    â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚ â”‚
â”‚   â”‚   â€¢ AdministratorAccess (AWS Managed)                     â”‚ â”‚
â”‚   â”‚   â€¢ S3ReadOnly (AWS Managed)                              â”‚ â”‚
â”‚   â”‚   â€¢ CustomAppPolicy (Customer Managed)                    â”‚ â”‚
â”‚   â”‚                                                           â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Users vs Roles

| Feature | IAM Users | IAM Roles |
|---------|-----------|-----------|
| **Identity** | Permanent | Temporary |
| **Credentials** | Password/Access Keys | Temporary tokens |
| **Use Case** | Humans, CI/CD | Services, cross-account |
| **Best Practice** | MFA required | Preferred for applications |

---

## IAM Policies

JSON documents that define permissions.

### Policy Structure

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "AllowS3Read",
            "Effect": "Allow",
            "Action": [
                "s3:GetObject",
                "s3:ListBucket"
            ],
            "Resource": [
                "arn:aws:s3:::my-bucket",
                "arn:aws:s3:::my-bucket/*"
            ],
            "Condition": {
                "IpAddress": {
                    "aws:SourceIp": "203.0.113.0/24"
                }
            }
        }
    ]
}
```

### Policy Elements

| Element | Description | Example |
|---------|-------------|---------|
| **Effect** | Allow or Deny | `"Effect": "Allow"` |
| **Action** | What operations | `"s3:GetObject"` |
| **Resource** | Which resources | `"arn:aws:s3:::bucket/*"` |
| **Condition** | When to apply | IP address, time, MFA |
| **Principal** | Who (for resource policies) | `"AWS": "arn:aws:iam::123:user/Bob"` |

### Common Policy Patterns

```json
// Allow EC2 to assume a role
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Principal": {
                "Service": "ec2.amazonaws.com"
            },
            "Action": "sts:AssumeRole"
        }
    ]
}

// Deny all S3 delete operations
{
    "Effect": "Deny",
    "Action": "s3:Delete*",
    "Resource": "*"
}

// Allow only with MFA
{
    "Effect": "Allow",
    "Action": "*",
    "Resource": "*",
    "Condition": {
        "Bool": {
            "aws:MultiFactorAuthPresent": "true"
        }
    }
}
```

---

## Policy Evaluation Logic

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Policy Evaluation Flow                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚                    Request comes in                             â”‚
â”‚                          â”‚                                      â”‚
â”‚                          â–¼                                      â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚
â”‚              â”‚  Explicit DENY exists? â”‚                         â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                         â”‚
â”‚                    Yes   â”‚   No                                 â”‚
â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                          â”‚
â”‚               â–¼                     â–¼                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚         â”‚  DENY   â”‚       â”‚ Explicit ALLOW     â”‚                â”‚
â”‚         â”‚ Request â”‚       â”‚    exists?         â”‚                â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                               Yes   â”‚   No                      â”‚
â”‚                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚                          â–¼                     â–¼               â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚                    â”‚  ALLOW  â”‚           â”‚  DENY   â”‚           â”‚
â”‚                    â”‚ Request â”‚           â”‚(implicit)â”‚           â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â”‚                                                                 â”‚
â”‚   Key: Explicit DENY always wins!                               â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## IAM Roles for Services

Allow AWS services to access other AWS resources.

### EC2 Instance Profile

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   EC2 with IAM Role                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                      EC2 Instance                        â”‚  â”‚
â”‚   â”‚                                                          â”‚  â”‚
â”‚   â”‚   Instance Profile                                       â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚   â”‚   â”‚              IAM Role                             â”‚  â”‚  â”‚
â”‚   â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”‚
â”‚   â”‚   â”‚  â”‚           Attached Policy                   â”‚  â”‚  â”‚  â”‚
â”‚   â”‚   â”‚  â”‚  â€¢ s3:GetObject on my-bucket               â”‚  â”‚  â”‚  â”‚
â”‚   â”‚   â”‚  â”‚  â€¢ dynamodb:* on my-table                  â”‚  â”‚  â”‚  â”‚
â”‚   â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚   â”‚                                                          â”‚  â”‚
â”‚   â”‚   Application code uses SDK - no credentials needed!     â”‚  â”‚
â”‚   â”‚   boto3.client('s3')  # Automatically uses role          â”‚  â”‚
â”‚   â”‚                                                          â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```python
import boto3

# On EC2 with role - credentials automatically retrieved
s3 = boto3.client('s3')  # No access keys needed!

# SDK automatically calls instance metadata service:
# curl http://169.254.169.254/latest/meta-data/iam/security-credentials/MyRole
```

---

## AWS Organizations

Manage multiple AWS accounts centrally.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     AWS Organizations                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Management Account (Root)                                     â”‚
â”‚           â”‚                                                     â”‚
â”‚           â”œâ”€â”€ OU: Production                                    â”‚
â”‚           â”‚       â”œâ”€â”€ Account: Prod-App1                        â”‚
â”‚           â”‚       â””â”€â”€ Account: Prod-App2                        â”‚
â”‚           â”‚                                                     â”‚
â”‚           â”œâ”€â”€ OU: Development                                   â”‚
â”‚           â”‚       â”œâ”€â”€ Account: Dev                              â”‚
â”‚           â”‚       â””â”€â”€ Account: Staging                          â”‚
â”‚           â”‚                                                     â”‚
â”‚           â””â”€â”€ OU: Security                                      â”‚
â”‚                   â”œâ”€â”€ Account: Audit                            â”‚
â”‚                   â””â”€â”€ Account: Log-Archive                      â”‚
â”‚                                                                 â”‚
â”‚   Service Control Policies (SCPs)                               â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                 â”‚
â”‚   â€¢ Apply guardrails across OUs/Accounts                        â”‚
â”‚   â€¢ Cannot grant permissions, only restrict                     â”‚
â”‚   â€¢ Example: Deny leaving organization                          â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Encryption

### Encryption at Rest

| Service | Encryption Method |
|---------|-------------------|
| S3 | SSE-S3, SSE-KMS, SSE-C |
| EBS | AES-256 with KMS |
| RDS | AES-256 with KMS |
| DynamoDB | AWS owned or KMS |

### Encryption in Transit

- **TLS/SSL** for all API calls
- **HTTPS** endpoints
- **VPN** for hybrid connectivity

### AWS KMS (Key Management Service)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         AWS KMS                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                 â”‚
â”‚   Key Types:                                                    â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â”‚
â”‚   â€¢ AWS Managed Keys (aws/s3, aws/ebs)                         â”‚
â”‚     - Automatic rotation                                        â”‚
â”‚     - Cannot control policies                                   â”‚
â”‚                                                                 â”‚
â”‚   â€¢ Customer Managed Keys (CMK)                                 â”‚
â”‚     - You control key policies                                  â”‚
â”‚     - Optional automatic rotation (yearly)                      â”‚
â”‚     - Audit via CloudTrail                                      â”‚
â”‚                                                                 â”‚
â”‚   â€¢ Customer Managed Keys (External)                            â”‚
â”‚     - Bring your own key material                               â”‚
â”‚     - You manage rotation                                       â”‚
â”‚                                                                 â”‚
â”‚   Envelope Encryption:                                          â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚  CMK encrypts â†’ Data Key                               â”‚    â”‚
â”‚   â”‚  Data Key encrypts â†’ Your Data                         â”‚    â”‚
â”‚   â”‚                                                        â”‚    â”‚
â”‚   â”‚  Store: [Encrypted Data Key] + [Encrypted Data]        â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security Best Practices

<CardGroup cols={2}>
  <Card title="Enable MFA" icon="fingerprint">
    Require MFA for root and privileged users
  </Card>
  <Card title="Least Privilege" icon="minimize">
    Grant only necessary permissions
  </Card>
  <Card title="Use Roles" icon="id-card">
    Prefer roles over long-term credentials
  </Card>
  <Card title="Rotate Keys" icon="rotate">
    Regularly rotate access keys
  </Card>
  <Card title="Enable CloudTrail" icon="shoe-prints">
    Log all API calls for auditing
  </Card>
  <Card title="Use SCPs" icon="building-shield">
    Enforce guardrails across accounts
  </Card>
</CardGroup>

### Security Checklist

```python
security_checklist = {
    "identity": [
        "âœ“ MFA on root account",
        "âœ“ No access keys on root",
        "âœ“ Individual IAM users (no sharing)",
        "âœ“ Groups for permissions",
        "âœ“ Strong password policy",
    ],
    "access": [
        "âœ“ Least privilege policies",
        "âœ“ Roles for applications",
        "âœ“ Regular access reviews",
        "âœ“ Remove unused credentials",
    ],
    "monitoring": [
        "âœ“ CloudTrail enabled (all regions)",
        "âœ“ Config rules for compliance",
        "âœ“ GuardDuty for threat detection",
        "âœ“ Security Hub for findings",
    ],
    "network": [
        "âœ“ Private subnets for databases",
        "âœ“ Security groups (least privilege)",
        "âœ“ VPC Flow Logs enabled",
        "âœ“ WAF for public applications",
    ],
    "data": [
        "âœ“ Encryption at rest (KMS)",
        "âœ“ Encryption in transit (TLS)",
        "âœ“ S3 Block Public Access",
        "âœ“ Backup and recovery tested",
    ]
}
```

---

## Security Services Overview

| Service | Purpose |
|---------|---------|
| **IAM** | Identity and access management |
| **KMS** | Key management for encryption |
| **Secrets Manager** | Store and rotate secrets |
| **CloudTrail** | API activity logging |
| **Config** | Resource compliance monitoring |
| **GuardDuty** | Threat detection |
| **Security Hub** | Security findings aggregation |
| **WAF** | Web Application Firewall |
| **Shield** | DDoS protection |
| **Inspector** | Vulnerability scanning |
| **Macie** | Sensitive data discovery |

<Tip>
**Golden Rule**: Never hardcode credentials in code. Use IAM roles for services, Secrets Manager for applications, and environment variables only for local development.
</Tip>

---

## ğŸ¯ Interview Questions

<AccordionGroup>
  <Accordion title="Q1: Explain the difference between IAM Users and Roles">
    **IAM Users:**
    - Permanent identities with long-term credentials
    - Password and/or access keys
    - Used for humans or CI/CD systems
    - Should always have MFA enabled
    
    **IAM Roles:**
    - Temporary credentials (15 min - 12 hours)
    - No password/keys stored
    - Assumed by users, services, or external identities
    - Preferred for applications
    
    **When to use each:**
    - User: Human access to AWS Console
    - Role: EC2, Lambda, cross-account access, SSO
  </Accordion>
  
  <Accordion title="Q2: How does IAM policy evaluation work?">
    **Evaluation order:**
    1. All applicable policies collected
    2. Check for explicit DENY â†’ DENY wins
    3. Check for explicit ALLOW â†’ ALLOW
    4. No match â†’ Implicit DENY
    
    **Key rules:**
    - Explicit DENY always wins
    - Must have explicit ALLOW to proceed
    - Default is implicit DENY
    
    **Policy types evaluated:**
    1. SCPs (Organizations)
    2. Identity-based policies
    3. Resource-based policies
    4. Permission boundaries
    5. Session policies
  </Accordion>
  
  <Accordion title="Q3: How would you implement least privilege?">
    **Strategy:**
    
    1. **Start with zero access**, add as needed
    
    2. **Use managed policies** for common patterns
    
    3. **Use conditions** to narrow scope:
       ```json
       "Condition": {
         "StringEquals": {"aws:RequestedRegion": "us-east-1"},
         "Bool": {"aws:MultiFactorAuthPresent": "true"}
       }
       ```
    
    4. **Use resource-level permissions**:
       ```json
       "Resource": "arn:aws:s3:::my-bucket/users/${aws:username}/*"
       ```
    
    5. **Regular access reviews** with IAM Access Analyzer
    
    6. **Permission boundaries** to cap maximum permissions
  </Accordion>
  
  <Accordion title="Q4: How do you securely manage secrets in AWS?">
    **Options (in order of preference):**
    
    1. **IAM Roles** (no secrets needed)
       - Best for AWS service-to-service
    
    2. **Secrets Manager**
       - Automatic rotation
       - RDS/Aurora integration
       - $0.40/secret/month
    
    3. **Parameter Store (SecureString)**
       - Free tier available
       - KMS encryption
       - No auto-rotation
    
    4. **Environment Variables**
       - Okay for non-sensitive config
       - Never for passwords/API keys
    
    **Anti-patterns:**
    - âŒ Hardcoded in source code
    - âŒ Committed to git
    - âŒ Stored in unencrypted files
  </Accordion>
  
  <Accordion title="Q5: Explain cross-account access with IAM roles">
    **Scenario:** Account A needs to access S3 in Account B
    
    **Setup:**
    
    1. **Account B**: Create role with trust policy
    ```json
    {
      "Principal": {"AWS": "arn:aws:iam::ACCOUNT_A:root"},
      "Action": "sts:AssumeRole",
      "Condition": {"StringEquals": {"sts:ExternalId": "secret123"}}
    }
    ```
    
    2. **Account B**: Attach S3 permissions to role
    
    3. **Account A**: IAM policy allowing sts:AssumeRole
    
    4. **Account A**: Application assumes role
    ```python
    sts = boto3.client('sts')
    credentials = sts.assume_role(
        RoleArn='arn:aws:iam::ACCOUNT_B:role/CrossAccountRole',
        RoleSessionName='MySession',
        ExternalId='secret123'
    )
    ```
  </Accordion>
</AccordionGroup>

---

## ğŸ§ª Hands-On Lab: Secure Application Setup

**Objective**: Configure secure access for a web application with proper IAM roles

<Steps>
  <Step title="Create IAM Role for EC2">
    Attach policy for S3 read, DynamoDB access
  </Step>
  
  <Step title="Create Application Secrets">
    Store database password in Secrets Manager with rotation
  </Step>
  
  <Step title="Configure KMS Key">
    Create CMK for application encryption, define key policy
  </Step>
  
  <Step title="Enable CloudTrail">
    Enable in all regions, log to S3 with encryption
  </Step>
  
  <Step title="Configure Access Analyzer">
    Find and fix overly permissive policies
  </Step>
</Steps>

---

## Security Quick Reference

```python
# Security configuration checklist
security_config = {
    "account_level": {
        "mfa_on_root": True,
        "no_root_access_keys": True,
        "cloudtrail_all_regions": True,
        "config_enabled": True,
        "guardduty_enabled": True,
    },
    "iam_policies": {
        "least_privilege": True,
        "use_roles_not_keys": True,
        "mfa_for_privileged": True,
        "regular_access_review": True,
    },
    "encryption": {
        "s3_default_encryption": True,
        "ebs_default_encryption": True,
        "rds_encryption": True,
        "secrets_in_secrets_manager": True,
    },
    "network": {
        "vpc_flow_logs": True,
        "security_group_review": True,
        "waf_for_public_apps": True,
    }
}
```

---

## Next Module

<Card title="Well-Architected Framework" icon="building" href="/aws/well-architected">
  Learn the 6 pillars of AWS Well-Architected Framework
</Card>
