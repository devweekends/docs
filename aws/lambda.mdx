---
title: "AWS Lambda"
description: "Master serverless compute with Lambda execution model, triggers, layers, optimization, and production patterns"
icon: "bolt"
---

<Frame>
  <img src="/images/aws/lambda-architecture.svg" alt="AWS Lambda Architecture" />
</Frame>

## Module Overview

<Info>
**Estimated Time**: 4-5 hours | **Difficulty**: Intermediate | **Prerequisites**: Core Concepts
</Info>

AWS Lambda is the foundation of serverless computing on AWS. This module covers everything from basic function creation to advanced optimization patterns used in production.

**What You'll Learn:**
- Lambda execution model and lifecycle
- Event sources and triggers
- Lambda Layers and custom runtimes
- Cold starts and performance optimization
- VPC configuration and networking
- Concurrency and scaling
- Best practices and production patterns
- Cost optimization strategies

---

## Why Lambda?

<CardGroup cols={2}>
  <Card title="No Servers" icon="server">
    Zero infrastructure managementâ€”AWS handles all server provisioning and maintenance
  </Card>
  <Card title="Auto-Scaling" icon="arrows-up-down">
    Scales automatically from zero to thousands of concurrent executions
  </Card>
  <Card title="Pay Per Use" icon="coins">
    Pay only for compute timeâ€”no charges when code isn't running
  </Card>
  <Card title="Event-Driven" icon="bolt">
    Integrates with 200+ AWS services as event sources
  </Card>
</CardGroup>

---

## Lambda Execution Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Lambda Execution Lifecycle                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                     COLD START                                   â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚   â”‚  â”‚ Download  â”‚  â”‚ Start      â”‚  â”‚ Initialize  â”‚  â”‚ Run       â”‚  â”‚  â”‚
â”‚   â”‚  â”‚ Code      â”‚â”€â–ºâ”‚ Container  â”‚â”€â–ºâ”‚ Runtime     â”‚â”€â–ºâ”‚ Handler   â”‚  â”‚  â”‚
â”‚   â”‚  â”‚           â”‚  â”‚            â”‚  â”‚ + Init Code â”‚  â”‚           â”‚  â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚   â”‚       â”‚              â”‚                â”‚               â”‚          â”‚  â”‚
â”‚   â”‚      AWS           AWS              YOUR CODE       YOUR CODE    â”‚  â”‚
â”‚   â”‚    (100-500ms)   (50-100ms)        (varies)        (billed)     â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                     WARM START                                   â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚   â”‚  â”‚      Container Already Running            â”‚  â”‚ Run       â”‚   â”‚  â”‚
â”‚   â”‚  â”‚      (execution environment reused)       â”‚â”€â–ºâ”‚ Handler   â”‚   â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚   â”‚                     SKIPPED                        YOUR CODE     â”‚  â”‚
â”‚   â”‚                   (milliseconds)                   (billed)      â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚   Execution Environment:                                                â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  /tmp (512 MB - 10 GB)  â”‚  Memory (128 MB - 10 GB)              â”‚  â”‚
â”‚   â”‚  Persisted between      â”‚  CPU proportional to memory           â”‚  â”‚
â”‚   â”‚  warm invocations       â”‚  1769 MB = 1 vCPU                     â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Handler Function Structure

```python
import json
import boto3
from typing import Any, Dict

# INIT CODE - Runs once per container (cold start)
# Put connections, clients, config here
dynamodb = boto3.resource('dynamodb')
table = dynamodb.Table('Orders')

def lambda_handler(event: Dict[str, Any], context) -> Dict[str, Any]:
    """
    Lambda handler function.
    
    Args:
        event: Event data from trigger (S3, API Gateway, etc.)
        context: Runtime information
            - context.function_name
            - context.memory_limit_in_mb
            - context.invoked_function_arn
            - context.aws_request_id
            - context.get_remaining_time_in_millis()
    
    Returns:
        Response format depends on trigger type
    """
    
    # Log the request ID for tracing
    print(f"Request ID: {context.aws_request_id}")
    print(f"Remaining time: {context.get_remaining_time_in_millis()}ms")
    
    try:
        # Process event
        body = json.loads(event.get('body', '{}'))
        order_id = body.get('order_id')
        
        # Business logic
        result = table.get_item(Key={'order_id': order_id})
        
        return {
            'statusCode': 200,
            'headers': {'Content-Type': 'application/json'},
            'body': json.dumps(result.get('Item', {}))
        }
        
    except Exception as e:
        print(f"Error: {str(e)}")
        return {
            'statusCode': 500,
            'body': json.dumps({'error': str(e)})
        }
```

---

## Event Sources and Triggers

<Frame>
  <img src="/images/aws/lambda-triggers.svg" alt="Lambda Event Sources" />
</Frame>

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Lambda Event Source Types                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   SYNCHRONOUS (Request-Response)                                       â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                        â”‚
â”‚   â€¢ API Gateway (REST, HTTP, WebSocket)                                â”‚
â”‚   â€¢ Application Load Balancer                                          â”‚
â”‚   â€¢ Cognito User Pools                                                 â”‚
â”‚   â€¢ Alexa Skills                                                       â”‚
â”‚   â€¢ CloudFront (Lambda@Edge)                                           â”‚
â”‚   â†’ Caller waits for response                                          â”‚
â”‚   â†’ Errors returned to caller                                          â”‚
â”‚                                                                         â”‚
â”‚   ASYNCHRONOUS (Fire-and-Forget)                                       â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                        â”‚
â”‚   â€¢ S3 Events                                                          â”‚
â”‚   â€¢ SNS                                                                â”‚
â”‚   â€¢ EventBridge                                                        â”‚
â”‚   â€¢ SES                                                                â”‚
â”‚   â€¢ CloudWatch Logs                                                    â”‚
â”‚   â†’ Caller gets 202 Accepted immediately                               â”‚
â”‚   â†’ Lambda retries on failure (2 attempts by default)                  â”‚
â”‚   â†’ Can configure DLQ for failed events                                â”‚
â”‚                                                                         â”‚
â”‚   POLL-BASED (Event Source Mapping)                                    â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                     â”‚
â”‚   â€¢ SQS                                                                â”‚
â”‚   â€¢ DynamoDB Streams                                                   â”‚
â”‚   â€¢ Kinesis Data Streams                                               â”‚
â”‚   â€¢ Amazon MQ                                                          â”‚
â”‚   â€¢ Kafka (MSK, self-managed)                                          â”‚
â”‚   â†’ Lambda polls the source                                            â”‚
â”‚   â†’ Batch processing supported                                         â”‚
â”‚   â†’ Lambda manages checkpointing                                       â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Common Event Formats

```python
# API Gateway Event (REST API)
api_gateway_event = {
    "httpMethod": "POST",
    "path": "/orders",
    "pathParameters": {"id": "123"},
    "queryStringParameters": {"status": "pending"},
    "headers": {"Content-Type": "application/json"},
    "body": "{\"item\": \"widget\", \"qty\": 2}",
    "requestContext": {
        "requestId": "abc-123",
        "authorizer": {"claims": {"sub": "user-123"}}
    }
}

# S3 Event
s3_event = {
    "Records": [{
        "eventName": "ObjectCreated:Put",
        "s3": {
            "bucket": {"name": "my-bucket"},
            "object": {
                "key": "uploads/image.jpg",
                "size": 1024
            }
        }
    }]
}

# SQS Event
sqs_event = {
    "Records": [{
        "messageId": "msg-123",
        "body": "{\"order_id\": \"12345\"}",
        "attributes": {
            "ApproximateReceiveCount": "1"
        }
    }]
}

# DynamoDB Stream Event
dynamodb_stream_event = {
    "Records": [{
        "eventName": "INSERT",
        "dynamodb": {
            "NewImage": {
                "PK": {"S": "ORDER#123"},
                "status": {"S": "CREATED"}
            },
            "StreamViewType": "NEW_AND_OLD_IMAGES"
        }
    }]
}

# EventBridge Event
eventbridge_event = {
    "source": "custom.myapp",
    "detail-type": "OrderCreated",
    "detail": {
        "order_id": "12345",
        "amount": 99.99
    }
}
```

---

## Lambda Layers

Layers allow you to share code and dependencies across multiple functions.

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Lambda Layers Architecture                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   Lambda Function                                                       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  Your Code (handler.py)                                          â”‚  â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚   â”‚  Layer 1: Shared Libraries (boto3, requests)                     â”‚  â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚   â”‚  Layer 2: Custom Utilities (logging, auth)                       â”‚  â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚   â”‚  Layer 3: AWS SDK Extensions (X-Ray, Powertools)                â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚   Benefits:                                                             â”‚
â”‚   â€¢ Reduce deployment package size                                     â”‚
â”‚   â€¢ Share code across functions                                        â”‚
â”‚   â€¢ Separate dependencies from business logic                          â”‚
â”‚   â€¢ Faster deployments (layers cached)                                 â”‚
â”‚                                                                         â”‚
â”‚   Limits:                                                               â”‚
â”‚   â€¢ Maximum 5 layers per function                                      â”‚
â”‚   â€¢ Total unzipped size: 250 MB (function + layers)                   â”‚
â”‚   â€¢ Layer path: /opt/                                                   â”‚
â”‚     - Python: /opt/python/                                             â”‚
â”‚     - Node.js: /opt/nodejs/node_modules/                               â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Creating a Lambda Layer

```bash
# Create layer structure for Python
mkdir -p python/lib/python3.11/site-packages

# Install dependencies
pip install requests boto3 aws-lambda-powertools \
    -t python/lib/python3.11/site-packages

# Package the layer
zip -r layer.zip python/

# Deploy layer
aws lambda publish-layer-version \
    --layer-name my-dependencies \
    --zip-file fileb://layer.zip \
    --compatible-runtimes python3.11 \
    --description "Common Python dependencies"
```

### AWS Lambda Powertools

```python
# Using AWS Lambda Powertools for production-ready Lambda
from aws_lambda_powertools import Logger, Tracer, Metrics
from aws_lambda_powertools.utilities.typing import LambdaContext
from aws_lambda_powertools.utilities.validation import validate
from aws_lambda_powertools.event_handler import APIGatewayRestResolver

logger = Logger(service="order-service")
tracer = Tracer(service="order-service")
metrics = Metrics(service="order-service", namespace="MyApp")
app = APIGatewayRestResolver()

@app.post("/orders")
@tracer.capture_method
def create_order():
    """Create a new order."""
    body = app.current_event.json_body
    
    logger.info("Creating order", extra={"order_data": body})
    metrics.add_metric(name="OrdersCreated", unit="Count", value=1)
    
    # Business logic...
    order_id = process_order(body)
    
    return {"order_id": order_id}

@logger.inject_lambda_context
@tracer.capture_lambda_handler
@metrics.log_metrics
def lambda_handler(event: dict, context: LambdaContext) -> dict:
    return app.resolve(event, context)
```

---

## Cold Starts and Optimization

<Frame>
  <img src="/images/aws/lambda-cold-starts.svg" alt="Lambda Cold Start Optimization" />
</Frame>

### Understanding Cold Starts

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Cold Start Factors                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   Factor              â”‚ Impact          â”‚ How to Optimize              â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚
â”‚   Package Size        â”‚ High            â”‚ Minimize dependencies        â”‚
â”‚   Runtime             â”‚ Medium          â”‚ Python/Node faster than Java â”‚
â”‚   Memory              â”‚ High            â”‚ More memory = faster init    â”‚
â”‚   VPC                 â”‚ Very High       â”‚ Use VPC only if needed       â”‚
â”‚   Provisioned Conc.   â”‚ Eliminates      â”‚ Pre-warm for critical paths  â”‚
â”‚                                                                         â”‚
â”‚   Typical Cold Start Times:                                             â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚   Python (no VPC):     100-300ms                                       â”‚
â”‚   Node.js (no VPC):    100-300ms                                       â”‚
â”‚   Java (no VPC):       500-3000ms                                      â”‚
â”‚   .NET (no VPC):       200-500ms                                       â”‚
â”‚                                                                         â”‚
â”‚   With VPC (before improvements):  +10-30 seconds                      â”‚
â”‚   With VPC (after ENI improvements): +200-500ms                        â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Optimization Strategies

```python
import json
import boto3

# âœ… GOOD: Initialize outside handler (reused in warm starts)
dynamodb = boto3.resource('dynamodb')
table = dynamodb.Table('Orders')

# âœ… GOOD: Lazy loading for optional dependencies
_heavy_library = None

def get_heavy_library():
    global _heavy_library
    if _heavy_library is None:
        import heavy_library
        _heavy_library = heavy_library
    return _heavy_library

def lambda_handler(event, context):
    # âŒ BAD: Creating clients inside handler
    # dynamodb = boto3.resource('dynamodb')  # Don't do this!
    
    # âœ… GOOD: Use connection pooling
    # boto3 automatically reuses connections
    
    # âœ… GOOD: Only import when needed
    if event.get('needs_heavy_processing'):
        lib = get_heavy_library()
        result = lib.process(event)
    
    return {'statusCode': 200}
```

### Provisioned Concurrency

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Provisioned Concurrency                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                                                                  â”‚  â”‚
â”‚   â”‚   Pre-warmed Execution Environments                             â”‚  â”‚
â”‚   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”                 â”‚  â”‚
â”‚   â”‚   â”‚ Warm â”‚ â”‚ Warm â”‚ â”‚ Warm â”‚ â”‚ Warm â”‚ â”‚ Warm â”‚  = 5 PC         â”‚  â”‚
â”‚   â”‚   â”‚  #1  â”‚ â”‚  #2  â”‚ â”‚  #3  â”‚ â”‚  #4  â”‚ â”‚  #5  â”‚                 â”‚  â”‚
â”‚   â”‚   â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜                 â”‚  â”‚
â”‚   â”‚       â”‚        â”‚        â”‚        â”‚        â”‚                     â”‚  â”‚
â”‚   â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚  â”‚
â”‚   â”‚                        â”‚                                         â”‚  â”‚
â”‚   â”‚              Always ready to handle requests                     â”‚  â”‚
â”‚   â”‚              (no cold starts)                                    â”‚  â”‚
â”‚   â”‚                                                                  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â”‚   Pricing:                                                              â”‚
â”‚   â€¢ $0.000004463 per GB-second (provisioned)                           â”‚
â”‚   â€¢ + $0.0000097 per GB-second (invocation, same as on-demand)         â”‚
â”‚   â€¢ Example: 1GB, 100 PC, 24/7 = ~$350/month                           â”‚
â”‚                                                                         â”‚
â”‚   Use Cases:                                                            â”‚
â”‚   â€¢ Latency-critical APIs                                              â”‚
â”‚   â€¢ Predictable traffic patterns                                       â”‚
â”‚   â€¢ Functions with heavy initialization                                â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## VPC Configuration

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Lambda in VPC                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   When to Use VPC:                                                      â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                    â”‚
â”‚   âœ“ Access RDS in private subnet                                       â”‚
â”‚   âœ“ Access ElastiCache                                                 â”‚
â”‚   âœ“ Access EC2 instances                                               â”‚
â”‚   âœ“ Compliance requirements                                            â”‚
â”‚   âœ— Don't use VPC if not needed (adds latency)                         â”‚
â”‚                                                                         â”‚
â”‚   Architecture:                                                         â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚  VPC                                                             â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚  â”‚
â”‚   â”‚  â”‚  Private Subnet (AZ1) â”‚  â”‚  Private Subnet (AZ2) â”‚           â”‚  â”‚
â”‚   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚           â”‚  â”‚
â”‚   â”‚  â”‚  â”‚  Lambda ENI     â”‚  â”‚  â”‚  â”‚  Lambda ENI     â”‚  â”‚           â”‚  â”‚
â”‚   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚  â”‚
â”‚   â”‚  â”‚           â”‚           â”‚  â”‚           â”‚           â”‚           â”‚  â”‚
â”‚   â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚           â”‚  â”‚
â”‚   â”‚  â”‚  â”‚     RDS         â”‚  â”‚  â”‚  â”‚  ElastiCache    â”‚  â”‚           â”‚  â”‚
â”‚   â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚           â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚  â”‚
â”‚   â”‚                                                                  â”‚  â”‚
â”‚   â”‚  To access internet (S3, DynamoDB, external APIs):               â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚  â”‚
â”‚   â”‚  â”‚  NAT Gateway      â”‚ â”€â”€â–º Internet Gateway â”€â”€â–º Internet        â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚  â”‚
â”‚   â”‚  OR                                                              â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                          â”‚  â”‚
â”‚   â”‚  â”‚  VPC Endpoints    â”‚ â”€â”€â–º S3, DynamoDB (private, no NAT)       â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                          â”‚  â”‚
â”‚   â”‚                                                                  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### VPC Configuration Best Practices

```python
# Lambda VPC configuration (Terraform)
vpc_config = """
resource "aws_lambda_function" "vpc_lambda" {
  function_name = "my-vpc-function"
  runtime       = "python3.11"
  handler       = "handler.lambda_handler"
  
  vpc_config {
    # Use at least 2 subnets for high availability
    subnet_ids         = [aws_subnet.private_a.id, aws_subnet.private_b.id]
    security_group_ids = [aws_security_group.lambda_sg.id]
  }
  
  # Lambda needs these permissions to create ENIs
  role = aws_iam_role.lambda_vpc_role.arn
}

# Security group for Lambda
resource "aws_security_group" "lambda_sg" {
  name        = "lambda-sg"
  vpc_id      = aws_vpc.main.id
  
  egress {
    from_port   = 0
    to_port     = 0
    protocol    = "-1"
    cidr_blocks = ["0.0.0.0/0"]
  }
}

# VPC Endpoint for DynamoDB (avoid NAT for AWS services)
resource "aws_vpc_endpoint" "dynamodb" {
  vpc_id            = aws_vpc.main.id
  service_name      = "com.amazonaws.us-east-1.dynamodb"
  vpc_endpoint_type = "Gateway"
  route_table_ids   = [aws_route_table.private.id]
}
"""
```

---

## Concurrency and Scaling

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Lambda Concurrency                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   Concurrent Executions = Invocations/sec Ã— Duration (sec)             â”‚
â”‚                                                                         â”‚
â”‚   Example: 100 requests/sec Ã— 0.5 sec duration = 50 concurrent         â”‚
â”‚                                                                         â”‚
â”‚   Account Limits:                                                       â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                       â”‚
â”‚   â€¢ Default: 1,000 concurrent executions (per region)                  â”‚
â”‚   â€¢ Can request increase to 10,000+                                    â”‚
â”‚   â€¢ Burst limit: 500-3,000 (varies by region)                          â”‚
â”‚                                                                         â”‚
â”‚   Concurrency Types:                                                    â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚   â”‚                                                                  â”‚  â”‚
â”‚   â”‚  Unreserved (default)     Reserved          Provisioned         â”‚  â”‚
â”‚   â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”€â”€â”€â”€â”€â”€â”€â”€â”€         â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”‚  â”‚
â”‚   â”‚  Shared pool for all      Guaranteed        Pre-initialized     â”‚  â”‚
â”‚   â”‚  functions in account     minimum for       (no cold starts)    â”‚  â”‚
â”‚   â”‚                           this function                          â”‚  â”‚
â”‚   â”‚                                                                  â”‚  â”‚
â”‚   â”‚  Account Limit: 1000                                            â”‚  â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚   â”‚  â”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”‚                   â”‚ â”‚  â”‚
â”‚   â”‚  â”‚   Unreserved   â”‚ Func A â”‚    Func B    â”‚  Not allocated    â”‚ â”‚  â”‚
â”‚   â”‚  â”‚     (600)      â”‚ (100)  â”‚    (200)     â”‚      (100)        â”‚ â”‚  â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚   â”‚                                                                  â”‚  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Reserved Concurrency

```python
# Setting reserved concurrency prevents one function from 
# consuming all account capacity

import boto3

lambda_client = boto3.client('lambda')

# Reserve 100 concurrent executions for critical function
lambda_client.put_function_concurrency(
    FunctionName='critical-payment-processor',
    ReservedConcurrentExecutions=100
)

# Setting to 0 = disable function (throttle all invocations)
lambda_client.put_function_concurrency(
    FunctionName='temporarily-disabled-function',
    ReservedConcurrentExecutions=0
)
```

---

## Error Handling and Retries

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Lambda Error Handling                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚   SYNCHRONOUS INVOCATIONS (API Gateway, ALB):                          â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                            â”‚
â”‚   â€¢ No automatic retries                                               â”‚
â”‚   â€¢ Errors returned to caller                                          â”‚
â”‚   â€¢ Implement retry logic in client                                    â”‚
â”‚                                                                         â”‚
â”‚   ASYNCHRONOUS INVOCATIONS (S3, SNS, EventBridge):                     â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚
â”‚   â€¢ 2 automatic retries (total 3 attempts)                             â”‚
â”‚   â€¢ Exponential backoff between retries                                â”‚
â”‚   â€¢ Configure DLQ or On-Failure destination                            â”‚
â”‚                                                                         â”‚
â”‚   EVENT SOURCE MAPPINGS (SQS, DynamoDB, Kinesis):                      â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                       â”‚
â”‚   â€¢ Retry until record expires or succeeds                             â”‚
â”‚   â€¢ Can configure max age, retry attempts                              â”‚
â”‚   â€¢ Bisect batch on failure (find problematic record)                  â”‚
â”‚                                                                         â”‚
â”‚   Destinations (async only):                                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    Success    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚  Lambda Function  â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  SQS/SNS/Lambda   â”‚            â”‚
â”‚   â”‚                   â”‚               â”‚  EventBridge      â”‚            â”‚
â”‚   â”‚                   â”‚    Failure    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚   â”‚                   â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  SQS/SNS/Lambda   â”‚            â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚  EventBridge      â”‚            â”‚
â”‚                                       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

```python
import json
from aws_lambda_powertools import Logger
from aws_lambda_powertools.utilities.idempotency import (
    IdempotencyConfig, DynamoDBPersistenceLayer, idempotent
)

logger = Logger()

# Configure idempotency to prevent duplicate processing
persistence_layer = DynamoDBPersistenceLayer(table_name="IdempotencyTable")
config = IdempotencyConfig(
    event_key_jmespath="body",
    expires_after_seconds=3600
)

@idempotent(config=config, persistence_store=persistence_layer)
def process_payment(event: dict):
    """
    Idempotent payment processing.
    Safe to retry - won't charge customer twice.
    """
    body = json.loads(event['body'])
    
    # Process payment...
    return {"status": "success", "transaction_id": "tx-123"}

def lambda_handler(event, context):
    try:
        result = process_payment(event)
        return {
            'statusCode': 200,
            'body': json.dumps(result)
        }
    except Exception as e:
        logger.exception("Payment processing failed")
        # Re-raise to trigger retry (for async) or return error (for sync)
        raise
```

---

## Best Practices

<CardGroup cols={2}>
  <Card title="Keep Functions Focused" icon="bullseye">
    Single responsibility - one function per task
  </Card>
  <Card title="Minimize Package Size" icon="compress">
    Only include necessary dependencies
  </Card>
  <Card title="Use Environment Variables" icon="key">
    Store configuration, not secrets (use Secrets Manager)
  </Card>
  <Card title="Implement Idempotency" icon="shield-check">
    Handle retries safely
  </Card>
  <Card title="Set Realistic Timeouts" icon="clock">
    Default 3s is often too short
  </Card>
  <Card title="Monitor Everything" icon="chart-line">
    CloudWatch metrics, X-Ray traces, custom dashboards
  </Card>
</CardGroup>

### Production Checklist

```python
production_checklist = {
    "code": [
        "âœ“ Handler is focused and small",
        "âœ“ Dependencies minimized",
        "âœ“ Connections initialized outside handler",
        "âœ“ Proper error handling with logging",
        "âœ“ Idempotent operations",
    ],
    "configuration": [
        "âœ“ Appropriate memory (test to find optimal)",
        "âœ“ Realistic timeout (p99 latency + buffer)",
        "âœ“ Environment variables for config",
        "âœ“ Secrets Manager for secrets",
        "âœ“ X-Ray tracing enabled",
    ],
    "reliability": [
        "âœ“ DLQ configured for async invocations",
        "âœ“ Reserved concurrency for critical functions",
        "âœ“ Provisioned concurrency for latency-sensitive",
        "âœ“ Retry logic for downstream failures",
    ],
    "security": [
        "âœ“ Least-privilege IAM role",
        "âœ“ VPC only if needed (private resources)",
        "âœ“ No hardcoded credentials",
        "âœ“ Input validation",
    ],
    "cost": [
        "âœ“ Right-sized memory",
        "âœ“ Avoid unnecessary VPC",
        "âœ“ Use ARM (Graviton2) for 20% savings",
        "âœ“ Monitor and alert on invocation spikes",
    ]
}
```

---

## ğŸ¯ Interview Questions

<AccordionGroup>
  <Accordion title="Q1: How do you minimize Lambda cold starts?">
    **Optimization strategies:**
    
    1. **Code level:**
       - Minimize deployment package size
       - Lazy load heavy dependencies
       - Initialize SDK clients outside handler
    
    2. **Configuration:**
       - Increase memory (faster CPU = faster init)
       - Use compiled languages carefully
       - Avoid VPC unless necessary
    
    3. **Provisioned Concurrency:**
       - Pre-warm execution environments
       - Eliminate cold starts for critical paths
       - Use scheduled scaling for traffic patterns
    
    4. **Architecture:**
       - Keep functions warm with scheduled pings (anti-pattern, prefer PC)
       - Use Lambda SnapStart for Java
  </Accordion>
  
  <Accordion title="Q2: How does Lambda scale?">
    **Scaling behavior:**
    
    - Lambda scales by creating more execution environments
    - Burst: 500-3,000 concurrent executions immediately
    - After burst: 500 additional per minute
    
    **Formula:**
    Concurrent Executions = (invocations/sec) Ã— (avg duration in sec)
    
    **Limits:**
    - Account limit: 1,000 default (can increase)
    - Function reserved concurrency: up to account limit
    - Provisioned concurrency: pre-warmed instances
  </Accordion>
  
  <Accordion title="Q3: Lambda vs EC2 vs ECS - when to use each?">
    **Lambda:**
    - Short-lived, event-driven workloads
    - Unpredictable/spiky traffic
    - < 15 minutes execution
    - No server management needed
    
    **ECS (Fargate):**
    - Long-running containers
    - Microservices architecture
    - Consistent traffic patterns
    - Need more control than Lambda
    
    **EC2:**
    - Maximum control/customization
    - Specialized hardware needs
    - Persistent workloads
    - Legacy applications
  </Accordion>
  
  <Accordion title="Q4: How do you handle secrets in Lambda?">
    **Best practices:**
    
    ```python
    # Use Secrets Manager (cached with Powertools)
    from aws_lambda_powertools.utilities.parameters import get_secret
    
    # Cached for 5 minutes by default
    db_password = get_secret("prod/db/password")
    
    # Or use Parameter Store for non-sensitive config
    from aws_lambda_powertools.utilities.parameters import get_parameter
    
    api_endpoint = get_parameter("/myapp/api/endpoint")
    ```
    
    **Never:**
    - Hardcode secrets in code
    - Store secrets in environment variables
    - Log secrets
  </Accordion>
  
  <Accordion title="Q5: Explain Lambda@Edge vs Lambda">
    **Lambda@Edge:**
    - Runs at CloudFront edge locations
    - Lower latency (closer to users)
    - Limited: 128MB memory, 5s timeout (viewer), 30s (origin)
    - Use cases: URL rewrite, A/B testing, auth, headers
    
    **Regular Lambda:**
    - Runs in a single region
    - Full capabilities: 10GB memory, 15min timeout
    - More triggers and integrations
    
    **CloudFront Functions:**
    - Even faster, cheaper than Lambda@Edge
    - 2MB code, 1ms timeout
    - Simple header manipulation only
  </Accordion>
</AccordionGroup>

---

## ğŸ§ª Hands-On Lab

<Steps>
  <Step title="Create Basic Lambda">
    Create a Python Lambda function with API Gateway trigger
  </Step>
  
  <Step title="Add Dependencies with Layers">
    Create a layer with requests and boto3, attach to function
  </Step>
  
  <Step title="Configure VPC Access">
    Set up Lambda in VPC to access RDS, configure VPC endpoints
  </Step>
  
  <Step title="Implement Error Handling">
    Add DLQ, structured logging, and X-Ray tracing
  </Step>
  
  <Step title="Optimize Performance">
    Configure provisioned concurrency and measure cold start impact
  </Step>
</Steps>

---

## Next Module

<Card title="AWS Step Functions" icon="diagram-project" href="/aws/step-functions">
  Orchestrate serverless workflows with Step Functions
</Card>
