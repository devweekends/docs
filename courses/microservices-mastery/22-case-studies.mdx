---
title: "22. Case Studies"
description: "Learn from real-world microservices architectures at Netflix, Uber, Amazon, and Spotify - what worked, what didn't, and key lessons"
---

# Real-World Case Studies

Learn from how the world's largest tech companies built and evolved their microservices architectures.

<Info>
**Learning Objectives:**
- Analyze Netflix's pioneering microservices journey
- Understand Uber's domain-oriented architecture
- Learn Amazon's two-pizza team approach
- Study Spotify's squad model and service design
- Extract actionable lessons for your own systems
</Info>

---

## Netflix: The Pioneer

### Evolution Journey

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NETFLIX ARCHITECTURE EVOLUTION                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  2007: MONOLITH ERA                                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                  â”‚
â”‚  â€¢ Single Java monolith                                                     â”‚
â”‚  â€¢ Oracle database                                                          â”‚
â”‚  â€¢ Datacenter deployment                                                    â”‚
â”‚  â€¢ DVD rental + early streaming                                             â”‚
â”‚                                                                              â”‚
â”‚                    â†“ Major outage (database corruption)                     â”‚
â”‚                                                                              â”‚
â”‚  2009-2012: MIGRATION TO CLOUD                                              â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                          â”‚
â”‚  â€¢ Move to AWS                                                              â”‚
â”‚  â€¢ Break apart monolith                                                     â”‚
â”‚  â€¢ Adopt microservices                                                      â”‚
â”‚  â€¢ Build internal tools (Simian Army, Zuul, Eureka)                        â”‚
â”‚                                                                              â”‚
â”‚                    â†“ Scaling to 100M+ subscribers                           â”‚
â”‚                                                                              â”‚
â”‚  2015-2020: MATURE MICROSERVICES                                            â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                         â”‚
â”‚  â€¢ 700+ microservices                                                       â”‚
â”‚  â€¢ 100,000+ AWS instances                                                   â”‚
â”‚  â€¢ Multiple regions globally                                                â”‚
â”‚  â€¢ Advanced chaos engineering                                               â”‚
â”‚                                                                              â”‚
â”‚  2020+: FEDERATION & GRAPHQL                                                â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                           â”‚
â”‚  â€¢ GraphQL Federation                                                       â”‚
â”‚  â€¢ Studio applications                                                      â”‚
â”‚  â€¢ Content delivery optimization                                            â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Key Architecture Decisions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NETFLIX KEY PATTERNS                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  1. API GATEWAY (Zuul)                                                      â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                   â”‚
â”‚     â€¢ Single entry point                                                    â”‚
â”‚     â€¢ Dynamic routing                                                       â”‚
â”‚     â€¢ Load balancing                                                        â”‚
â”‚     â€¢ Authentication                                                        â”‚
â”‚                                                                              â”‚
â”‚     Client â”€â”€â–¶ Zuul â”€â”€â–¶ Microservices                                       â”‚
â”‚                  â”‚                                                          â”‚
â”‚                  â”œâ”€â”€â–¶ User Service                                          â”‚
â”‚                  â”œâ”€â”€â–¶ Content Service                                       â”‚
â”‚                  â””â”€â”€â–¶ Recommendation Service                                â”‚
â”‚                                                                              â”‚
â”‚  2. SERVICE DISCOVERY (Eureka)                                              â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                            â”‚
â”‚     â€¢ Self-registration                                                     â”‚
â”‚     â€¢ Health checking                                                       â”‚
â”‚     â€¢ Client-side load balancing                                            â”‚
â”‚                                                                              â”‚
â”‚     Service A â”€â”€registerâ”€â”€â–¶ Eureka â—€â”€â”€discoverâ”€â”€ Service B                  â”‚
â”‚                                                                              â”‚
â”‚  3. CIRCUIT BREAKER (Hystrix)                                               â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚     â€¢ Fail fast                                                             â”‚
â”‚     â€¢ Fallback responses                                                    â”‚
â”‚     â€¢ Bulkhead isolation                                                    â”‚
â”‚     â€¢ Real-time metrics                                                     â”‚
â”‚                                                                              â”‚
â”‚  4. CONFIGURATION (Archaius)                                                â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                              â”‚
â”‚     â€¢ Dynamic properties                                                    â”‚
â”‚     â€¢ No restart needed                                                     â”‚
â”‚     â€¢ Feature flags                                                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Netflix's Personalization Architecture

```javascript
// Simplified view of Netflix's recommendation system

/*
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PERSONALIZATION PIPELINE                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚
â”‚   â”‚   User      â”‚     â”‚   Context   â”‚     â”‚   Content   â”‚                  â”‚
â”‚   â”‚   Profile   â”‚     â”‚   Service   â”‚     â”‚   Catalog   â”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                  â”‚
â”‚          â”‚                   â”‚                   â”‚                          â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                          â”‚
â”‚                              â”‚                                              â”‚
â”‚                              â–¼                                              â”‚
â”‚                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                     â”‚
â”‚                    â”‚  Personalizationâ”‚                                     â”‚
â”‚                    â”‚     Engine      â”‚                                     â”‚
â”‚                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                     â”‚
â”‚                             â”‚                                               â”‚
â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚           â–¼                 â–¼                 â–¼                            â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚   â”‚ Row Selection â”‚ â”‚ Row Ranking   â”‚ â”‚ Artwork       â”‚                   â”‚
â”‚   â”‚ Algorithm     â”‚ â”‚ Algorithm     â”‚ â”‚ Personalizationâ”‚                  â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Key Design Principles:
- Every page element is personalized
- A/B testing for all algorithms
- Precomputed recommendations (offline)
- Real-time adjustments (online)
- Graceful degradation to popular content
*/

class PersonalizationService {
  async getHomePage(userId, context) {
    // Get user data with circuit breaker
    const userProfile = await this.circuitBreaker.execute(
      'user-service',
      () => this.userService.getProfile(userId),
      () => this.getDefaultProfile()  // Fallback
    );

    // Get personalized rows
    const rows = await Promise.all([
      this.getRow('continue-watching', userId, context),
      this.getRow('trending-now', userId, context),
      this.getRow('because-you-watched', userId, context),
      this.getRow('top-picks', userId, context)
    ]);

    // Rank and filter rows
    const rankedRows = this.rankRows(rows, userProfile);

    // Select personalized artwork for each title
    const rowsWithArtwork = await this.personalizeArtwork(rankedRows, userProfile);

    return {
      rows: rowsWithArtwork,
      experimentIds: this.getActiveExperiments(userId)
    };
  }

  async getRow(rowType, userId, context) {
    const cacheKey = `row:${rowType}:${userId}`;
    
    // Check precomputed cache
    let row = await this.cache.get(cacheKey);
    
    if (!row) {
      // Compute on-demand (rare)
      row = await this.computeRow(rowType, userId, context);
      await this.cache.set(cacheKey, row, 3600);
    }

    // Real-time adjustments
    row = this.applyContextAdjustments(row, context);

    return row;
  }
}
```

### Lessons from Netflix

<CardGroup cols={2}>
  <Card title="Build for Failure" icon="explosion">
    Assume everything will fail. Build systems that degrade gracefully.
  </Card>
  <Card title="Automate Everything" icon="robot">
    Deploy, scale, test, recover - all automated. Humans make mistakes under pressure.
  </Card>
  <Card title="Chaos Engineering" icon="shuffle">
    Break things on purpose to build confidence. Netflix invented Chaos Monkey.
  </Card>
  <Card title="Observability" icon="chart-line">
    You can't fix what you can't see. Invest heavily in monitoring and tracing.
  </Card>
</CardGroup>

---

## Uber: Domain-Oriented Microservices

### Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UBER'S DOMAIN-ORIENTED ARCHITECTURE                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚
â”‚                         â”‚   API Gateway      â”‚                              â”‚
â”‚                         â”‚   (Edge Service)   â”‚                              â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                              â”‚
â”‚                                   â”‚                                          â”‚
â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚         â”‚                         â”‚                         â”‚               â”‚
â”‚         â–¼                         â–¼                         â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   RIDERS    â”‚          â”‚   DRIVERS   â”‚          â”‚   EATS      â”‚         â”‚
â”‚  â”‚   DOMAIN    â”‚          â”‚   DOMAIN    â”‚          â”‚   DOMAIN    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                        â”‚                        â”‚                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚ â€¢ Rider   â”‚            â”‚ â€¢ Driver  â”‚            â”‚ â€¢ Orders  â”‚          â”‚
â”‚   â”‚   Service â”‚            â”‚   Service â”‚            â”‚ â€¢ Menu    â”‚          â”‚
â”‚   â”‚ â€¢ Trips   â”‚            â”‚ â€¢ Earningsâ”‚            â”‚ â€¢ Deliveryâ”‚          â”‚
â”‚   â”‚ â€¢ Ratings â”‚            â”‚ â€¢ Scheduleâ”‚            â”‚ â€¢ Ratings â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                                                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                        SHARED PLATFORM SERVICES                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ Mapping  â”‚  â”‚ Pricing  â”‚  â”‚ Dispatch â”‚  â”‚ Payments â”‚  â”‚ Comms    â”‚    â”‚
â”‚   â”‚          â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚  â”‚ (SMS/Push)â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•  â”‚
â”‚                        INFRASTRUCTURE LAYER                                 â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                              â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚   â”‚ Schemalessâ”‚  â”‚ Ringpop â”‚  â”‚  Cherami â”‚  â”‚  Cadence â”‚  â”‚  Peloton â”‚    â”‚
â”‚   â”‚ (MySQL)  â”‚  â”‚ (Routing)â”‚  â”‚ (Queues) â”‚  â”‚(Workflow)â”‚  â”‚ (Deploy) â”‚    â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Key Insight: Domain-oriented microservices, not just technical decomposition.
Services are grouped by business domain, not by technical function.
```

### Uber's Dispatch System

```javascript
// Simplified Uber dispatch architecture

/*
DISPATCH CHALLENGE:
- Match riders with drivers in real-time
- Optimize for ETA, driver earnings, rider satisfaction
- Handle 15+ million trips per day
- Sub-second matching requirements
*/

class DispatchService {
  constructor() {
    this.supplyIndex = new GeospatialIndex();  // Real-time driver locations
    this.demandQueue = new PriorityQueue();    // Rider requests
    this.matchingEngine = new MatchingEngine();
  }

  // Driver sends location update (every 4 seconds)
  async updateDriverLocation(driverId, location, status) {
    // Update in-memory geospatial index
    if (status === 'available') {
      await this.supplyIndex.upsert(driverId, location);
    } else {
      await this.supplyIndex.remove(driverId);
    }

    // Persist to storage asynchronously
    this.eventBus.publish('driver.location.updated', {
      driverId,
      location,
      status,
      timestamp: Date.now()
    });
  }

  // Rider requests a trip
  async requestTrip(riderId, pickup, destination) {
    const request = {
      id: generateId(),
      riderId,
      pickup,
      destination,
      requestedAt: Date.now(),
      status: 'pending'
    };

    // Find nearby available drivers
    const nearbyDrivers = await this.supplyIndex.findNearby(
      pickup,
      { radiusKm: 5, limit: 20 }
    );

    if (nearbyDrivers.length === 0) {
      return { status: 'no_drivers', surge: await this.getSurgeMultiplier(pickup) };
    }

    // Calculate ETAs for each driver
    const driversWithETA = await Promise.all(
      nearbyDrivers.map(async (driver) => ({
        ...driver,
        eta: await this.mapService.getETA(driver.location, pickup),
        score: await this.calculateMatchScore(driver, request)
      }))
    );

    // Sort by match score
    driversWithETA.sort((a, b) => b.score - a.score);

    // Dispatch to best match
    const bestDriver = driversWithETA[0];
    const dispatch = await this.dispatchToDriver(bestDriver, request);

    return dispatch;
  }

  async calculateMatchScore(driver, request) {
    // Multi-factor scoring
    const etaScore = 100 - (driver.eta / 60);  // Prefer closer drivers
    const ratingScore = driver.rating * 10;    // Prefer higher rated
    const acceptanceScore = driver.acceptanceRate * 50;  // Prefer reliable
    
    // Fairness factor (avoid always picking same driver)
    const fairnessScore = 100 - Math.min(driver.tripsToday * 5, 50);

    return etaScore + ratingScore + acceptanceScore + fairnessScore;
  }

  async dispatchToDriver(driver, request) {
    // Create dispatch record
    const dispatch = {
      id: generateId(),
      requestId: request.id,
      driverId: driver.id,
      status: 'dispatched',
      dispatchedAt: Date.now(),
      expiresAt: Date.now() + 15000  // 15 second window to accept
    };

    // Remove driver from available pool
    await this.supplyIndex.remove(driver.id);

    // Send push notification to driver
    await this.notificationService.sendToDriver(driver.id, {
      type: 'trip_request',
      dispatch,
      request
    });

    // Wait for response with timeout
    return this.waitForAcceptance(dispatch);
  }

  async waitForAcceptance(dispatch) {
    return new Promise((resolve) => {
      const timeout = setTimeout(() => {
        // Driver didn't respond - try next driver
        resolve({ status: 'timeout', dispatch });
      }, 15000);

      this.on(`dispatch.${dispatch.id}.accepted`, () => {
        clearTimeout(timeout);
        resolve({ status: 'accepted', dispatch });
      });

      this.on(`dispatch.${dispatch.id}.declined`, () => {
        clearTimeout(timeout);
        resolve({ status: 'declined', dispatch });
      });
    });
  }
}
```

### Uber's Migration Patterns

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UBER'S MIGRATION APPROACH                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  STRANGLER FIG PATTERN                                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                               â”‚
â”‚                                                                              â”‚
â”‚  Phase 1: Identify bounded contexts                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        MONOLITH                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚  â”‚ Riders  â”‚ â”‚ Drivers â”‚ â”‚ Trips   â”‚ â”‚ Paymentsâ”‚ â”‚ Mapping â”‚       â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  Phase 2: Extract one service at a time                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        MONOLITH                                      â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚   â”‚
â”‚  â”‚  â”‚ Riders  â”‚ â”‚ Drivers â”‚ â”‚ Trips   â”‚ â”‚ Paymentsâ”‚                    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                      â”‚
â”‚                                      â–¼                                      â”‚
â”‚                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                             â”‚
â”‚                            â”‚ Mapping Service â”‚  â† Extracted                â”‚
â”‚                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
â”‚                                                                              â”‚
â”‚  Phase 3: Continue extracting                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚                    SHRINKING MONOLITH                    â”‚              â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                 â”‚              â”‚
â”‚  â”‚  â”‚ Riders  â”‚ â”‚ Trips   â”‚                                 â”‚              â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                 â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â”‚              â”‚           â”‚           â”‚           â”‚                          â”‚
â”‚              â–¼           â–¼           â–¼           â–¼                          â”‚
â”‚        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚        â”‚ Drivers  â”‚ â”‚ Payments â”‚ â”‚ Mapping  â”‚ â”‚ Pricing  â”‚                 â”‚
â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                                              â”‚
â”‚  KEY LEARNING: "Don't migrate data, migrate ownership"                      â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Lessons from Uber

<CardGroup cols={2}>
  <Card title="Domain-Driven Design" icon="sitemap">
    Organize by business domain, not technical layers. Clear ownership boundaries.
  </Card>
  <Card title="Platform Approach" icon="layer-group">
    Build shared platforms (mapping, payments) used by all product teams.
  </Card>
  <Card title="Data Consistency" icon="database">
    Accept eventual consistency. Design compensating transactions.
  </Card>
  <Card title="Observability" icon="magnifying-glass">
    End-to-end tracing is critical. Uber built Jaeger for this.
  </Card>
</CardGroup>

---

## Amazon: The Two-Pizza Team

### Service-Oriented Architecture Origins

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AMAZON'S SOA MANDATE (2002)                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Jeff Bezos' famous mandate:                                                â”‚
â”‚                                                                              â”‚
â”‚  1. All teams will henceforth expose their data and functionality through  â”‚
â”‚     service interfaces.                                                     â”‚
â”‚                                                                              â”‚
â”‚  2. Teams must communicate with each other through these interfaces.        â”‚
â”‚                                                                              â”‚
â”‚  3. There will be no other form of interprocess communication allowed.      â”‚
â”‚                                                                              â”‚
â”‚  4. It doesn't matter what technology they use.                             â”‚
â”‚                                                                              â”‚
â”‚  5. All service interfaces must be designed from the ground up to be        â”‚
â”‚     externalizable.                                                         â”‚
â”‚                                                                              â”‚
â”‚  6. Anyone who doesn't do this will be fired.                               â”‚
â”‚                                                                              â”‚
â”‚  This led to:                                                               â”‚
â”‚  â€¢ AWS being possible (externalized internal services)                      â”‚
â”‚  â€¢ Thousands of independent services                                        â”‚
â”‚  â€¢ True service ownership                                                   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Amazon's Team Structure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    TWO-PIZZA TEAM MODEL                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  PRINCIPLE: A team should be small enough to be fed by two pizzas           â”‚
â”‚             (typically 6-10 people)                                          â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                         TWO-PIZZA TEAM                               â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  ğŸ‘¤ğŸ‘¤ğŸ‘¤ğŸ‘¤ğŸ‘¤ğŸ‘¤ (6-10 people)                                           â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Engineers (4-6)                                                  â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ Product Manager (1)                                              â”‚   â”‚
â”‚  â”‚  â”œâ”€â”€ TPM/Scrum Master (1)                                            â”‚   â”‚
â”‚  â”‚  â””â”€â”€ UX (0.5-1)                                                      â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  OWNS:                                                                â”‚   â”‚
â”‚  â”‚  â€¢ 1-3 microservices                                                 â”‚   â”‚
â”‚  â”‚  â€¢ Full lifecycle (dev, test, deploy, operate)                       â”‚   â”‚
â”‚  â”‚  â€¢ On-call rotation                                                   â”‚   â”‚
â”‚  â”‚  â€¢ Business metrics                                                   â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  AUTONOMY:                                                            â”‚   â”‚
â”‚  â”‚  â€¢ Choose tech stack                                                 â”‚   â”‚
â”‚  â”‚  â€¢ Define API contracts                                               â”‚   â”‚
â”‚  â”‚  â€¢ Set deployment schedule                                            â”‚   â”‚
â”‚  â”‚  â€¢ Manage technical debt                                              â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  "You build it, you run it" - Werner Vogels                                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Amazon's Event-Driven Architecture

```javascript
// Amazon's event-driven approach

/*
KEY PATTERN: Events as the source of truth

When you place an order on Amazon, this happens:

1. Order Service creates order
2. Publishes OrderPlaced event
3. Multiple services react independently:
   - Inventory reserves stock
   - Payment processes charge
   - Shipping calculates delivery
   - Recommendations updates models
   - Email sends confirmation
*/

class OrderService {
  async placeOrder(orderData) {
    // Create order in database
    const order = await this.repository.create({
      ...orderData,
      status: 'pending',
      orderId: generateOrderId()
    });

    // Publish event - other services react
    await this.eventBridge.publish({
      source: 'order-service',
      detailType: 'OrderPlaced',
      detail: {
        orderId: order.orderId,
        customerId: order.customerId,
        items: order.items,
        total: order.total,
        shippingAddress: order.shippingAddress
      }
    });

    // Return immediately - don't wait for downstream
    return {
      orderId: order.orderId,
      status: 'pending',
      message: 'Order received and being processed'
    };
  }
}

// Inventory Service reacts to order events
class InventoryService {
  constructor() {
    this.eventBridge.subscribe('OrderPlaced', this.handleOrderPlaced.bind(this));
  }

  async handleOrderPlaced(event) {
    const { orderId, items } = event.detail;

    try {
      // Reserve inventory
      for (const item of items) {
        await this.reserveStock(item.productId, item.quantity, orderId);
      }

      // Publish success event
      await this.eventBridge.publish({
        source: 'inventory-service',
        detailType: 'InventoryReserved',
        detail: { orderId, items }
      });

    } catch (error) {
      // Publish failure event
      await this.eventBridge.publish({
        source: 'inventory-service',
        detailType: 'InventoryReservationFailed',
        detail: { orderId, reason: error.message }
      });
    }
  }
}

// Order Saga Coordinator (or choreography handles compensation)
class OrderSagaCoordinator {
  constructor() {
    this.eventBridge.subscribe('InventoryReservationFailed', this.handleInventoryFailure.bind(this));
    this.eventBridge.subscribe('PaymentFailed', this.handlePaymentFailure.bind(this));
  }

  async handleInventoryFailure(event) {
    const { orderId, reason } = event.detail;
    
    // Cancel order
    await this.orderService.updateStatus(orderId, 'cancelled', reason);
    
    // Notify customer
    await this.eventBridge.publish({
      source: 'order-saga',
      detailType: 'OrderCancelled',
      detail: { orderId, reason: `Item unavailable: ${reason}` }
    });
  }
}
```

---

## Spotify: Squad Model

### Team Topology

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SPOTIFY'S SQUAD MODEL                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  TRIBE (100-150 people)                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  SQUAD         SQUAD         SQUAD         SQUAD                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”                   â”‚   â”‚
â”‚  â”‚  â”‚ ğŸµ  â”‚      â”‚ ğŸ”  â”‚       â”‚ ğŸ“±  â”‚       â”‚ ğŸ’³  â”‚                   â”‚   â”‚
â”‚  â”‚  â”‚Play â”‚      â”‚Searchâ”‚      â”‚Mobileâ”‚      â”‚Pay  â”‚                   â”‚   â”‚
â”‚  â”‚  â”‚Squadâ”‚      â”‚Squad â”‚      â”‚Squad â”‚      â”‚Squadâ”‚                   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”˜                   â”‚   â”‚
â”‚  â”‚     â”‚            â”‚             â”‚             â”‚                       â”‚   â”‚
â”‚  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚   â”‚
â”‚  â”‚                         â”‚                                            â”‚   â”‚
â”‚  â”‚                    TRIBE LEAD                                        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  CHAPTERS (Horizontal - same skill)                                         â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Backend Chapter    â”‚  Frontend Chapter   â”‚  QA Chapter             â”‚   â”‚
â”‚  â”‚  ğŸ‘¤ğŸ‘¤ğŸ‘¤ğŸ‘¤           â”‚  ğŸ‘¤ğŸ‘¤ğŸ‘¤ğŸ‘¤            â”‚  ğŸ‘¤ğŸ‘¤ğŸ‘¤                 â”‚   â”‚
â”‚  â”‚  (from all squads)   â”‚  (from all squads)   â”‚  (from all squads)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  GUILDS (Voluntary - interest groups)                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Web Guild      â”‚  iOS Guild      â”‚  ML Guild      â”‚  Agile Guild   â”‚   â”‚
â”‚  â”‚  ğŸ‘¤ ğŸ‘¤ ğŸ‘¤       â”‚  ğŸ‘¤ ğŸ‘¤          â”‚  ğŸ‘¤ ğŸ‘¤ ğŸ‘¤ ğŸ‘¤   â”‚  ğŸ‘¤ ğŸ‘¤         â”‚   â”‚
â”‚  â”‚  (across tribes) â”‚                 â”‚                â”‚                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                              â”‚
â”‚  KEY INSIGHT: Squads are autonomous but aligned                            â”‚
â”‚              Chapters spread knowledge                                      â”‚
â”‚              Guilds create communities of practice                         â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Spotify's Backend Architecture

```javascript
// Spotify's service patterns

/*
AUDIO STREAMING ARCHITECTURE:
- 400M+ monthly active users
- 80M+ tracks
- Personalized for each user
*/

class PlaybackService {
  async startPlayback(userId, trackId, deviceId) {
    // Get track metadata
    const track = await this.trackService.getTrack(trackId);
    
    // Check user's subscription
    const subscription = await this.subscriptionService.get(userId);
    
    // Determine audio quality based on subscription
    const quality = this.determineQuality(subscription, deviceId);
    
    // Get CDN URL for audio file
    const audioUrl = await this.cdnService.getAudioUrl(trackId, quality);
    
    // Record play start (for royalties, analytics)
    await this.playService.recordPlay({
      userId,
      trackId,
      deviceId,
      quality,
      startedAt: Date.now()
    });

    // Update user's playback state
    await this.stateService.updatePlaybackState(userId, {
      trackId,
      deviceId,
      playing: true,
      position: 0
    });

    return {
      trackId,
      audioUrl,
      quality,
      metadata: track
    };
  }
}

// Content Delivery Optimization
class CDNService {
  async getAudioUrl(trackId, quality) {
    // Multi-CDN strategy for global delivery
    const cdns = await this.getCDNsForTrack(trackId);
    
    // Select best CDN based on:
    // - User location
    // - CDN health
    // - Current load
    const bestCDN = this.selectOptimalCDN(cdns);
    
    // Generate signed URL
    return this.generateSignedUrl(trackId, quality, bestCDN);
  }
}

// Personalization (Discover Weekly, Daily Mix, etc.)
class RecommendationService {
  async generateDiscoverWeekly(userId) {
    // User taste profile (built from listening history)
    const tasteProfile = await this.getTasteProfile(userId);
    
    // Collaborative filtering (users with similar taste)
    const collaborativeRecs = await this.collaborativeFilter(userId, tasteProfile);
    
    // Content-based (similar audio features)
    const contentRecs = await this.contentBasedFilter(tasteProfile);
    
    // Blend recommendations
    const blended = this.blendRecommendations([
      { source: 'collaborative', weight: 0.5, items: collaborativeRecs },
      { source: 'content', weight: 0.3, items: contentRecs },
      { source: 'release_radar', weight: 0.2, items: await this.getNewReleases(tasteProfile) }
    ]);

    // Remove already played tracks
    const filtered = await this.filterKnownTracks(userId, blended);

    // Create playlist
    return this.createPlaylist(userId, 'Discover Weekly', filtered.slice(0, 30));
  }
}
```

---

## Key Lessons Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    LESSONS FROM TECH GIANTS                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  COMPANY     â”‚ KEY LESSON                     â”‚ PATTERN                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚              â”‚                                â”‚                             â”‚
â”‚  Netflix     â”‚ Design for failure             â”‚ Chaos Engineering,          â”‚
â”‚              â”‚ Everything fails eventually    â”‚ Circuit Breakers,           â”‚
â”‚              â”‚                                â”‚ Graceful Degradation        â”‚
â”‚              â”‚                                â”‚                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚              â”‚                                â”‚                             â”‚
â”‚  Uber        â”‚ Domain-oriented design         â”‚ Bounded Contexts,           â”‚
â”‚              â”‚ Organize by business, not tech â”‚ Platform Services,          â”‚
â”‚              â”‚                                â”‚ Saga Pattern                â”‚
â”‚              â”‚                                â”‚                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚              â”‚                                â”‚                             â”‚
â”‚  Amazon      â”‚ Service ownership              â”‚ Two-Pizza Teams,            â”‚
â”‚              â”‚ You build it, you run it       â”‚ Event-Driven,               â”‚
â”‚              â”‚                                â”‚ API Mandate                 â”‚
â”‚              â”‚                                â”‚                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚              â”‚                                â”‚                             â”‚
â”‚  Spotify     â”‚ Autonomous but aligned         â”‚ Squad Model,                â”‚
â”‚              â”‚ Balance autonomy with cohesion â”‚ Chapters/Guilds,            â”‚
â”‚              â”‚                                â”‚ Trunk-Based Dev             â”‚
â”‚              â”‚                                â”‚                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Interview Questions

<AccordionGroup>
  <Accordion title="Q1: How did Netflix migrate from monolith to microservices?">
    **Answer:**
    
    Netflix's migration took 7+ years (2009-2016):
    
    1. **Trigger**: Major database outage in 2008
    2. **Cloud-first**: Migrated to AWS
    3. **Incremental extraction**: Started with non-critical services
    4. **Built tooling**: Eureka, Hystrix, Zuul, Ribbon
    5. **Chaos engineering**: Validated resilience continuously
    
    **Key patterns:**
    - API Gateway for routing
    - Client-side load balancing
    - Circuit breakers everywhere
    - Service registry for discovery
    
    **Lesson:** Don't do "big bang" migration. Extract incrementally.
  </Accordion>
  
  <Accordion title="Q2: What is Amazon's Two-Pizza Team?">
    **Answer:**
    
    A team small enough to be fed by two pizzas (6-10 people).
    
    **Characteristics:**
    - Full ownership of 1-3 services
    - End-to-end responsibility (build, test, deploy, operate)
    - Autonomous decision making
    - Direct accountability for business metrics
    
    **Benefits:**
    - Fast decision making
    - Clear ownership
    - Reduced communication overhead
    - Motivation through ownership
    
    **"You build it, you run it"** - On-call for your own services.
  </Accordion>
  
  <Accordion title="Q3: How does Uber handle dispatch at scale?">
    **Answer:**
    
    Uber's dispatch handles 15M+ trips/day:
    
    1. **Real-time location tracking**
       - Drivers send GPS every 4 seconds
       - Geospatial index in memory
    
    2. **Supply-demand matching**
       - Find nearby drivers
       - Calculate ETAs using map service
       - Score by ETA, rating, fairness
    
    3. **Dispatch with timeout**
       - Push notification to driver
       - 15 second response window
       - Cascade to next driver if declined
    
    4. **Event-driven updates**
       - All state changes are events
       - Enables real-time tracking
    
    **Key tech:** Ringpop (consistent hashing), Cadence (workflows)
  </Accordion>
  
  <Accordion title="Q4: What is Spotify's Squad Model?">
    **Answer:**
    
    Organizational structure for autonomy with alignment:
    
    **Squads (6-12 people):**
    - Cross-functional mini-startup
    - Owns feature end-to-end
    - Autonomous decision making
    
    **Tribes (multiple squads):**
    - Related squads grouped together
    - Shared mission
    - 100-150 people max
    
    **Chapters (horizontal):**
    - Same skill across squads
    - Knowledge sharing
    - Technical growth
    
    **Guilds (interest groups):**
    - Voluntary communities
    - Cross-tribe learning
    
    **Key insight:** Balance autonomy (squads) with alignment (tribes, chapters).
  </Accordion>
</AccordionGroup>

---

## Chapter Summary

<Info>
**Key Takeaways:**
- Netflix: Design for failure with chaos engineering
- Uber: Domain-oriented architecture with platform services
- Amazon: Small autonomous teams with full ownership
- Spotify: Squad model balances autonomy and alignment
- All companies evolved incrementally, not big-bang migrations
- Invest heavily in tooling and observability
</Info>

**Next Chapter:** Interview Prep - Comprehensive preparation for microservices interviews.
