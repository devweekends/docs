---
title: "High Availability & Disaster Recovery"
description: "Master HA/DR strategies, RPO/RTO, and multi-region architectures"
icon: "life-ring"
---

# High Availability & Disaster Recovery

Design systems that survive failures and disasters. Learn to achieve 99.99% availability.

![Azure HA/DR Patterns](/images/azure/13-ha-dr-patterns.svg)

---

## What You'll Learn

By the end of this chapter, you'll understand:

- **What High Availability and Disaster Recovery really mean** (and why they're different)
- **How to calculate and achieve specific SLAs** (99.9%, 99.99%, 99.999%)
- **What RPO and RTO mean** (and why confusing them costs companies millions)
- **How to design systems that survive datacenter failures** (Availability Zones)
- **How to design systems that survive regional disasters** (Multi-region DR)
- **Real-world DR architectures** with actual costs and trade-offs
- **How to test your DR plan** (because untested plans always fail)

---

## Introduction: What is High Availability & Disaster Recovery?

### Start Here if You're Completely New

**High Availability (HA) = Your app stays online even when things break**
**Disaster Recovery (DR) = Your app can recover from catastrophic failures**

Think of it like a restaurant:

**High Availability (HA)**:
- Problem: One cook gets sick
- Solution: You have 3 cooks (redundancy)
- Result: Restaurant stays open ‚úÖ
- Downtime: 0 seconds

**Disaster Recovery (DR)**:
- Problem: Fire destroys the entire restaurant
- Solution: You have a second location across town (backup site)
- Result: Open at backup location in 2 hours ‚úÖ
- Downtime: 2 hours (but you survived!)

**Key Difference**:
- **HA** = Handles small failures (broken VM, network glitch) ‚Üí Seconds of downtime
- **DR** = Handles catastrophic failures (datacenter destroyed, region offline) ‚Üí Hours of downtime

---

## Why This Matters: The Cost of Downtime

### Real-World Disaster Example

**Amazon Prime Day Outage (2018)**
- **What happened**: Website crashed for 63 minutes during biggest sale day
- **Revenue loss**: $99 million in 63 minutes
- **Per-minute cost**: $1.57 million/minute
- **Per-second cost**: $26,000/second

Every second your app is down = money lost + customers lost + reputation damaged.

**More Real Examples**:

| Company | Incident | Downtime | Cost | Cause |
|---------|----------|----------|------|-------|
| **Facebook** | Oct 2021 | 6 hours | $60-100M | BGP routing error |
| **GitHub** | Oct 2018 | 24 hours | Unknown | Network partition |
| **Google Cloud** | Jun 2019 | 4.5 hours | Unknown | Configuration error |
| **British Airways** | May 2017 | 3 days | $100M+ | Power surge |

**The Pattern**: Companies that invest in HA/DR save millions. Companies that don't, lose millions.

---

## Understanding SLAs (Service Level Agreements)

### What is an SLA?

**SLA = A promise about how much downtime is acceptable**

Think of it like a pizza delivery guarantee:
- Pizza delivery SLA: "30 minutes or it's free"
- Azure VM SLA: "99.9% uptime or we give you credits"

### SLA Math Explained (From Scratch)

**99.9% uptime** sounds amazing, right? Let's see what it actually means:

```
100% - 99.9% = 0.1% downtime allowed

0.1% of 1 month (30 days) = ?

Calculation:
30 days = 30 √ó 24 hours = 720 hours
0.1% of 720 hours = 0.72 hours = 43.2 minutes

Result: 99.9% SLA = 43 minutes of downtime per month is OK ‚ö†Ô∏è
```

**Translation Table**:

| SLA | Downtime/Month | Downtime/Year | Real-World Impact |
|-----|----------------|---------------|-------------------|
| **99%** | 7.2 hours | 3.65 days | ‚ùå Unacceptable for production |
| **99.9%** | 43.2 minutes | 8.76 hours | ‚ö†Ô∏è OK for internal tools |
| **99.95%** | 21.6 minutes | 4.38 hours | ‚úÖ Good for most apps |
| **99.99%** | 4.3 minutes | 52.56 minutes | ‚úÖ Great for e-commerce |
| **99.999%** | 26 seconds | 5.26 minutes | üöÄ Required for banking |

**Example**: Your e-commerce site makes $100,000/day

- **99.9% SLA**: 43 minutes downtime/month = $3,000 lost revenue
- **99.99% SLA**: 4.3 minutes downtime/month = $300 lost revenue
- **Cost to upgrade**: ~$200/month
- **Savings**: $2,700/month ‚Üí 13.5x ROI ‚úÖ

---

## How Azure Achieves High Availability

### The Building Blocks (From Smallest to Largest)

```
1. Physical Server (Single point of failure ‚ùå)
   ‚Üì
2. Availability Set (Multiple servers in same datacenter ‚úÖ)
   ‚Üì
3. Availability Zone (Multiple datacenters in same region ‚úÖ‚úÖ)
   ‚Üì
4. Region Pair (Multiple regions 1,000+ km apart ‚úÖ‚úÖ‚úÖ)
```

Let's understand each one:

---

### 1. Single VM (No High Availability)

```
Your Application
  ‚Üì
Single VM in Azure
  ‚Üì
Physical Server #47 in East US Datacenter

What Happens if Physical Server #47 fails?
- Your VM goes down ‚ùå
- Downtime: 10-30 minutes (while Azure moves VM to new server)
- SLA: 99.9% (43 minutes downtime/month)
```

**Real-World Analogy**: Running a restaurant with only 1 cook. Cook gets sick = restaurant closes.

---

### 2. Availability Set (Same Datacenter, Different Racks)

```
Your Application (Load Balanced)
  ‚îú‚îÄ‚îÄ VM 1 ‚Üí Physical Server #47 (Rack A)
  ‚îú‚îÄ‚îÄ VM 2 ‚Üí Physical Server #128 (Rack B)
  ‚îî‚îÄ‚îÄ VM 3 ‚Üí Physical Server #201 (Rack C)

All in the same datacenter, but different racks (power/network isolation)

What Happens if Physical Server #47 fails?
- VM 1 goes down ‚ùå
- VM 2 and VM 3 still running ‚úÖ
- Load balancer routes traffic to healthy VMs
- Downtime: 0 seconds ‚úÖ
- SLA: 99.95% (21 minutes downtime/month)
```

**Real-World Analogy**: Restaurant with 3 cooks. One cook gets sick = other 2 keep working.

**Cost Example**:
- 1 VM (99.9%): $50/month ‚Üí 43 min downtime
- 3 VMs in Availability Set (99.95%): $150/month ‚Üí 21 min downtime
- Extra cost: $100/month ‚Üí Saves 22 minutes of downtime

---

### 3. Availability Zones (Different Datacenters, Same Region)

```
East US Region (has 3 Availability Zones)

Zone 1: Datacenter Building A (15 km away)
  ‚îî‚îÄ‚îÄ VM 1

Zone 2: Datacenter Building B (20 km away)
  ‚îî‚îÄ‚îÄ VM 2

Zone 3: Datacenter Building C (25 km away)
  ‚îî‚îÄ‚îÄ VM 3

Each zone has independent:
- Power supply (different power grid)
- Cooling system
- Network connections

What Happens if Entire Datacenter Building A loses power?
- Zone 1 (VM 1) goes down ‚ùå
- Zone 2 (VM 2) still running ‚úÖ
- Zone 3 (VM 3) still running ‚úÖ
- Downtime: 0 seconds ‚úÖ
- SLA: 99.99% (4.3 minutes downtime/month)
```

**Real-World Analogy**: Restaurant chain with 3 locations in same city. One location catches fire = other 2 still serve customers.

**Cost Example**:
- 3 VMs in Availability Set (99.95%): $150/month ‚Üí 21 min downtime
- 3 VMs across Availability Zones (99.99%): $150/month ‚Üí 4.3 min downtime
- Extra cost: $0 (same price!) ‚Üí Saves 17 minutes of downtime ‚úÖ

**Why Availability Zones are Better**:
- Protects against datacenter-level disasters (fire, flood, power outage)
- Same cost as Availability Set
- Higher SLA (99.99% vs 99.95%)

---

### 4. Multi-Region (Disaster Recovery)

```
Primary Region: East US
  ‚îî‚îÄ‚îÄ 3 VMs across Availability Zones (99.99% SLA)

Secondary Region: West Europe (4,000 km away)
  ‚îî‚îÄ‚îÄ 3 VMs across Availability Zones (standby)

Azure Front Door (Global Load Balancer)
  ‚îú‚îÄ‚îÄ Route to East US (primary)
  ‚îî‚îÄ‚îÄ Failover to West Europe (if East US fails)

What Happens if Entire East US Region goes offline?
(Hurricane, earthquake, massive network outage)
- East US completely offline ‚ùå
- Front Door automatically routes to West Europe ‚úÖ
- Downtime: 2-5 minutes (DNS propagation) ‚úÖ
- SLA: 99.99%+ (composite SLA)
```

**Real-World Analogy**: Restaurant chain with locations in New York and London. Hurricane destroys New York = London location still serves customers.

**Cost Example**:
- Single Region (East US): $150/month ‚Üí 4.3 min downtime
- Multi-Region (East US + West Europe): $300/month ‚Üí 2 min downtime
- Extra cost: $150/month ‚Üí Protects against regional disasters

**When You Need Multi-Region**:
- ‚úÖ Mission-critical applications (banking, healthcare)
- ‚úÖ Global user base (low latency everywhere)
- ‚úÖ Compliance requirements (data residency)
- ‚ùå Small internal tools (not worth the cost)

---

## 1. Availability SLAs

<Tabs>
  <Tab title="SLA Levels">
    ```
    99%     = 7.2 hours downtime/month
    99.9%   = 43.2 minutes downtime/month
    99.95%  = 21.6 minutes downtime/month
    99.99%  = 4.3 minutes downtime/month
    99.999% = 26 seconds downtime/month
    ```
  </Tab>

  <Tab title="Azure Service SLAs">
    | Service | Configuration | SLA |
    |---------|--------------|-----|
    | **VM** | Single instance (Premium SSD) | 99.9% |
    | **VM** | 2+ in Availability Set | 99.95% |
    | **VM** | 2+ across Availability Zones | 99.99% |
    | **App Service** | Standard tier | 99.95% |
    | **Azure SQL** | General Purpose | 99.99% |
    | **Azure SQL** | Business Critical (zone-redundant) | 99.995% |
    | **Cosmos DB** | Single region | 99.99% |
    | **Cosmos DB** | Multi-region | 99.999% |
  </Tab>
</Tabs>

---

## Understanding RPO & RTO (From Absolute Zero)

### What is RPO and RTO?

These are the TWO most important numbers in disaster recovery. Companies have lost millions by confusing these.

**RPO (Recovery Point Objective) = "How much data can we afford to lose?"**
**RTO (Recovery Time Objective) = "How long can we be offline?"**

### Real-World Analogy: Writing a Book

Imagine you're writing a 500-page book on your computer:

**Scenario 1: You save every 5 minutes (RPO = 5 minutes)**
```
Time: 2:00 PM ‚Üí You save your work (page 247)
Time: 2:03 PM ‚Üí You write 2 more pages (now on page 249)
Time: 2:05 PM ‚Üí COMPUTER CRASHES! ‚ùå

What happened:
- Last save: 2:00 PM (page 247)
- Crash: 2:05 PM (page 249)
- Lost work: 2 pages (5 minutes of work)

RPO = 5 minutes (you lost 5 minutes of work)
```

**Scenario 2: You save every 1 hour (RPO = 1 hour)**
```
Time: 1:00 PM ‚Üí You save your work (page 220)
Time: 1:58 PM ‚Üí You write 29 more pages (now on page 249)
Time: 2:00 PM ‚Üí COMPUTER CRASHES! ‚ùå

What happened:
- Last save: 1:00 PM (page 220)
- Crash: 2:00 PM (page 249)
- Lost work: 29 pages (1 hour of work)

RPO = 1 hour (you lost 1 hour of work)
```

**RPO = Time between backups = Amount of data you can lose**

---

### Now RTO (Recovery Time Objective)

**RTO = How long until you're back to work after a disaster**

Continuing the book analogy:

**Scenario 1: Backup laptop ready (RTO = 5 minutes)**
```
Time: 2:00 PM ‚Üí Computer crashes ‚ùå
Time: 2:01 PM ‚Üí Grab backup laptop from closet
Time: 2:03 PM ‚Üí Log into backup laptop
Time: 2:05 PM ‚Üí Open last saved version (from 2:00 PM)
Time: 2:05 PM ‚Üí Back to writing! ‚úÖ

RTO = 5 minutes (time to get back to work)
```

**Scenario 2: Need to buy new laptop (RTO = 3 days)**
```
Day 1, 2:00 PM ‚Üí Computer crashes ‚ùå
Day 1, 3:00 PM ‚Üí Drive to store, store is out of stock
Day 2, 10:00 AM ‚Üí Order laptop online
Day 3, 4:00 PM ‚Üí Laptop arrives, install software
Day 3, 6:00 PM ‚Üí Back to writing! ‚úÖ

RTO = 3 days (time to get back to work)
```

**RTO = Time to recover from disaster = How long you're offline**

---

### The Critical Difference (Why Companies Confuse This)

> [!WARNING]
> **Common Mistake: Confusing RPO and RTO**
> **RPO = Data Loss (measured in TIME since last backup)**
> **RTO = Downtime (measured in TIME to recover)**

You can have DIFFERENT combinations:

**Example 1: Low RPO, High RTO**
```
E-commerce Database:
- RPO: 1 minute (backup every minute)
- RTO: 4 hours (takes 4 hours to restore from backup)

Result:
- Data loss: Only 1 minute of orders lost ‚úÖ
- Downtime: 4 hours offline ‚ùå
- Lost revenue: $400,000 (at $100,000/hour)
```

**Example 2: High RPO, Low RTO**
```
Analytics Dashboard:
- RPO: 24 hours (backup once daily)
- RTO: 5 minutes (hot standby ready)

Result:
- Data loss: 24 hours of analytics data lost ‚ùå (but analytics can be regenerated)
- Downtime: 5 minutes offline ‚úÖ
- Lost revenue: $0 (dashboard back quickly)
```

**Example 3: Low RPO, Low RTO (Expensive but Best)**
```
Banking System:
- RPO: 0 seconds (continuous replication)
- RTO: 30 seconds (automatic failover)

Result:
- Data loss: 0 transactions lost ‚úÖ
- Downtime: 30 seconds offline ‚úÖ
- Lost revenue: Minimal
- Cost: High ($$$$)
```

---

### Real-World RPO/RTO Example: GitLab Database Incident (2017)

**The Disaster**:
- GitLab engineer accidentally deleted production database
- 300 GB of data vanished

**What They THOUGHT Their RPO Was**: 24 hours (daily backups)

**What Their RPO ACTUALLY Was**: 6 hours (daily backups were failing, only staging backups worked)

**Actual Result**:
- **RPO**: 6 hours ‚Üí Lost 6 hours of data (5,000 projects, 5,000 comments, 700 new users)
- **RTO**: 18 hours ‚Üí Took 18 hours to restore from backups
- **Total impact**: 6 hours of data lost + 18 hours offline
- **Cost**: Immeasurable reputation damage (but they recovered with transparency)

**Lesson**: Your DR plan is only as good as your last successful restore TEST.

---

### How to Choose Your RPO/RTO

**Step 1: Calculate Cost of Downtime**
```
Your e-commerce site makes $100,000/day

Cost per hour = $100,000 √∑ 24 = $4,166/hour
Cost per minute = $4,166 √∑ 60 = $69/minute
Cost per second = $69 √∑ 60 = $1.15/second
```

**Step 2: Calculate Acceptable Loss**
```
Question: "Can we afford to lose 1 hour of orders?"

1 hour of orders = $4,166 in revenue

If RTO = 1 hour:
- Lost revenue: $4,166
- Acceptable? (You decide based on business impact)

If RTO = 5 minutes:
- Lost revenue: $347
- Acceptable? (Much better!)
```

**Step 3: Calculate Cost of DR Solution**
```
Option 1: Daily Backups
- RPO: 24 hours
- RTO: 4 hours
- Cost: $50/month
- Risk: Lose up to $100,000 in orders + 4 hours downtime ($16,664)

Option 2: Continuous Replication + Auto-Failover
- RPO: 0 seconds
- RTO: 2 minutes
- Cost: $500/month
- Risk: Lose 2 minutes of uptime ($138)

Which is better?
- Option 2 costs $450 more per month
- But saves $100,000+ in potential losses
- ROI: 222x return on investment ‚úÖ
```

---

### Decision Tree: Choosing RPO/RTO

```
Q1: What type of application?

‚îú‚îÄ Internal Tool (HR dashboard, wiki)
‚îÇ  ‚îú‚îÄ RPO: 24 hours (daily backup OK)
‚îÇ  ‚îî‚îÄ RTO: 4 hours (users can wait)
‚îÇ  ‚îî‚îÄ Solution: Daily backups ($50/month)
‚îÇ
‚îú‚îÄ Customer-Facing App (blog, docs site)
‚îÇ  ‚îú‚îÄ RPO: 1 hour (acceptable data loss)
‚îÇ  ‚îî‚îÄ RTO: 1 hour (acceptable downtime)
‚îÇ  ‚îî‚îÄ Solution: Hourly backups + standby VM ($200/month)
‚îÇ
‚îú‚îÄ E-commerce / Revenue-Generating
‚îÇ  ‚îú‚îÄ RPO: 5 minutes (minimal data loss)
‚îÇ  ‚îî‚îÄ RTO: 5 minutes (minimal downtime)
‚îÇ  ‚îî‚îÄ Solution: Continuous replication + auto-failover ($500/month)
‚îÇ
‚îî‚îÄ Banking / Healthcare / Critical
   ‚îú‚îÄ RPO: 0 seconds (zero data loss)
   ‚îî‚îÄ RTO: 30 seconds (near-zero downtime)
   ‚îî‚îÄ Solution: Synchronous replication + active-active ($2,000/month)
```

---

## 2. RPO & RTO

> [!WARNING]
> **Gotcha: RPO vs RTO**
> A common interview trap.
> **RPO (Point)** = Data Loss (How far back do we go?)
> **RTO (Time)** = Downtime (How long until we are back online?)
> You can have low RPO (0 data loss) but high RTO (took 4 hours to restart).

> [!TIP]
> **Jargon Alert: Split Brain**
> A disaster scenario where two databases both think they are "Primary" and accept writes at the same time, corrupting data. Always use a "Witness" or "Quorum" to preventing this in active-active architectures.

**Quick Reference** (after reading the detailed explanation above):
**RPO (Recovery Point Objective)**: How much data loss is acceptable?
**RTO (Recovery Time Objective)**: How long to recover?

<div className="flex justify-center my-4">
  <div className="w-full max-w-4xl">
    ```mermaid
    graph LR
        A[Normal Operation] --> B[Disaster Occurs]
        B --> C[Last Backup<br/>RPO]
        C --> D[Recovery Process<br/>RTO]
        D --> E[Service Restored]

        style B fill:#FF6B6B
        style E fill:#51CF66
    ```
  </div>
</div>

### Example Scenarios

```
Scenario 1: E-commerce Site
RPO: 5 minutes (transactional data)
RTO: 15 minutes (revenue impact)
Solution: Auto-failover groups, zone-redundant services

Scenario 2: Internal Analytics
RPO: 24 hours (reports can be delayed)
RTO: 4 hours (not business-critical)
Solution: Daily backups, manual recovery

Scenario 3: Banking System
RPO: 0 seconds (no data loss acceptable)
RTO: < 1 minute (critical business)
Solution: Synchronous replication, active-active
```

---

## Common Mistakes in HA/DR (Learn from Others' Failures)

### Mistake #1: "Stopped" VMs Still Cost Money

**The Trap**:
```
Developer thinks: "I'll save money by stopping VMs at night"

Developer clicks "Stop" in Azure Portal
VM Status: "Stopped" ‚úÖ

Month-end bill arrives: Still charged $2,000! ‚ùå
```

**What Happened**:
- "Stopped" = OS shutdown, but VM resources still reserved
- You still pay for compute, just not OS license
- **Correct action**: "Deallocate" (not just "Stop")

**Cost Impact**:
- Stopped VM: Still ~80% of full cost
- Deallocated VM: Only pay for storage (~5% of full cost)

**Fix**:
```bash
# WRONG (still costs money)
az vm stop --name myVM --resource-group myRG

# CORRECT (actually saves money)
az vm deallocate --name myVM --resource-group myRG
```

**Savings**: $1,600/month per VM ‚úÖ

---

### Mistake #2: Untested Backups (The GitLab Disaster)

**The Trap**:
```
Company: "We have daily backups, we're safe!"

Reality:
- Backups running for 6 months ‚úÖ
- Never tested a restore ‚ùå
- Disaster strikes
- Try to restore... backups are CORRUPTED ‚ùå
- All backups unusable
```

**Real Example: Code Spaces (2014)**:
- Hosting company for developers
- Backups existed but were on same infrastructure
- Hacker deleted everything (including backups)
- **Company went out of business**
- Customers lost everything

**The Fix**: Test quarterly
```
Q1: January ‚Üí Test restore production database to staging
Q2: April ‚Üí Test restore VM from backup
Q3: July ‚Üí Test failover to secondary region
Q4: October ‚Üí Full disaster recovery drill
```

**Cost of Testing**: $500/month (test infrastructure)
**Cost of Untested Backup**: Business bankruptcy ‚ùå

---

### Mistake #3: Ignoring Composite SLAs

**The Trap**:
```
Architect: "Our app has 99.99% SLA!"

Reality:
App Service (99.95%) √ó Azure SQL (99.99%) √ó Redis (99.9%)
= 99.95% √ó 99.99% √ó 99.9%
= 99.84% actual SLA ‚ùå

99.84% = 69 minutes downtime/month (not 4.3 minutes!)
```

**The Math** (Explained Simply):
```
When you chain services, SLAs MULTIPLY:

Service A: 99.9% availability = 99.9% = 0.999
Service B: 99.9% availability = 99.9% = 0.999

Combined: 0.999 √ó 0.999 = 0.998001 = 99.8%

Translation:
- Promised: 99.9% (43 min downtime)
- Actual: 99.8% (86 min downtime)
- Difference: 2x more downtime! ‚ùå
```

**Real Example**:
```
E-commerce Application Stack:
‚îú‚îÄ‚îÄ Azure Front Door: 99.99%
‚îú‚îÄ‚îÄ App Service: 99.95%
‚îú‚îÄ‚îÄ Azure SQL: 99.99%
‚îú‚îÄ‚îÄ Redis Cache: 99.9%
‚îî‚îÄ‚îÄ Blob Storage: 99.99%

Combined SLA:
0.9999 √ó 0.9995 √ó 0.9999 √ó 0.999 √ó 0.9999 = 0.9982 = 99.82%

Expected downtime: 4.3 min/month
Actual downtime: 77 min/month (18x worse!)
```

**The Fix**: Add redundancy
```
Option 1: Single Region
- Combined SLA: 99.82%
- Downtime: 77 min/month

Option 2: Multi-Region (Active-Passive)
- Each region: 99.82%
- Probability both fail: 0.18% √ó 0.18% = 0.0324%
- Combined SLA: 99.97%
- Downtime: 13 min/month

Improvement: 6x better SLA ‚úÖ
```

---

### Mistake #4: Forgetting About Data Gravity

**The Trap**:
```
Architect: "We'll replicate to 5 regions for global HA!"

Reality:
- Application (100 MB): Replicates in seconds ‚úÖ
- Database (500 GB): Takes 4 hours to replicate ‚ùå
- Failover time: 4+ hours (waiting for data sync) ‚ùå
```

**Data Gravity = Large data is slow to move**

**Real Numbers**:
```
Replication Speed: ~50 MB/second (typical Azure inter-region)

Small Database (10 GB):
- Replication time: 200 seconds (3.3 minutes) ‚úÖ

Medium Database (500 GB):
- Replication time: 10,000 seconds (2.7 hours) ‚ö†Ô∏è

Large Database (10 TB):
- Replication time: 200,000 seconds (55 hours!) ‚ùå
```

**The Fix**: Plan for data size
```
Scenario: E-commerce with 2 TB database

Option 1: Full replication on failover (Bad)
- RTO: 27+ hours ‚ùå

Option 2: Continuous async replication (Good)
- Database always synced (5-10 min lag)
- RTO: 5-10 minutes ‚úÖ
- Cost: $800/month (geo-replication)

Option 3: Synchronous replication (Best)
- Database synced in real-time (0 lag)
- RTO: 30 seconds ‚úÖ
- Cost: $2,000/month (active-active)
```

---

### Mistake #5: Active-Active Without Proper Conflict Resolution

**The Trap**:
```
Architect: "Let's run database in both regions actively!"

User in US: Updates customer email to "new@email.com" (Region 1)
User in EU: Updates same customer email to "different@email.com" (Region 2)
  ‚Üì
CONFLICT: Which email is correct? ‚ùå
  ‚Üì
Split-brain scenario: Data corruption ‚ùå
```

**Real Example: Uber (2016)**:
- Active-active setup without proper conflict resolution
- Network partition between datacenters
- Both sides accepted writes
- Data corruption cost hundreds of hours to resolve

**The Fix**: Choose conflict resolution strategy
```
Strategy 1: Last-Write-Wins (LWW)
- Keep the most recent update (based on timestamp)
- Simple but data loss possible
- Good for: Analytics, non-critical data

Strategy 2: Application-Level Conflict Resolution
- Application decides which update wins
- Complex but no data loss
- Good for: Banking, critical applications

Strategy 3: Avoid Conflicts (Partition Data)
- US customers ‚Üí US region only
- EU customers ‚Üí EU region only
- Never have conflicts (single writer per data)
- Good for: Global applications with regional data
```

---

## 3. High Availability Patterns

<AccordionGroup>
  <Accordion title="1. Active-Passive" icon="power-off">
    ```
    Primary Region (Active)
      - Handles all traffic
      - Replicates to secondary

    Secondary Region (Passive)
      - Standby mode
      - Activated on primary failure

    Pros: Simple, cost-effective
    Cons: Unused capacity, manual failover
    ```
  </Accordion>

  <Accordion title="2. Active-Active" icon="bolt">
    ```
    Region 1 (Active)
      - Handles 50% traffic

    Region 2 (Active)
      - Handles 50% traffic

    Both regions process requests simultaneously

    Pros: Maximum availability, no wasted capacity
    Cons: Complex (data conflicts), expensive
    ```
  </Accordion>

  <Accordion title="3. Multi-Region with Traffic Manager" icon="globe">
    ```
    Azure Front Door / Traffic Manager
      ‚îú‚îÄ‚îÄ Primary: East US (priority 1)
      ‚îú‚îÄ‚îÄ Secondary: West Europe (priority 2)
      ‚îî‚îÄ‚îÄ Tertiary: Southeast Asia (priority 3)

    Automatic failover based on health probes
    ```
  </Accordion>
</AccordionGroup>

---

## 4. Disaster Recovery Architecture

<Frame>
  <img src="/images/azure/13-azure-site-recovery.svg" alt="Azure Site Recovery Multi-Region DR Architecture" />
</Frame>


### Example: E-Commerce Platform

```
Primary Region: East US
- App Service (zone-redundant)
- Azure SQL (zone-redundant)
- Redis Cache (zone-redundant)
- Front Door (global)

Secondary Region: West US (Passive)
- App Service (scaled to minimum)
- Azure SQL (geo-replica, read-only)
- Redis Cache (geo-replication)

Failover Process:
1. Front Door detects primary unhealthy
2. Routes traffic to secondary (automatic)
3. Promote SQL replica to primary
4. Scale up App Service instances
5. Total failover time: < 5 minutes
```

---

## 5. Backup Strategies

<Tabs>
  <Tab title="VMs">
    ```bash
    # Enable Azure Backup
    az backup protection enable-for-vm \
      --resource-group rg-prod \
      --vault-name RecoveryServicesVault \
      --vm vm-web-01 \
      --policy-name DefaultPolicy

    # Retention:
    # - Daily: 7 days
    # - Weekly: 4 weeks
    # - Monthly: 12 months
    # - Yearly: 10 years
    ```
  </Tab>

  <Tab title="Databases">
    ```
    Azure SQL:
    - Automatic backups (7-35 days)
    - Point-in-time restore
    - Long-term retention (up to 10 years)
    - Geo-restore (to any region)

    Cosmos DB:
    - Continuous backup (30 days)
    - Point-in-time restore
    - Restore to same or different account
    ```
  </Tab>

  <Tab title="Storage">
    ```
    Blob Storage:
    - Soft delete (7-365 days)
    - Blob versioning
    - Snapshots
    - GRS (geo-redundant storage)

    Lifecycle management:
    - Hot ‚Üí Cool ‚Üí Archive
    - Automated retention policies
    ```
  </Tab>
</Tabs>

---

## 6. Testing DR Plan

**Disaster Recovery Drill Checklist**:

```
‚úÖ Document all runbooks
‚úÖ Test failover quarterly
‚úÖ Measure actual RTO/RPO
‚úÖ Update contact lists
‚úÖ Test backup restores
‚úÖ Verify monitoring alerts
‚úÖ Review and update documentation
‚úÖ Conduct post-drill review
```

---

---

## 7. Interview Questions

### Beginner Level

<AccordionGroup>
  <Accordion title="Q1: What is the difference between Availability and Durability?">
    **Answer**:
    - **Availability**: Uptime. Can I access the service right now? (e.g., SLA 99.9%).
    - **Durability**: Data integrity. Is my data safe from loss? (e.g., 11 nines 99.999999999% for Blob Storage).
    *You can have high availability but lose data (corruption), or high durability but be offline.*
  </Accordion>

  <Accordion title="Q2: What is an Availability Zone?">
    **Answer**:
    A physically separate datacenter within the same Azure Context (Region). It has independent power, cooling, and networking.
    Protects against datacenter-level failures (fire, power cut).
  </Accordion>
</AccordionGroup>

### Intermediate Level

<AccordionGroup>
  <Accordion title="Q3: Explain RPO and RTO in simple terms">
    **Answer**:
    - **RPO (Recovery Point Objective)**: "How much data can we lose?" (Time since last backup).
    - **RTO (Recovery Time Objective)**: "How long can we be down?" (Time to restore service).
  </Accordion>

  <Accordion title="Q4: Active-Passive vs Active-Active?">
    **Answer**:
    - **Active-Passive**: One region handles traffic. Secondary is standby. Cheaper, slower failover (RTO > 0).
    - **Active-Active**: Both regions handle traffic. Complex data sync. Expensive. zero downtime failover (RTO ‚âà 0).
  </Accordion>
</AccordionGroup>

### Advanced Level

<AccordionGroup>
  <Accordion title="Q5: How do you achieve 99.99% SLA not offered by a single service?">
    **Answer**:
    By using **Composite SLAs**.
    If you have two regions, each with 99.9% availability, the probability of *both* failing simultaneously is $0.1\% \times 0.1\% = 0.01\%$.
    Total Availability = $100\% - 0.01\% = 99.99\%$.
    *Redundancy increases availability.*
  </Accordion>
</AccordionGroup>

---

## 8. Key Takeaways

<CardGroup cols={2}>
  <Card title="SLA Mathematics" icon="calculator">
    Understand how SLAs compound. Dependencies reduce availability; Redundancy increases it.
  </Card>
  <Card title="Zones vs Regions" icon="map">
    Use **Zones** for synchronous HA (High Availability). Use **Regions** for asynchronous DR (Disaster Recovery).
  </Card>
  <Card title="Data Gravity" icon="database">
    Compute is stateless and easy to move. Data is heavy and hard to sync. Focus DR efforts on data replication.
  </Card>
  <Card title="Testing" icon="vial">
    A backup is useless if you can't restore it. A DR plan is a hypothesis until tested.
  </Card>
  <Card title="Business Alignment" icon="briefcase">
    RPO/RTO are business decisions, not technical ones. They dictate the cost of the designated solution.
  </Card>
</CardGroup>

---

## Next Steps

<Card title="Continue to Chapter 14" icon="arrow-right" href="/courses/azure-cloud-engineering/14-architecture-patterns">
  Master real-world Azure architecture patterns and design principles
</Card>
