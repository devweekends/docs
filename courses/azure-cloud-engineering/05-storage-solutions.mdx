---
title: "Storage Solutions"
description: "Master Azure Storage: Blob, Files, Disks, and data management strategies"
icon: "database"
---

# Storage Solutions

Azure Storage is the backbone of data persistence in Azure. Understanding storage options is crucial for building performant, cost-effective applications.

![Azure Storage Types](/images/azure/05-storage-types.svg)

> [!WARNING]
> **Gotcha: Changing Access Tiers**
> Moving data from **Hot to Cool** is free, but moving data from **Cool to Hot** incurs an "Early Deletion" or "Retrieval" fee. Don't use Archive tier for backups you might need to restore instantly—it can take hours to "rehydrate" data.

> [!TIP]
> **Jargon Alert: Replication**
> **LRS (Locally Redundant)**: 3 copies in one building (Good enough for non-critical dev).
> **GRS (Geo-Redundant)**: 3 copies here + 3 copies in a different region (Essential for Disaster Recovery).

---

## 1. Azure Storage Services Overview

<CardGroup cols={2}>
  <Card title="Blob Storage" icon="cube">
    **Unstructured object storage**
    - Images, videos, documents
    - Backups, logs, archives
    - Data lakes
    - Hot, Cool, Archive tiers
  </Card>

  <Card title="Azure Files" icon="folder">
    **Fully managed file shares**
    - SMB/NFS protocols
    - Lift-and-shift migrations
    - Shared app data
    - Replace on-premises file servers
  </Card>

  <Card title="Queue Storage" icon="list">
    **Message queuing**
    - Asynchronous processing
    - Decoupling components
    - Up to 64 KB per message
    - Simple, reliable messaging
  </Card>

  <Card title="Table Storage" icon="table">
    **NoSQL key-value store**
    - Schema-less
    - Fast queries
    - Cost-effective
    - Structured non-relational data
  </Card>
</CardGroup>

---

## 2. Blob Storage Deep Dive

**Blob Storage** stores massive amounts of unstructured data.

### Blob Types

<Tabs>
  <Tab title="Block Blobs">
    **Optimized for streaming and cloud storage**

    ```
    Use cases:
    - Documents (PDF, Word, Excel)
    - Media (images, audio, video)
    - Logs and telemetry
    - Backups

    Characteristics:
    - Up to 190.7 TB per blob
    - Composed of blocks (up to 4.75 TB each)
    - Can update individual blocks
    - Most common blob type (95% of use cases)
    ```

    **Upload block blob**:
    ```bash
    az storage blob upload \
      --account-name mystorageaccount \
      --container-name mycontainer \
      --name mydocument.pdf \
      --file ./local-file.pdf \
      --auth-mode key
    ```
  </Tab>

  <Tab title="Page Blobs">
    **Optimized for random read/write**

    ```
    Use cases:
    - Azure VM disks (VHD files)
    - Database files
    - Random access scenarios

    Characteristics:
    - Up to 8 TB per blob
    - Optimized for frequent read/write
    - 512-byte page alignment
    - Higher cost than block blobs
    ```

    **Most users never directly use page blobs** (Azure manages them for VM disks).
  </Tab>

  <Tab title="Append Blobs">
    **Optimized for append operations**

    ```
    Use cases:
    - Logging and auditing
    - Time-series data
    - IoT telemetry

    Characteristics:
    - Up to 195 GB per blob
    - Append-only (no update/delete of blocks)
    - Efficient for log aggregation
    ```

    **Append to blob**:
    ```bash
    az storage blob append \
      --account-name mystorageaccount \
      --container-name logs \
      --name application.log \
      --file ./new-logs.txt
    ```
  </Tab>
</Tabs>

### Storage Tiers

<Tabs>
  <Tab title="Hot Tier">
    **Frequently accessed data**

    ```
    Pricing:
    Storage: $0.018/GB/month
    Read: $0.0004/10K operations
    Write: $0.05/10K operations

    Use for:
    - Active website images
    - Recently uploaded files
    - Frequently accessed documents

    Min storage duration: None
    ```
  </Tab>

  <Tab title="Cool Tier">
    **Infrequently accessed (30+ days)**

    ```
    Pricing:
    Storage: $0.01/GB/month (44% cheaper)
    Read: $0.01/10K operations (25x more expensive)
    Write: $0.10/10K operations (2x more expensive)

    Use for:
    - Short-term backups
    - Older media content
    - 30-90 day retention

    Min storage duration: 30 days
    Early deletion penalty: Pro-rated charge
    ```
  </Tab>

  <Tab title="Archive Tier">
    **Rarely accessed (180+ days)**

    ```
    Pricing:
    Storage: $0.00099/GB/month (98% cheaper!)
    Read: $0.02/10K operations
    Rehydration: $0.02/GB (to hot) or $0.01/GB (to cool)

    Use for:
    - Long-term backups
    - Compliance archives
    - Rarely accessed data

    Min storage duration: 180 days
    Rehydration time: Up to 15 hours
    ```

    **Rehydrate blob**:
    ```bash
    # Rehydrate to hot tier
    az storage blob set-tier \
      --account-name mystorageaccount \
      --container-name archives \
      --name backup-2020.zip \
      --tier Hot \
      --rehydrate-priority High
    ```
  </Tab>
</Tabs>

### Lifecycle Management

**Automatically transition blobs between tiers** to optimize costs.

```json
{
  "rules": [
    {
      "name": "MoveToArchive",
      "enabled": true,
      "type": "Lifecycle",
      "definition": {
        "filters": {
          "blobTypes": ["blockBlob"],
          "prefixMatch": ["backups/"]
        },
        "actions": {
          "baseBlob": {
            "tierToCool": {
              "daysAfterModificationGreaterThan": 30
            },
            "tierToArchive": {
              "daysAfterModificationGreaterThan": 90
            },
            "delete": {
              "daysAfterModificationGreaterThan": 365
            }
          }
        }
      }
    }
  ]
}
```

```bash
# Apply lifecycle policy
az storage account management-policy create \
  --account-name mystorageaccount \
  --policy @lifecycle-policy.json \
  --resource-group rg-storage
```

### Blob Versioning and Soft Delete

<CardGroup cols={2}>
  <Card title="Blob Versioning" icon="clock-rotate-left">
    **Keep all versions of a blob**

    ```bash
    # Enable versioning
    az storage account blob-service-properties update \
      --account-name mystorageaccount \
      --enable-versioning true

    # Every modification creates new version
    # Old versions accessible by version ID
    # Protects against accidental overwrites
    ```

    **Use case**: Track document changes, audit trail
  </Card>

  <Card title="Soft Delete" icon="trash-arrow-up">
    **Recoverable deletion**

    ```bash
    # Enable soft delete (7 days)
    az storage account blob-service-properties update \
      --account-name mystorageaccount \
      --enable-delete-retention true \
      --delete-retention-days 7

    # Deleted blobs retained for 7 days
    # Can undelete within retention period
    ```

    **Use case**: Protect against accidental deletion
  </Card>
</CardGroup>

### Blob Storage Security

<Tabs>
  <Tab title="Access Control">
    **Three levels of access**:

    1. **Storage Account Keys** (avoid in production):
    ```bash
    # Full access to entire storage account
    # Rotate regularly (90 days)
    az storage account keys list \
      --account-name mystorageaccount
    ```

    2. **Shared Access Signature (SAS)**:
    ```bash
    # Time-limited, scoped access
    az storage blob generate-sas \
      --account-name mystorageaccount \
      --container-name mycontainer \
      --name myblob.txt \
      --permissions r \
      --expiry 2026-12-31T23:59:59Z

    # Result: URL with token
    # Expires automatically
    ```

    3. **Azure AD (Recommended)**:
    ```bash
    # Use managed identity or user identity
    # RBAC roles: Storage Blob Data Reader/Contributor
    az role assignment create \
      --role "Storage Blob Data Contributor" \
      --assignee <identity-id> \
      --scope /subscriptions/.../storageAccounts/mystorageaccount
    ```
  </Tab>

  <Tab title="Encryption">
    **Encryption at Rest**:

    ```
    Default: Microsoft-managed keys (automatic)
      ✅ No configuration needed
      ✅ Free
      ❌ Microsoft controls keys

    Customer-managed keys (CMK):
      ✅ You control key rotation
      ✅ Audit key access
      ⚠️  Requires Azure Key Vault
    ```

    **Enable CMK**:
    ```bash
    # Create Key Vault and key
    az keyvault create \
      --name myvault \
      --resource-group rg-storage

    az keyvault key create \
      --vault-name myvault \
      --name storage-key \
      --protection software

    # Configure storage to use CMK
    az storage account update \
      --name mystorageaccount \
      --resource-group rg-storage \
      --encryption-key-source Microsoft.Keyvault \
      --encryption-key-vault https://myvault.vault.azure.net \
      --encryption-key-name storage-key
    ```
  </Tab>

  <Tab title="Network Security">
    **Restrict network access**:

    ```bash
    # 1. Disable public access
    az storage account update \
      --name mystorageaccount \
      --resource-group rg-storage \
      --public-network-access Disabled

    # 2. Use Private Endpoints
    az network private-endpoint create \
      --name pe-storage \
      --resource-group rg-storage \
      --vnet-name vnet-prod \
      --subnet snet-data \
      --private-connection-resource-id /subscriptions/.../storageAccounts/mystorageaccount \
      --group-ids blob \
      --connection-name storage-private

    # 3. Or use firewall (less secure)
    az storage account network-rule add \
      --account-name mystorageaccount \
      --vnet-name vnet-prod \
      --subnet snet-web

    az storage account update \
      --name mystorageaccount \
      --default-action Deny
    ```
  </Tab>
</Tabs>

---

## 3. Azure Files

**Azure Files** provides fully managed cloud file shares accessible via SMB/NFS.

### When to Use Azure Files

<Tabs>
  <Tab title="✅ Use Azure Files For">
    - **Lift-and-shift**: Replace on-premises file servers
    - **Shared configuration**: App servers need shared config files
    - **Diagnostic logs**: Centralized log storage
    - **Dev/Test**: Shared development environments
    - **User home directories**: Roaming profiles

    **Example**: Multiple VMs need access to same files
  </Tab>

  <Tab title="❌ Don't Use Azure Files For">
    - **Object storage**: Use Blob Storage instead (cheaper, more scalable)
    - **Database files**: Use managed disks (better performance)
    - **High IOPS**: Use Premium Files or Ultra Disk

    **Example**: Storing millions of images → Blob Storage
  </Tab>
</Tabs>

### File Share Tiers

<Tabs>
  <Tab title="Standard (HDD)">
    ```
    Performance: Up to 60 MB/s throughput, 1,000 IOPS
    Pricing: $0.06/GB/month
    Minimum: None

    Use for: General-purpose file shares, dev/test
    ```
  </Tab>

  <Tab title="Premium (SSD)">
    ```
    Performance: Up to 10,000 IOPS, 200 MB/s per TB provisioned
    Pricing: $0.20/GB/month (provisioned, not consumed)
    Minimum: 100 GB

    Use for: High-performance, low-latency workloads
    ```

    **Example**: SQL Server needs high IOPS
  </Tab>
</Tabs>

### Mount Azure File Share

<Tabs>
  <Tab title="Windows">
    ```powershell
    # Get storage account key
    $storageKey = (az storage account keys list `
      --account-name mystorageaccount `
      --query "[0].value" -o tsv)

    # Mount file share
    net use Z: \\mystorageaccount.file.core.windows.net\myshare `
      /user:AZURE\mystorageaccount $storageKey

    # Persistent mount (survives reboot)
    cmdkey /add:mystorageaccount.file.core.windows.net `
      /user:AZURE\mystorageaccount /pass:$storageKey

    # Add to Windows startup
    ```
  </Tab>

  <Tab title="Linux">
    ```bash
    # Install cifs-utils
    sudo apt-get install cifs-utils

    # Create mount point
    sudo mkdir /mnt/myshare

    # Create credentials file
    sudo bash -c 'echo "username=mystorageaccount" >> /etc/smbcredentials'
    sudo bash -c 'echo "password=STORAGE_KEY" >> /etc/smbcredentials'
    sudo chmod 600 /etc/smbcredentials

    # Mount share
    sudo mount -t cifs //mystorageaccount.file.core.windows.net/myshare /mnt/myshare -o credentials=/etc/smbcredentials,dir_mode=0777,file_mode=0777

    # Add to /etc/fstab for persistent mount
    //mystorageaccount.file.core.windows.net/myshare /mnt/myshare cifs credentials=/etc/smbcredentials,dir_mode=0777,file_mode=0777 0 0
    ```
  </Tab>
</Tabs>

### Azure File Sync

**Sync on-premises file servers with Azure Files**.

<div className="flex justify-center my-4">
  <div className="w-full max-w-4xl">
    ```mermaid
    graph TB
        OnPrem1[On-Premises Server 1<br/>NYC Office]
        OnPrem2[On-Premises Server 2<br/>SF Office]
        Azure[Azure Files<br/>Cloud Storage]

        OnPrem1 <-.Sync.-> Azure
        OnPrem2 <-.Sync.-> Azure
        OnPrem1 -.Replicated.-> OnPrem2

        style Azure fill:#0078D4
    ```
  </div>
</div>

**Benefits**:
- Multi-site access to same files
- Cloud tiering (free up on-premises space)
- Centralized backup (Azure Backup)
- Disaster recovery (files in cloud)

---

## 4. Managed Disks

**Managed Disks** are block-level storage for Azure VMs.

### Disk Types Comparison

| Type | IOPS | Throughput | Latency | Use Case | Cost |
|------|------|------------|---------|----------|------|
| **Ultra Disk** | 160,000 | 4,000 MB/s | &lt;1ms | Mission-critical (SAP HANA) | $$$$ |
| **Premium SSD v2** | 80,000 | 1,200 MB/s | &lt;2ms | High-performance databases | $$$ |
| **Premium SSD** | 20,000 | 900 MB/s | ~3ms | Production databases | $$ |
| **Standard SSD** | 6,000 | 750 MB/s | ~10ms | Web servers, dev/test | $ |
| **Standard HDD** | 500 | 60 MB/s | ~20ms | Backups, archives | ¢ |

### Disk Sizing Strategy

<Tabs>
  <Tab title="SQL Server">
    ```
    OS Disk: Premium SSD P30 (1 TB)
      - ReadWrite cache
      - Operating system and SQL binaries

    Data Files: 4x Premium SSD P30 (4 TB total)
      - Striped (RAID 0) using Storage Spaces
      - ReadOnly cache
      - Combined: 20,000 IOPS

    Log Files: Premium SSD P20 (512 GB)
      - None cache (write-heavy)
      - Separate disk for sequential writes

    TempDB: Local NVMe SSD (D: drive)
      - Ephemeral, ultra-fast
      - Free, no persistence needed
    ```
  </Tab>

  <Tab title="Web Application">
    ```
    OS Disk: Premium SSD P10 (128 GB)
      - ReadWrite cache
      - Sufficient for web server

    Data Disk: Standard SSD E15 (256 GB)
      - ReadOnly cache
      - Application data, logs

    Total Cost: ~$30/month
    ```
  </Tab>
</Tabs>

### Disk Snapshots and Backups

```bash
# Create snapshot
az snapshot create \
  --resource-group rg-prod \
  --name snapshot-data-$(date +%Y%m%d) \
  --source /subscriptions/.../disks/disk-data

# Create disk from snapshot
az disk create \
  --resource-group rg-prod \
  --name disk-restored \
  --source snapshot-data-20260121

# Incremental snapshots (cost-effective)
az snapshot create \
  --resource-group rg-prod \
  --name snapshot-data-incremental \
  --source disk-data \
  --incremental true
```

**Backup Strategy**:
- Daily snapshots (7-day retention)
- Weekly snapshots (4-week retention)
- Monthly snapshots (12-month retention)
- Use Azure Backup for automated management

---

## 5. Data Lake Storage Gen2

**ADLS Gen2** combines Blob Storage with hierarchical namespace for big data analytics.

### When to Use Data Lake

<CardGroup cols={2}>
  <Card title="Use Data Lake For" icon="chart-bar">
    - Big data analytics (Spark, Databricks)
    - Data warehousing (Synapse)
    - Machine learning pipelines
    - Hierarchical folder structures
    - POSIX permissions
  </Card>

  <Card title="Use Blob Storage For" icon="cube">
    - Simple object storage
    - Flat namespace
    - Lower cost (no hierarchical namespace)
    - Traditional backups
    - Media files
  </Card>
</CardGroup>

### Enable Hierarchical Namespace

```bash
# Create storage account with Data Lake Gen2
az storage account create \
  --name mydatalake \
  --resource-group rg-analytics \
  --kind StorageV2 \
  --hierarchical-namespace true \
  --access-tier Hot

# Result: Blob Storage + filesystem semantics
# /folder1/subfolder/file.csv
```

### POSIX Permissions

```bash
# Set ACLs (Access Control Lists)
az storage fs access set \
  --account-name mydatalake \
  --file-system mycontainer \
  --path /data/sales \
  --acl "user::rwx,group::r-x,other::---"

# Grant user read access
az storage fs access set \
  --account-name mydatalake \
  --file-system mycontainer \
  --path /data/sales \
  --acl "user:alice@company.com:r-x"
```

---

## 6. Storage Performance Optimization

### Blob Storage Optimization

<AccordionGroup>
  <Accordion title="1. Use CDN for Static Content" icon="rocket">
    ```bash
    # Create CDN profile
    az cdn profile create \
      --name mycdn \
      --resource-group rg-storage \
      --sku Standard_Microsoft

    # Create CDN endpoint
    az cdn endpoint create \
      --name mycdn-endpoint \
      --profile-name mycdn \
      --resource-group rg-storage \
      --origin mystorageaccount.blob.core.windows.net \
      --origin-host-header mystorageaccount.blob.core.windows.net

    # Result: Global edge caching, faster access
    ```
  </Accordion>

  <Accordion title="2. Optimize Blob Naming" icon="tag">
    **Avoid hotspots with random prefixes**:

    ```
    ❌ Bad (hotspot on same partition):
    /images/2024/01/01/image1.jpg
    /images/2024/01/01/image2.jpg
    /images/2024/01/01/image3.jpg

    ✅ Good (distributed across partitions):
    /ab/images/2024/01/01/image1.jpg
    /cd/images/2024/01/01/image2.jpg
    /ef/images/2024/01/01/image3.jpg

    Use first 2 characters of hash as prefix
    ```
  </Accordion>

  <Accordion title="3. Parallel Uploads" icon="arrows-split-up-and-left">
    ```python
    from azure.storage.blob import BlobServiceClient

    blob_service = BlobServiceClient(account_url="...", credential="...")
    blob_client = blob_service.get_blob_client("mycontainer", "largefile.zip")

    # Upload in parallel (default: 4 MB chunks)
    with open("largefile.zip", "rb") as data:
        blob_client.upload_blob(
            data,
            max_concurrency=10,  # 10 parallel uploads
            overwrite=True
        )

    # 10x faster for large files
    ```
  </Accordion>

  <Accordion title="4. Use Appropriate Tier" icon="layer-group">
    ```
    Hot Tier: Frequently accessed (< 30 days)
    Cool Tier: Infrequently accessed (30-90 days)
    Archive Tier: Rarely accessed (180+ days)

    Example:
    - Website images: Hot
    - 60-day backup: Cool
    - 1-year compliance archive: Archive

    Savings: Up to 98% for Archive vs Hot
    ```
  </Accordion>
</AccordionGroup>

---

## 7. Interview Questions

### Beginner

<AccordionGroup>
  <Accordion title="Q1: What's the difference between Blob Storage and Azure Files?">
    **Blob Storage**:
    - Object storage (REST API)
    - Unstructured data (images, videos, logs)
    - Accessible via HTTP/HTTPS
    - No file system semantics
    - More scalable, cheaper

    **Azure Files**:
    - File shares (SMB/NFS protocol)
    - Structured data (documents, configs)
    - Mount as drive (Z:, /mnt)
    - File system semantics (folders, permissions)
    - Lift-and-shift from file servers

    **Rule of thumb**: Use Blob for apps, Azure Files for VMs/users
  </Accordion>

  <Accordion title="Q2: Explain storage tiers and when to use each">
    **Hot Tier**:
    - Frequently accessed data
    - Lowest access cost, highest storage cost
    - Use for: Active website content, recent data

    **Cool Tier**:
    - Infrequently accessed (30+ days)
    - Medium storage cost, higher access cost
    - Use for: Short-term backups, 30-90 day retention

    **Archive Tier**:
    - Rarely accessed (180+ days)
    - Lowest storage cost, highest access cost
    - Rehydration required (up to 15 hours)
    - Use for: Long-term backups, compliance

    **Cost Example**:
    - 1 TB for 1 year:
      - Hot: $216
      - Cool: $120 (44% cheaper)
      - Archive: $12 (94% cheaper!)
  </Accordion>
</AccordionGroup>

### Intermediate

<AccordionGroup>
  <Accordion title="Q3: Design a cost-effective backup strategy">
    ```
    Backup Strategy for 100 GB database:

    1. Daily Backups (7 days):
       - Store in Cool tier
       - Cost: 7 × 100 GB × $0.01 = $7/month

    2. Weekly Backups (4 weeks):
       - Store in Cool tier
       - Cost: 4 × 100 GB × $0.01 = $4/month

    3. Monthly Backups (12 months):
       - Store in Archive tier
       - Cost: 12 × 100 GB × $0.001 = $1.20/month

    Total: $12.20/month (vs $43 if all Hot)

    Lifecycle Policy:
    - Daily: Cool immediately
    - After 30 days: Move to Archive
    - After 365 days: Delete

    Incremental Backups:
    - Only changed data backed up daily
    - Reduces storage by 80-90%
    - Final cost: ~$2-3/month
    ```
  </Accordion>

  <Accordion title="Q4: Optimize storage for a media streaming app">
    ```
    Architecture:

    1. Video Storage:
       - Original files: Archive tier (rarely accessed)
       - Transcoded versions: Hot tier (frequently streamed)
       - Use CDN (Azure Front Door) for global distribution

    2. Thumbnail Storage:
       - Hot tier (displayed on every page)
       - Small files, high access frequency
       - CDN caching (90%+ cache hit rate)

    3. User Uploads:
       - Start in Hot tier (recently uploaded, often viewed)
       - After 30 days: Move to Cool (older content)
       - After 180 days: Move to Archive (historical)

    4. CDN Configuration:
       - Cache thumbnails: 7 days
       - Cache videos: 1 day (balance freshness and cost)
       - Purge cache on content update

    5. Performance:
       - Parallel video chunk uploads (10 concurrent)
       - Adaptive bitrate streaming (HLS/DASH)
       - Geo-replication (LRS → GRS for critical content)

    Cost Savings:
    - Without optimization: $5,000/month
    - With optimization: $1,200/month (76% reduction)

    Optimizations:
    - Lifecycle policies: $2,000 savings
    - CDN (reduced blob reads): $1,500 savings
    - Incremental backups: $300 savings
    ```
  </Accordion>
</AccordionGroup>

### Advanced

<AccordionGroup>
  <Accordion title="Q5: Implement global data replication with conflict resolution">
    ````
    Global Replication Strategy:

    1. Use GRS (Geo-Redundant Storage):
       - Primary: East US
       - Secondary: West US (read-only)
       - Automatic failover on regional outage

    2. Or use multi-region architecture:
       - Storage accounts in each region
       - Azure Traffic Manager routes to closest
       - Application-level replication

    3. Conflict Resolution:
       Option A: Last Write Wins (LWW)
         - Use blob versioning
         - Latest timestamp wins
         - Simple, may lose data

       Option B: Application-Level Merge
         - Store conflict versions separately
         - Manual resolution
         - Complex, but no data loss

    4. Implementation:
       ```python
       from azure.storage.blob import BlobServiceClient

       # Primary storage
       primary = BlobServiceClient(account_url="https://storage-eastus...")
       secondary = BlobServiceClient(account_url="https://storage-westus...")

       def upload_with_replication(blob_name, data):
           # Upload to primary
           primary_blob = primary.get_blob_client("mycontainer", blob_name)
           primary_blob.upload_blob(data, overwrite=True)

           # Replicate to secondary
           secondary_blob = secondary.get_blob_client("mycontainer", blob_name)
           secondary_blob.upload_blob(data, overwrite=True)

           # Or use change feed for async replication
       ```

    5. Monitoring:
       - Alert on replication lag > 15 minutes
       - Monitor blob change feed
       - Test failover monthly
    ````
  </Accordion>

  <Accordion title="Q6: Secure storage with zero-trust architecture">
    ````
    Zero-Trust Storage Security:

    1. Network Isolation:
       - Disable public access entirely
       - Use Private Endpoints only
       - Traffic never leaves Azure backbone

    2. Identity-Based Access:
       - No shared keys (disable storage account keys)
       - Azure AD authentication only
       - RBAC with least privilege
       - Managed identities for applications

    3. Encryption:
       - Customer-managed keys (Azure Key Vault)
       - Key rotation every 90 days
       - Separate keys per container

    4. Data Protection:
       - Blob versioning enabled
       - Soft delete (30 days)
       - Immutable storage (WORM compliance)
       - Legal hold for litigation

    5. Monitoring:
       - Storage Analytics logs → Log Analytics
       - Alert on:
         - Anonymous access attempts
         - Failed authentication
         - Key access from Key Vault
         - Blob deletion

    6. Implementation:
       ```bash
       # 1. Disable public access
       az storage account update \
         --name mystorageaccount \
         --public-network-access Disabled

       # 2. Create private endpoint
       az network private-endpoint create \
         --name pe-storage \
         --vnet-name vnet-prod \
         --subnet snet-data \
         --private-connection-resource-id /subscriptions/.../storageAccounts/mystorageaccount \
         --group-ids blob

       # 3. Disable shared key access
       az storage account update \
         --name mystorageaccount \
         --allow-shared-key-access false

       # 4. Enable customer-managed keys
       az storage account update \
         --name mystorageaccount \
         --encryption-key-source Microsoft.Keyvault \
         --encryption-key-vault https://myvault.vault.azure.net \
         --encryption-key-name storage-key

       # 5. Enable versioning and soft delete
       az storage account blob-service-properties update \
         --account-name mystorageaccount \
         --enable-versioning true \
         --enable-delete-retention true \
         --delete-retention-days 30

       # 6. Configure immutable storage (WORM)
       az storage container immutability-policy create \
         --account-name mystorageaccount \
         --container-name compliance \
         --period 2555  # 7 years in days
       ```
    ````
  </Accordion>
</AccordionGroup>

---

## 8. Key Takeaways

<CardGroup cols={2}>
  <Card title="Choose Right Storage Type" icon="database">
    Blob for objects, Files for shares, Disks for VMs. Each optimized for specific use cases.
  </Card>

  <Card title="Use Storage Tiers" icon="layer-group">
    Hot/Cool/Archive can save 90%+ on storage costs. Automate with lifecycle policies.
  </Card>

  <Card title="Enable Data Protection" icon="shield">
    Soft delete, versioning, and snapshots protect against accidents and attacks.
  </Card>

  <Card title="Secure with Private Endpoints" icon="lock">
    Disable public access. Use Azure AD authentication. No shared keys in production.
  </Card>

  <Card title="Optimize Performance" icon="rocket">
    CDN for static content, parallel uploads, proper disk caching, disk striping for IOPS.
  </Card>

  <Card title="Plan for Disaster Recovery" icon="life-ring">
    GRS for critical data, backup strategy with retention policies, test restores regularly.
  </Card>
</CardGroup>

---

## Next Steps

<Card title="Continue to Chapter 6" icon="arrow-right" href="/courses/azure-cloud-engineering/06-database-services">
  Master Azure databases: SQL, Cosmos DB, PostgreSQL, and database optimization
</Card>
