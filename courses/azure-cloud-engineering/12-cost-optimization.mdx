---
title: "Cost Optimization"
description: "Master Azure cost management, FinOps, and savings strategies"
icon: "dollar-sign"
---

# Cost Optimization

Cost optimization is an ongoing process. Learn strategies to reduce Azure spending by 30-60%.

![Azure Cost Optimization](/images/azure/12-cost-optimization.svg)

---

## 1. Azure Cost Management

<CardGroup cols={2}>
  <Card title="Cost Analysis" icon="chart-pie">
    Visualize spending by service, resource group, tags
  </Card>

  <Card title="Budgets" icon="wallet">
    Set spending limits and alerts
  </Card>

  <Card title="Recommendations" icon="lightbulb">
    Azure Advisor provides savings recommendations
  </Card>

  <Card title="Cost Allocation" icon="tags">
    Use tags for chargeback and showback
  </Card>
</CardGroup>

> [!WARNING]
> **Gotcha: B-Series Credits**
> "Burstable" (B-series) VMs are cheap because they limit your CPU. If you use 100% CPU for too long, you run out of "credits" and your VM gets throttled to 10% speed. Monitor your `CPUCreditsRemaining` metric!

> [!TIP]
> **Jargon Alert: Amortization**
> If you pay $3,600 upfront for a 3-year reservation, "Amortized Cost" shows it as $100/month in your reports. This helps you track the *effective* monthly burn rate, not just the cash flow.

---

## 2. Quick Wins

<AccordionGroup>
  <Accordion title="1. Right-Size Resources" icon="arrows-left-right-to-line">
    **Problem**: VMs running at 10% CPU

    **Solution**: Downsize VM
    ```bash
    # Before: Standard_D4s_v3 (4 vCPU, $150/month)
    # After: Standard_D2s_v3 (2 vCPU, $75/month)
    # Savings: $75/month (50%)

    az vm resize \
      --resource-group rg-prod \
      --name vm-web-01 \
      --size Standard_D2s_v3
    ```
  </Accordion>

  <Accordion title="2. Use Reserved Instances" icon="calendar">
    **For stable workloads**:
    - 1-year: 30-50% savings
    - 3-year: 50-70% savings

    Example: $1,000/month → $400/month with 3-year RI
  </Accordion>

  <Accordion title="3. Stop Dev/Test VMs" icon="power-off">
    ```bash
    # Stop VMs at 6 PM on weekdays
    # Start VMs at 8 AM on weekdays

    # Using Azure Automation
    # Savings: 60% (nights + weekends)
    ```
  </Accordion>

  <Accordion title="4. Use Spot VMs" icon="bolt">
    **For fault-tolerant workloads**:
    - Up to 90% discount
    - Can be evicted with 30-second warning
    - Perfect for: Batch jobs, testing, CI/CD agents
  </Accordion>

  <Accordion title="5. Delete Unused Resources" icon="trash">
    **Common wastes**:
    - Unattached disks ($100/month each)
    - Old snapshots ($50/month)
    - Orphaned public IPs ($4/month each)
    - Unused load balancers ($20/month)

    ```bash
    # Find unattached disks
    az disk list --query "[?diskState=='Unattached'].{Name:name, ResourceGroup:resourceGroup}"

    # Delete them
    az disk delete --name disk-old --resource-group rg-prod --yes
    ```
  </Accordion>
</AccordionGroup>

---

## 3. Storage Cost Optimization

<Tabs>
  <Tab title="Use Storage Tiers">
    ```
    Hot → Cool → Archive

    Example: 1 TB for 1 year
    - Hot: $216/year
    - Cool: $120/year (44% savings)
    - Archive: $12/year (94% savings!)
    ```
  </Tab>

  <Tab title="Lifecycle Policies">
    ```json
    {
      "rules": [{
        "name": "MoveToCool",
        "enabled": true,
        "type": "Lifecycle",
        "definition": {
          "actions": {
            "baseBlob": {
              "tierToCool": { "daysAfterModificationGreaterThan": 30 },
              "tierToArchive": { "daysAfterModificationGreaterThan": 90 },
              "delete": { "daysAfterModificationGreaterThan": 365 }
            }
          }
        }
      }]
    }
    ```
  </Tab>
</Tabs>

---

## 4. FinOps Best Practices

<CardGroup cols={2}>
  <Card title="Tagging Strategy" icon="tags">
    Tag every resource with:
    - CostCenter
    - Environment (prod/dev/test)
    - Owner
    - Project
  </Card>

  <Card title="Showback/Chargeback" icon="file-invoice-dollar">
    Show teams their costs
    - Monthly cost reports
    - Budget per team
    - Accountability
  </Card>

  <Card title="Regular Reviews" icon="calendar">
    - Weekly: Cost anomalies
    - Monthly: Optimization opportunities
    - Quarterly: Architecture review
  </Card>

  <Card title="Automation" icon="robot">
    - Auto-shutdown for dev/test
    - Auto-scale based on usage
    - Budget alerts
  </Card>
</CardGroup>

---

---

## 5. FinOps Framework

<Frame>
  <img src="/images/azure/12-finops-lifecycle.svg" alt="FinOps Lifecycle: Inform, Optimize, Operate" />
</Frame>


**FinOps** (Financial Operations) = Cultural practice bringing financial accountability to cloud spending.

### FinOps Principles

1. **Teams need to collaborate**: Finance, Engineering, Product work together
2. **Everyone takes ownership**: Engineers see cost impact of their decisions
3. **Centralized team drives FinOps**: Dedicated FinOps team enables best practices
4. **Reports should be accessible**: Real-time cost visibility for all stakeholders
5. **Decisions are driven by business value**: Cost vs performance tradeoffs
6. **Take advantage of variable cost model**: Right-size continuously

### FinOps Lifecycle

```
┌─────────────┐
│   INFORM    │  ← Visibility, allocation, benchmarking
└──────┬──────┘
       ↓
┌─────────────┐
│  OPTIMIZE   │  ← Right-sizing, reservations, waste removal
└──────┬──────┘
       ↓
┌─────────────┐
│  OPERATE    │  ← Continuous improvement, automation
└─────────────┘
```

### Implementing FinOps

**Phase 1: Visibility (Month 1-2)**
```bash
# 1. Enable Cost Management
az costmanagement export create \
  --name daily-costs \
  --type ActualCost \
  --schedule-recurrence Daily \
  --storage-account-id /subscriptions/.../storageAccounts/costs

# 2. Tag all resources
az tag create --resource-id $RESOURCE_ID \
  --tags Environment=Production Team=Platform CostCenter=Engineering

# 3. Create cost alerts
az consumption budget create \
  --budget-name monthly-budget \
  --amount 10000 \
  --time-grain Monthly \
  --start-date 2026-01-01 \
  --end-date 2026-12-31
```

**Phase 2: Accountability (Month 3-4)**
- Assign cost owners to each resource group
- Create showback reports per team
- Monthly cost review meetings

**Phase 3: Optimization (Month 5+)**
- Implement right-sizing recommendations
- Purchase reserved instances for base load
- Automate waste removal

---

## 6. Tagging Strategy & Governance

<Frame>
  <img src="/images/azure/12-cost-allocation-tags.svg" alt="Cost Allocation through Tagging Strategy" />
</Frame>


**Tags** = Metadata for cost allocation, automation, and governance.

### Essential Tags

| Tag | Example | Purpose |
|-----|---------|---------|
| **Environment** | Production, Dev, Staging | Separate costs by environment |
| **CostCenter** | Engineering, Marketing | Chargeback to departments |
| **Owner** | john@company.com | Accountability |
| **Project** | ProjectAlpha, Migration2026 | Track project costs |
| **Application** | WebApp, API, Database | Group related resources |
| **Criticality** | Critical, High, Medium, Low | Prioritize optimization |

### Tag Governance with Azure Policy

**Require tags on all resources**:
```json
{
  "if": {
    "allOf": [
      {
        "field": "type",
        "equals": "Microsoft.Compute/virtualMachines"
      },
      {
        "field": "tags['Environment']",
        "exists": "false"
      }
    ]
  },
  "then": {
    "effect": "deny"
  }
}
```

### Bulk Tagging Script

```powershell
# Tag all VMs in a resource group
$rg = "rg-production"
$tags = @{
    Environment = "Production"
    CostCenter = "Engineering"
    Owner = "platform-team@company.com"
}

Get-AzResource -ResourceGroupName $rg | ForEach-Object {
    $resource = $_
    $resourceTags = $resource.Tags
    
    # Merge tags (don't overwrite existing)
    foreach ($key in $tags.Keys) {
        if (-not $resourceTags.ContainsKey($key)) {
            $resourceTags[$key] = $tags[$key]
        }
    }
    
    Set-AzResource -ResourceId $resource.ResourceId -Tag $resourceTags -Force
}
```

---

## 7. Service-Specific Cost Optimization

### AKS Cost Optimization

**Problem**: AKS cluster costs $5,000/month, mostly idle

**Solutions**:

1. **Right-size node pools**:
```bash
# Enable cluster autoscaler
az aks nodepool update \
  --cluster-name aks-prod \
  --name nodepool1 \
  --min-count 3 \
  --max-count 10 \
  --enable-cluster-autoscaler
```

2. **Use Spot VMs for fault-tolerant workloads**:
```bash
az aks nodepool add \
  --cluster-name aks-prod \
  --name spotpool \
  --priority Spot \
  --eviction-policy Delete \
  --spot-max-price -1 \
  --node-count 3

# Savings: Up to 90% for batch jobs
```

### Cosmos DB Cost Optimization

**Problem**: Cosmos DB costs $2,000/month with 20,000 RU/s provisioned

**Solutions**:

1. **Use Autoscale instead of Manual**:
```bash
# Before: 20,000 RU/s manual = $1,920/month (always on)
# After: 2,000-20,000 RU/s autoscale = $960/month avg

az cosmosdb sql container throughput update \
  --account-name mycosmosdb \
  --database-name mydb \
  --name mycontainer \
  --max-throughput 20000  # Autoscale
```

2. **Optimize queries** (reduce RU consumption):
```sql
-- Bad: Full collection scan (1000 RUs)
SELECT * FROM c WHERE c.status = 'active'

-- Good: Use index (5 RUs)
SELECT c.id, c.name FROM c WHERE c.status = 'active'
```

### Storage Cost Optimization

**Problem**: 100 TB of blob storage costs $2,000/month in Hot tier

**Solution: Use lifecycle management**:
```json
{
  "rules": [
    {
      "name": "move-to-cool-after-30-days",
      "type": "Lifecycle",
      "definition": {
        "filters": {
          "blobTypes": ["blockBlob"]
        },
        "actions": {
          "baseBlob": {
            "tierToCool": {
              "daysAfterModificationGreaterThan": 30
            },
            "tierToArchive": {
              "daysAfterModificationGreaterThan": 90
            }
          }
        }
      }
    }
  }
}
```

**Savings**:
- Hot: $0.0184/GB = $1,884/month for 100 TB
- Cool: $0.01/GB = $1,024/month (46% savings)
- Archive: $0.00099/GB = $101/month (95% savings)

---

## 8. Real-World Cost Reduction Case Studies

### Case Study 1: E-Commerce Platform

**Before**:
- Monthly cost: $45,000
- 50 VMs running 24/7
- All resources in Premium tier

**Optimizations**:
1. Right-sized VMs (avg CPU 15%) → Saved $8,000/month
2. Stopped dev/test VMs at night → Saved $6,000/month
3. Purchased 3-year RIs for prod → Saved $12,000/month
4. Moved logs to Cool storage → Saved $2,000/month

**After**:
- Monthly cost: $17,000
- **Savings: $28,000/month (62%)**

### Case Study 2: SaaS Startup

**Before**:
- Monthly cost: $12,000
- AKS cluster with 20 nodes
- Cosmos DB at 50,000 RU/s

**Optimizations**:
1. Enabled AKS cluster autoscaler → Saved $3,500/month
2. Cosmos DB autoscale → Saved $2,500/month
3. Lifecycle management for storage → Saved $1,200/month
4. Deleted unused resources → Saved $800/month

**After**:
- Monthly cost: $4,000
- **Savings: $8,000/month (67%)**

---

## 9. Cost Optimization Checklist

```
✅ Right-sized VMs (not oversized)
✅ Reserved Instances for stable workloads
✅ Spot VMs for batch/testing
✅ Auto-shutdown for dev/test
✅ Deleted unused resources
✅ Storage lifecycle policies
✅ Monitoring and alerts enabled
✅ Tags on all resources
✅ Regular cost reviews scheduled
```

---

---

## 6. Interview Questions

### Beginner Level

<AccordionGroup>
  <Accordion title="Q1: What is the difference between CapEx and OpEx?">
    **Answer**:
    - **CapEx (Capital Expenditure)**: Upfront cost for physical infrastructure (Servers, Datacenters). depreciated over time.
    - **OpEx (Operational Expenditure)**: Pay-as-you-go model (Cloud). Billed for what you use immediately. No upfront cost.
  </Accordion>

  <Accordion title="Q2: How can I stop a VM from billing me?">
    **Answer**:
    You must **Deallocate** the VM (Stopped/Deallocated).
    Just shutting down the OS (Stopped) still reserves the hardware and incurs compute charges.
    *Note: Storage (Disk) is still billed even when deallocated.*
  </Accordion>
</AccordionGroup>

### Intermediate Level

<AccordionGroup>
  <Accordion title="Q3: Explain the difference between Reserved Instances and Spot VMs">
    **Answer**:
    - **Reserved Instances (RI)**: Commit to 1 or 3 years for steady workloads. ~40-70% savings. Guaranteed capacity.
    - **Spot VMs**: Bid on unused Azure capacity. ~90% savings. No guarantee (can be evicted). Good for stateless/batch jobs.
  </Accordion>

  <Accordion title="Q4: What is Azure Hybrid Benefit?">
    **Answer**:
    A licensing benefit that lets you bring your own on-premises Windows Server and SQL Server licenses (with Software Assurance) to Azure.
    It removes the cost of the OS license from the hourly VM rate, saving up to 40%.
  </Accordion>
</AccordionGroup>

### Advanced Level

<AccordionGroup>
  <Accordion title="Q5: How do you implement a chargeback model in a multi-tenant subscription?">
    **Answer**:
    1. **Tagging Policy**: Enforce a `CostCenter` tag on all resources via Azure Policy.
    2. **Cost Management**: Create cost views filtered by tag.
    3. **Exports**: Export cost data to Azure Storage/Power BI for custom reporting.
    4. **Subscription Partitioning**: For strict isolation, give each tenant their own Subscription (Management Groups for governance).
  </Accordion>
</AccordionGroup>

---

## 7. Key Takeaways

<CardGroup cols={2}>
  <Card title="Visibility" icon="eye">
    You can't optimize what you can't measure. Use cost analysis and dashboards properly.
  </Card>
  <Card title="Accountability" icon="user-tag">
    Use **Tags** to assign costs to teams. Make engineers responsible for their cloud spend.
  </Card>
  <Card title="Commitment" icon="handshake">
    Use **Reserved Instances** and **Savings Plans** for predictable base loads to save 50%+.
  </Card>
  <Card title="Waste Elimination" icon="trash-can">
    Aggressively find and delete unused resources (orphaned disks, IPs, stopped VMs).
  </Card>
  <Card title="Architecture" icon="sitemap">
    Serverless and PaaS often scale to zero and cost less than always-on IaaS for variable workloads.
  </Card>
</CardGroup>

---

## Next Steps

<Card title="Continue to Chapter 13" icon="arrow-right" href="/courses/azure-cloud-engineering/13-high-availability-dr">
  Master high availability and disaster recovery strategies
</Card>
