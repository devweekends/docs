---
title: "Kubernetes Workloads"
sidebarTitle: "Workloads"
description: "Deployments, StatefulSets, DaemonSets, and Jobs"
icon: "cubes"
---

# Kubernetes Workloads

Learn how to manage applications using Kubernetes controllers.

---

## 1. Deployments

The standard way to run stateless applications (web servers, APIs).
- **ReplicaSet**: Manages the number of pod copies.
- **Rolling Updates**: Updates pods without downtime.
- **Rollbacks**: Revert to previous versions if something goes wrong.

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx-deployment
  labels:
    app: nginx
spec:
  replicas: 3
  selector:
    matchLabels:
      app: nginx
  strategy:
    type: RollingUpdate
    rollingUpdate:
      maxUnavailable: 1
      maxSurge: 1
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:1.21
        ports:
        - containerPort: 80
        livenessProbe:
          httpGet:
            path: /
            port: 80
          initialDelaySeconds: 15
```

### Managing Deployments

```bash
# Apply
kubectl apply -f deployment.yaml

# Scale manually
kubectl scale deployment nginx-deployment --replicas=5

# Update image (triggers rolling update)
kubectl set image deployment/nginx-deployment nginx=nginx:1.22

# Check rollout status
kubectl rollout status deployment/nginx-deployment

# View history
kubectl rollout history deployment/nginx-deployment

# Undo rollout
kubectl rollout undo deployment/nginx-deployment
```

---

## 2. StatefulSets

Used for stateful applications (Databases, Kafka, Zookeeper).
- **Stable Network ID**: `web-0`, `web-1` (not random).
- **Stable Storage**: PersistentVolumeClaims are kept even if pods are deleted.
- **Ordered Deployment**: 0 -> 1 -> 2.
- **Ordered Termination**: 2 -> 1 -> 0.

```yaml
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: mysql
spec:
  serviceName: "mysql"
  replicas: 3
  selector:
    matchLabels:
      app: mysql
  template:
    metadata:
      labels:
        app: mysql
    spec:
      containers:
      - name: mysql
        image: mysql:8.0
        env:
        - name: MYSQL_ROOT_PASSWORD
          value: "password"
        volumeMounts:
        - name: data
          mountPath: /var/lib/mysql
  volumeClaimTemplates:
  - metadata:
      name: data
    spec:
      accessModes: [ "ReadWriteOnce" ]
      resources:
        requests:
          storage: 10Gi
```

---

## 3. DaemonSets

Ensures that **all** (or some) Nodes run a copy of a Pod.
- Use cases: Log collectors (Fluentd), Monitoring agents (Prometheus Node Exporter).

```yaml
apiVersion: apps/v1
kind: DaemonSet
metadata:
  name: fluentd
spec:
  selector:
    matchLabels:
      name: fluentd
  template:
    metadata:
      labels:
        name: fluentd
    spec:
      containers:
      - name: fluentd
        image: fluentd:v1
```

---

## 4. Jobs & CronJobs

### Job
Runs a pod until it completes successfully (exit code 0).
- Use cases: Batch processing, database migrations.

```yaml
apiVersion: batch/v1
kind: Job
metadata:
  name: pi
spec:
  template:
    spec:
      containers:
      - name: pi
        image: perl
        command: ["perl",  "-Mbignum=bpi", "-wle", "print bpi(2000)"]
      restartPolicy: Never
  backoffLimit: 4
```

### CronJob
Creates Jobs on a schedule (like Linux cron).

```yaml
apiVersion: batch/v1
kind: CronJob
metadata:
  name: hello
spec:
  schedule: "*/1 * * * *"
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - name: hello
            image: busybox
            imagePullPolicy: IfNotPresent
            command:
            - /bin/sh
            - -c
            - date; echo Hello from the Kubernetes cluster
          restartPolicy: OnFailure
```

---

## Key Takeaways

| Workload | Use Case | Example |
|----------|----------|---------|
| **Deployment** | Stateless apps | Web servers, APIs |
| **StatefulSet** | Stateful apps | Databases, Kafka |
| **DaemonSet** | Node agents | Logging, Monitoring |
| **Job** | One-off tasks | DB Migration |
| **CronJob** | Scheduled tasks | Backups |

---

Next: [Kubernetes Services â†’](/courses/devops-tools/kubernetes-services)
