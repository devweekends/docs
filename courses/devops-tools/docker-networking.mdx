---
title: "Docker Networking & Volumes"
sidebarTitle: "Networking"
description: "Mastering container communication and data persistence"
icon: "network-wired"
---

# Docker Networking & Volumes

Learn how containers communicate with each other and the outside world, and how to persist data.

---

## Docker Networking

Docker provides several network drivers to control how containers communicate.

### 1. Bridge Network (Default)
The default network driver. Containers on the same bridge network can communicate via IP address or container name (DNS).
- **Isolation**: Containers on different bridge networks cannot communicate.
- **Use Case**: Standalone containers communicating on the same host.

```bash
# Create a custom bridge network (Recommended)
docker network create my-net

# Run containers on this network
docker run -d --name db --network my-net postgres
docker run -d --name app --network my-net my-app

# 'app' can now reach 'db' using the hostname "db"
```

### 2. Host Network
Removes network isolation between the container and the Docker host.
- **Performance**: Best performance (no NAT).
- **Port Conflicts**: Container ports map directly to host ports.

```bash
docker run --network host nginx
# Nginx is now accessible on host's port 80 directly
```

### 3. None Network
Disables all networking.
- **Use Case**: Security-sensitive batch jobs that don't need network access.

```bash
docker run --network none alpine
```

### DNS Resolution
Docker has an embedded DNS server.
- On default `bridge` network: DNS by container name is **NOT** supported (only IP).
- On **custom** networks: DNS by container name **IS** supported.

---

## Docker Volumes

Containers are ephemeral. When they stop, their filesystem is lost. **Volumes** persist data.

### 1. Named Volumes (Recommended)
Managed by Docker. Stored in `/var/lib/docker/volumes/` (on Linux).

```bash
# Create volume
docker volume create db-data

# Mount volume
docker run -d \
  -v db-data:/var/lib/postgresql/data \
  postgres
```

### 2. Bind Mounts
Maps a specific file or directory on the **host** to the container.
- **Use Case**: Development (live reloading code), sharing config files.

```bash
# Mount current directory to /app
docker run -d \
  -v $(pwd):/app \
  node:18-alpine
```

### 3. Tmpfs Mounts
Stored in the host's memory only. Never written to disk.
- **Use Case**: Storing sensitive secrets or high-performance temporary data.

```bash
docker run --tmpfs /run/secrets my-app
```

---

## Managing Networks & Volumes

```bash
# List networks
docker network ls

# Inspect network (see connected containers)
docker network inspect my-net

# Remove unused networks
docker network prune

# List volumes
docker volume ls

# Remove unused volumes
docker volume prune
```

---

## Key Takeaways

- Always use **Custom Bridge Networks** for inter-container communication.
- Use **Named Volumes** for database persistence.
- Use **Bind Mounts** for development (code reloading).
- Use **Host Networking** only when performance is critical and port conflicts aren't an issue.

---

## Docker Networking Deep Dive

### How Bridge Networking Works

```
┌─────────────────────────────────────────────────────────┐
│                        Host                              │
│  ┌─────────────────────────────────────────────────┐   │
│  │              docker0 (bridge)                     │   │
│  │                 172.17.0.1                        │   │
│  └──────┬─────────────────┬─────────────────┬───────┘   │
│         │                 │                 │           │
│    ┌────┴────┐      ┌────┴────┐      ┌────┴────┐       │
│    │Container│      │Container│      │Container│       │
│    │172.17.0.2│     │172.17.0.3│     │172.17.0.4│      │
│    └─────────┘      └─────────┘      └─────────┘       │
└─────────────────────────────────────────────────────────┘
```

### iptables Rules

Docker manipulates iptables for networking:

```bash
# View Docker's iptables rules
sudo iptables -t nat -L -n

# DNAT rule for port mapping (-p 8080:80)
-A DOCKER -p tcp --dport 8080 -j DNAT --to-destination 172.17.0.2:80
```

### DNS Resolution

Docker's embedded DNS server (127.0.0.11):

```bash
# Inside container
cat /etc/resolv.conf
# nameserver 127.0.0.11

# Resolve other containers by name
ping db  # Works on custom networks
```

---

## Overlay Networks (Multi-Host)

For containers across multiple Docker hosts (Swarm mode).

```bash
# Create overlay network
docker network create --driver overlay my-overlay

# Containers on different hosts can communicate
docker service create --network my-overlay --name web nginx
docker service create --network my-overlay --name api myapi
```

### How Overlay Works

```
┌────────────────────────┐     ┌────────────────────────┐
│        Host 1          │     │        Host 2          │
│  ┌──────────────────┐  │     │  ┌──────────────────┐  │
│  │ Container A      │  │     │  │ Container B      │  │
│  │ 10.0.0.2         │  │     │  │ 10.0.0.3         │  │
│  └────────┬─────────┘  │     │  └────────┬─────────┘  │
│           │            │     │           │            │
│  ┌────────┴─────────┐  │     │  ┌────────┴─────────┐  │
│  │ VXLAN Tunnel     │◄─┼─────┼─►│ VXLAN Tunnel     │  │
│  └──────────────────┘  │     │  └──────────────────┘  │
└────────────────────────┘     └────────────────────────┘
```

---

## Container Network Interface (CNI)

CNI is the standard for container networking plugins (used by Kubernetes).

| Plugin | Features |
|--------|----------|
| **Calico** | Network policies, BGP routing |
| **Cilium** | eBPF-based, advanced security |
| **Flannel** | Simple overlay, easy setup |
| **Weave** | Encryption, multicast |

---

## Volume Drivers

Beyond local storage, Docker supports pluggable volume drivers.

| Driver | Description |
|--------|-------------|
| **local** | Default, stores on host |
| **nfs** | Network File System |
| **aws** | AWS EBS/EFS |
| **azure** | Azure File/Disk |
| **glusterfs** | Distributed storage |

```bash
# Create volume with specific driver
docker volume create --driver=nfs \
  --opt share=192.168.1.1:/data \
  nfs-data
```

---

## Docker Compose Networking

```yaml
version: '3.8'
services:
  web:
    image: nginx
    networks:
      - frontend
    ports:
      - "80:80"
  
  api:
    image: myapi
    networks:
      - frontend
      - backend
  
  db:
    image: postgres
    networks:
      - backend
    volumes:
      - db-data:/var/lib/postgresql/data

networks:
  frontend:
    driver: bridge
  backend:
    driver: bridge
    internal: true  # No external access!

volumes:
  db-data:
```

### Network Aliases

```yaml
services:
  db:
    image: postgres
    networks:
      backend:
        aliases:
          - database
          - postgres-primary
```

---

## Interview Questions & Answers

<AccordionGroup>
  <Accordion title="What are the Docker network drivers?" icon="circle-question">
    | Driver | Scope | Use Case |
    |--------|-------|----------|
    | **bridge** | Single host | Default, container-to-container |
    | **host** | Single host | No network isolation, max performance |
    | **none** | Single host | No networking |
    | **overlay** | Multi-host | Docker Swarm/K8s |
    | **macvlan** | Single host | Container gets MAC address on LAN |
  </Accordion>
  
  <Accordion title="How does container-to-container communication work?" icon="circle-question">
    **Same bridge network:**
    1. Container A sends packet to Container B's name
    2. Docker DNS resolves name to IP
    3. Packet goes through bridge interface
    4. iptables routes to Container B
    
    **Different networks:**
    - Cannot communicate directly
    - Need a container connected to both networks, or use host network
  </Accordion>
  
  <Accordion title="What is the difference between named volumes and bind mounts?" icon="circle-question">
    | Aspect | Named Volume | Bind Mount |
    |--------|--------------|------------|
    | **Location** | Docker manages | You specify path |
    | **Portability** | Portable | Tied to host |
    | **Backup** | `docker volume` commands | Standard file tools |
    | **Performance** | Better on non-Linux | Native |
    | **Use Case** | Databases, persistent data | Development, configs |
  </Accordion>
  
  <Accordion title="How do you persist database data in Docker?" icon="circle-question">
    Use **named volumes**:
    ```bash
    docker volume create db-data
    docker run -v db-data:/var/lib/postgresql/data postgres
    ```
    
    **Important:**
    - Volume survives container deletion
    - Back up with `docker run --volumes-from backup-container`
    - For production, consider external volume drivers (NFS, cloud storage)
  </Accordion>
  
  <Accordion title="What is a macvlan network?" icon="circle-question">
    macvlan assigns a MAC address to the container, making it appear as a physical device on the network.
    
    **Use Cases:**
    - Legacy apps requiring specific MAC addresses
    - Apps needing to appear as physical hosts
    - Direct LAN access without port mapping
    
    ```bash
    docker network create -d macvlan \
      --subnet=192.168.1.0/24 \
      --gateway=192.168.1.1 \
      -o parent=eth0 \
      my-macvlan
    ```
  </Accordion>
  
  <Accordion title="How do you troubleshoot Docker networking?" icon="circle-question">
    ```bash
    # Inspect network
    docker network inspect bridge
    
    # Check container's network
    docker inspect --format='{{.NetworkSettings.Networks}}' container
    
    # Test connectivity from inside container
    docker exec -it container ping other-container
    
    # Check DNS resolution
    docker exec -it container nslookup db
    
    # Check iptables rules
    sudo iptables -t nat -L -n | grep DOCKER
    
    # Use network debug container
    docker run --net container:target nicolaka/netshoot
    ```
  </Accordion>
</AccordionGroup>

---

## Common Pitfalls

<Warning>
**1. Default Bridge DNS**: The default bridge network doesn't support DNS resolution by container name. Use custom networks.

**2. Not Using Custom Networks**: Containers on default bridge can only communicate by IP, which changes.

**3. Data Loss Without Volumes**: Container filesystem is ephemeral. Always use volumes for persistent data.

**4. Bind Mounts in Production**: Bind mounts tie containers to specific host paths. Use named volumes.

**5. Port Conflicts**: Multiple containers can't bind to the same host port. Plan port mappings.

**6. Forgetting Network Isolation**: All containers on a network can communicate. Use multiple networks for isolation.
</Warning>

---

Next: [Docker Compose →](/courses/devops-tools/docker-compose)
