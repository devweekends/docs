---
title: "Kubernetes Storage"
sidebarTitle: "Storage"
description: "Managing persistent storage with PVs, PVCs, and StorageClasses"
icon: "hard-drive"
---

# Kubernetes Storage

Stateful applications require storage that persists beyond the lifecycle of a Pod.

---

## The Storage Abstraction

Kubernetes separates storage infrastructure (Admin) from storage consumption (User).

```mermaid
graph TD
    User[Developer] -->|Creates| PVC[PersistentVolumeClaim]
    Admin[Cluster Admin] -->|Creates| SC[StorageClass]
    SC -->|Dynamic Provisioning| PV[PersistentVolume]
    PVC -->|Binds to| PV
    PV -->|Maps to| Disk[Physical Disk (AWS EBS, etc.)]
```

---

## 1. Volumes (Ephemeral)

Tied to the **Pod's lifecycle**. If the Pod dies, the data is lost (except for `hostPath`).

### emptyDir
Creates a temporary directory.
- Use case: Cache, scratch space, sharing data between containers in a Pod.

```yaml
volumes:
- name: cache-volume
  emptyDir: {}
```

### hostPath
Mounts a file/directory from the Node's filesystem.
- Use case: Node agents (logging, monitoring).
- **Warning**: Pods become stuck on that specific node.

---

## 2. Persistent Storage (Durable)

### PersistentVolume (PV)
A piece of storage in the cluster (e.g., AWS EBS, NFS share).
- Managed by Admins.
- Exists independently of any Pod.

### PersistentVolumeClaim (PVC)
A request for storage by a user.
- "I need 10Gi of ReadWriteOnce storage."
- Kubernetes finds a matching PV and binds them.

### StorageClass (SC)
Enables **Dynamic Provisioning**.
- Instead of manually creating PVs, the SC creates them on-demand when a PVC is created.

```yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: standard
provisioner: kubernetes.io/aws-ebs
parameters:
  type: gp2
reclaimPolicy: Delete
allowVolumeExpansion: true
```

---

## Practical Example: Database Storage

### Step 1: Create PVC

```yaml
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mysql-pv-claim
spec:
  storageClassName: standard  # Uses dynamic provisioning
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 20Gi
```

### Step 2: Use PVC in Pod

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: mysql
spec:
  containers:
  - name: mysql
    image: mysql:8.0
    volumeMounts:
    - name: mysql-persistent-storage
      mountPath: /var/lib/mysql
  volumes:
  - name: mysql-persistent-storage
    persistentVolumeClaim:
      claimName: mysql-pv-claim
```

---

## Access Modes

| Mode | Description | Use Case |
|------|-------------|----------|
| **ReadWriteOnce (RWO)** | Mounted by single node as R/W | Block storage (AWS EBS, Azure Disk) |
| **ReadOnlyMany (ROX)** | Mounted by multiple nodes as Read-only | Static content (NFS) |
| **ReadWriteMany (RWX)** | Mounted by multiple nodes as R/W | Shared filesystems (NFS, EFS) |

---

## Reclaim Policies

What happens to the PV when the PVC is deleted?

- **Retain**: PV remains (Released state). Data is safe. Admin must manually reclaim.
- **Delete**: PV and underlying storage (e.g., EBS volume) are deleted.
- **Recycle**: (Deprecated) Performs `rm -rf`.

---

## Key Takeaways

- **Volumes** are ephemeral (Pod lifecycle).
- **PV/PVC** provides durable storage.
- **StorageClass** automates PV creation (Dynamic Provisioning).
- **Access Modes** determine how many nodes can mount the volume.

---

Next: [Kubernetes Windows & Linux â†’](/courses/devops-tools/kubernetes-windows-linux)
