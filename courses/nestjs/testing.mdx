---
title: "Testing"
sidebarTitle: "7. Testing"
icon: "flask"
---


# Chapter 7: Testing

> Testing is essential for building reliable, maintainable applications. This chapter covers unit, integration, and end-to-end (E2E) testing in NestJS, including mocking, CI/CD, and best practices.

---

## 7.1 Why Test?

- Catch bugs early
- Refactor with confidence
- Ensure business logic correctness
- Enable continuous delivery

---

## 7.2 Unit Testing

Unit tests verify individual components (services, controllers) in isolation. Use Jest (default with NestJS) for writing tests.

### Example: UsersService
```typescript
describe('UsersService', () => {
  let service: UsersService;

  beforeEach(async () => {
    const module = await Test.createTestingModule({
      providers: [UsersService],
    }).compile();

    service = module.get<UsersService>(UsersService);
  });

  it('should find all users', async () => {
    expect(await service.findAll()).toEqual([]);
  });
});
```

---

## 7.3 Mocking Dependencies

Mock dependencies to isolate the unit under test.

```typescript
const mockRepo = { find: jest.fn().mockReturnValue([]) };

const module = await Test.createTestingModule({
  providers: [
    UsersService,
    { provide: UserRepository, useValue: mockRepo },
  ],
}).compile();
```

---

## 7.4 Integration Testing

Integration tests verify how components work together (e.g., service + database).

**Tip:** Use an in-memory database (e.g., sqlite) for fast, isolated tests.

---

## 7.5 End-to-End (E2E) Testing

E2E tests simulate real user scenarios by making HTTP requests to your app.

### Example: AppController
```typescript
import * as request from 'supertest';

describe('AppController (e2e)', () => {
  let app: INestApplication;

  beforeEach(async () => {
    const moduleFixture = await Test.createTestingModule({
      imports: [AppModule],
    }).compile();

    app = moduleFixture.createNestApplication();
    await app.init();
  });

  it('/ (GET)', () => {
    return request(app.getHttpServer())
      .get('/')
      .expect(200);
  });
});
```

---

## 7.6 CI/CD Integration

Automate tests in your CI pipeline (GitHub Actions, GitLab CI, etc.):

```yaml
steps:
  - run: npm ci
  - run: npm run test
  - run: npm run test:e2e
```

---

## 7.7 Best Practices

- Write tests for all business logic
- Use mocks for unit tests, real dependencies for integration/E2E
- Keep tests fast and isolated
- Use coverage reports to identify gaps
- Run tests on every commit

---

## 7.8 Summary

You’ve learned how to test NestJS applications at every level. Next, we’ll cover deployment, production, and monitoring strategies.
