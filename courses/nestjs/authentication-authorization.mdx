---
title: "Authentication & Authorization"
sidebarTitle: "6. Auth"
icon: "lock"
---


# Chapter 6: Authentication & Authorization

> Securing your application is critical. This chapter covers authentication (verifying identity), authorization (controlling access), JWT, OAuth, RBAC, guards, and best practices for building secure APIs in NestJS.

---

## 6.1 Authentication vs Authorization

- **Authentication:** Who are you? (Login, identity verification)
- **Authorization:** What are you allowed to do? (Permissions, roles)

---

## 6.2 JWT Authentication

JSON Web Tokens (JWT) are a popular way to implement stateless authentication in APIs.

### AuthService Example
```typescript
@Injectable()
export class AuthService {
  constructor(private jwtService: JwtService) {}

  async validateUser(email: string, pass: string): Promise<any> {
    // Validate user credentials (e.g., check DB)
    // Return user object if valid, null otherwise
  }

  async login(user: any) {
    const payload = { email: user.email, sub: user.id };
    return {
      access_token: this.jwtService.sign(payload),
    };
  }
}
```

### Auth Guard Example
```typescript
@Injectable()
export class JwtAuthGuard extends AuthGuard('jwt') {}

@UseGuards(JwtAuthGuard)
@Get('profile')
getProfile(@Request() req) {
  return req.user;
}
```

---

## 6.3 Authorization: Roles & Permissions

Role-Based Access Control (RBAC) restricts access based on user roles.

### Roles Decorator & Guard
```typescript
import { SetMetadata, UseGuards } from '@nestjs/common';

export const Roles = (...roles: string[]) => SetMetadata('roles', roles);

@Injectable()
export class RolesGuard implements CanActivate {
  canActivate(context: ExecutionContext): boolean {
    const request = context.switchToHttp().getRequest();
    const user = request.user;
    const roles = this.reflector.get<string[]>('roles', context.getHandler());
    return roles ? roles.includes(user.role) : true;
  }
}

@Roles('admin')
@UseGuards(RolesGuard)
@Delete(':id')
delete(@Param('id') id: string) {
  return this.service.delete(id);
}
```

---

## 6.4 OAuth2 & Social Login

NestJS supports OAuth2 via Passport strategies. Example: Google login.

```typescript
@UseGuards(AuthGuard('google'))
@Get('auth/google')
async googleAuth(@Req() req) {}

@UseGuards(AuthGuard('google'))
@Get('auth/google/callback')
googleAuthRedirect(@Req() req) {
  return req.user;
}
```

---

## 6.5 Multi-Factor Authentication (MFA)

Enhance security by requiring a second factor (e.g., OTP, email code) after password login. Implement as a separate guard or service.

---

## 6.6 Security Best Practices

- Always hash passwords (e.g., bcrypt)
- Use HTTPS in production
- Store secrets in environment variables
- Set secure HTTP headers (e.g., helmet)
- Limit login attempts to prevent brute force
- Validate and sanitize all input
- Keep dependencies up to date

---

## 6.7 Real-World Example: Auth Module Structure

```text
auth/
  auth.module.ts
  auth.service.ts
  auth.controller.ts
  jwt.strategy.ts
  local.strategy.ts
  guards/
    jwt-auth.guard.ts
    roles.guard.ts
  dto/
    login.dto.ts
    register.dto.ts
```

---

## 6.8 Summary

You’ve learned how to secure your NestJS APIs with authentication, authorization, JWT, OAuth, and best practices. Next, we’ll cover testing strategies for robust applications.
